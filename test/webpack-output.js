!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.PuzzleScript=t():e.PuzzleScript=t()}(window,function(){return function(e){var t={};function s(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,s),o.l=!0,o.exports}return s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=13)}([function(e,t,s){"use strict";function n(e,t){let s=1,n=1,o=0,r=0,i=null,a=null,l=-1;for(;o<t;){const t=e.charAt(o++);"\n"===t?(s++,n=1,l=r,r=o):"\r"!==t&&n++}let c=e.indexOf("\n",r);if(-1===c)c=e.length;else{const t=e.indexOf("\n",c+1);i=(i=-1===t?e.slice(c):e.slice(c,t)).replace(/^\r?\n/,"").replace(/\r$/,"")}return l>=0&&(a=e.slice(l,r).replace(/\r?\n$/,"")),{lineNum:s,colNum:n,line:e.slice(r,c).replace(/\r$/,""),prevLine:a,nextLine:i}}Object.defineProperty(t,"__esModule",{value:!0}),t.getLineAndColumn=n;t.BaseForLines=class{constructor(e){if(!e)throw new Error("BUG: failed to provide the source when constructing this object");this.__source=e}__getSourceLineAndColumn(){const e=this.__source;return n(e.code,e.sourceOffset)}toString(){const e=this.__source,{lineNum:t}=n(e.code,e.sourceOffset);return e.code.split("\n")[t-1]}toSourceString(){const e=this.__source,{lineNum:t}=n(e.code,e.sourceOffset);return e.code.split("\n")[t-1]}__getLineAndColumnRange(){const e=this.__source,{lineNum:t,colNum:s}=n(e.code,e.sourceOffset);return{start:{line:t,col:s},end:{line:t,col:s+1}}}__incrementCoverage(){}}},function(e,t,s){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT",e.ACTION="ACTION",e.STATIONARY="STATIONARY",e.RANDOMDIR="RANDOMDIR"}(n=t.RULE_DIRECTION||(t.RULE_DIRECTION={})),t._flatten=function(e){return[].concat.apply([],e)},t._debounce=function(e){let t;return()=>{t&&clearTimeout(t),t=setTimeout(()=>{e()},10)}},t.opposite=function(e){switch(e){case n.UP:return n.DOWN;case n.DOWN:return n.UP;case n.LEFT:return n.RIGHT;case n.RIGHT:return n.LEFT;default:throw new Error(`BUG: Invalid direction: "${e}"`)}},t.setEquals=function(e,t){if(e.size!==t.size)return!1;for(const s of t)if(!e.has(s))return!1;return!0},t.setAddAll=function(e,t){const s=new Set(e);for(const e of t)s.add(e);return s},t.setIntersection=function(e,t){const s=new Set;for(const n of t)e.has(n)&&s.add(n);return s},t.setDifference=function(e,t){const s=new Set(e);for(const e of t)s.delete(e);return s};let o=1,r=null;function i(){o=1}t.nextRandom=function(e){if(r){if(r.length<=o-1)throw new Error(`BUG: the list of random values for testing was too short.\n            See calls to setRandomValuesForTesting([...]).\n            The list was [${r}]. Index being requested is ${o-1}`);const e=r[o-1];return o++,e}const t=1e4*Math.sin(o++);return Math.round((t-Math.floor(t))*(e-1))},t.resetRandomSeed=i,t.setRandomValuesForTesting=function(e){r=e,i()},t.clearRandomValuesForTesting=function(){r=null,i()},t.getRandomSeed=function(){return o},function(e){e.BREAKPOINT="DEBUGGER",e.BREAKPOINT_REMOVE="DEBUGGER_REMOVE"}(t.DEBUG_FLAG||(t.DEBUG_FLAG={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(15);t.Cell=n.Cell,t.GameEngine=n.GameEngine;const o=s(9);t.GameData=o.GameData;const r=s(6);t.Parser=r.default;const i=s(30);t.closeSounds=i.closeSounds,t.playSound=i.playSound;const a=s(12);t.BaseUI=a.default;const l=s(1);t.RULE_DIRECTION=l.RULE_DIRECTION},function(e,t){var s,n,o=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function a(e){if(s===setTimeout)return setTimeout(e,0);if((s===r||!s)&&setTimeout)return s=setTimeout,setTimeout(e,0);try{return s(e,0)}catch(t){try{return s.call(null,e,0)}catch(t){return s.call(this,e,0)}}}!function(){try{s="function"==typeof setTimeout?setTimeout:r}catch(e){s=r}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var l,c=[],p=!1,h=-1;function m(){p&&l&&(p=!1,l.length?c=l.concat(c):h=-1,c.length&&u())}function u(){if(!p){var e=a(m);p=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,p=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function $(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];c.push(new f(e,t)),1!==c.length||p||a(u)},f.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=$,o.addListener=$,o.once=$,o.off=$,o.removeListener=$,o.removeAllListeners=$,o.emit=$,o.prependListener=$,o.prependOnceListener=$,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,s){var n;
/**
 * @license BitSet.js v5.0.3 4/3/2018
 * http://www.xarg.org/2014/03/javascript-bit-array/
 *
 * Copyright (c) 2016, Robert Eisele (robert@xarg.org)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 **/
/**
 * @license BitSet.js v5.0.3 4/3/2018
 * http://www.xarg.org/2014/03/javascript-bit-array/
 *
 * Copyright (c) 2016, Robert Eisele (robert@xarg.org)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 **/
!function(s){"use strict";var o=32,r=5;function i(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24}function a(e,t){for(var s=0,n=0;n<e.length;n++){s*=2;var o=(e[n]+s)/t|0;s=(e[n]+s)%t,e[n]=o}return s}function l(e,t){if(null==t)return e.data=[0,0,0,0,0,0,0,0,0,0],void(e._=0);if(t instanceof c)return e.data=t.data,void(e._=t._);switch(typeof t){case"number":e.data=[0|t],e._=0;break;case"string":var s=2,n=o;0===t.indexOf("0b")?t=t.substr(2):0===t.indexOf("0x")&&(t=t.substr(2),s=16,n=8),e.data=[],e._=0;for(var i=t.length-n,a=t.length;;){var l=parseInt(t.slice(i>0?i:0,a),s);if(isNaN(l))throw SyntaxError("Invalid param");if(e.data.push(0|l),i<=0)break;i-=n,a-=n}break;default:e.data=[0];var h=e.data;if(t instanceof Array){for(var m=t.length-1;m>=0;m--){var u=t[m];u===1/0?e._=-1:(p(e,u),h[u>>>r]|=1<<u)}break}if(Uint8Array&&t instanceof Uint8Array){p(e,8*t.length);for(m=0;m<t.length;m++)for(var f=t[m],$=0;$<8;$++){var b=8*m+$;h[b>>>r]|=(f>>$&1)<<b}break}throw SyntaxError("Invalid param")}}function c(e){if(!(this instanceof c))return new c(e);l(this,e),this.data=this.data.slice()}function p(e,t){for(var s=t>>>r,n=e.data,o=e._,i=n.length;s>=i;s--)n.push(o)}var h={data:[],_:0};c.prototype={data:[],_:0,set:function(e,t){return p(this,e|=0),void 0===t||t?this.data[e>>>r]|=1<<e:this.data[e>>>r]&=~(1<<e),this},get:function(e){e|=0;var t=this.data,s=e>>>r;return s>t.length?1&this._:t[s]>>>e&1},not:function(){for(var e=this.clone(),t=e.data,s=0;s<t.length;s++)t[s]=~t[s];return e._=~e._,e},and:function(e){l(h,e);var t=this.clone(),s=t.data,n=h.data,r=n.length,i=h._;0!==t._&&p(t,r*o-1);for(var a=s.length,c=Math.min(r,a),m=0;m<c;m++)s[m]&=n[m];for(;m<a;m++)s[m]&=i;return t._&=i,t},or:function(e){l(h,e);for(var t=this.clone(),s=t.data,n=h.data,o=n.length-1,r=s.length-1,i=Math.min(r,o),a=o;a>i;a--)s[a]=n[a];for(;a>=0;a--)s[a]|=n[a];return t._|=h._,t},xor:function(e){l(h,e);var t=this.clone(),s=t.data,n=h.data,o=t._,r=h._,i=0,a=s.length-1,c=n.length-1;for(i=a;i>c;i--)s[i]^=r;for(i=c;i>a;i--)s[i]=o^n[i];for(;i>=0;i--)s[i]^=n[i];return t._^=r,t},andNot:function(e){return this.and(new c(e).flip())},flip:function(e,t){if(void 0===e){for(var s=this.data,n=0;n<s.length;n++)s[n]=~s[n];this._=~this._}else if(void 0===t)p(this,e),this.data[e>>>r]^=1<<e;else if(0<=e&&e<=t){p(this,t);for(n=e;n<=t;n++)this.data[n>>>r]^=1<<n}return this},clear:function(e,t){var s=this.data;if(void 0===e){for(var n=s.length-1;n>=0;n--)s[n]=0;this._=0}else if(void 0===t)p(this,e|=0),s[e>>>r]&=~(1<<e);else if(e<=t){p(this,t);for(n=e;n<=t;n++)s[n>>>r]&=~(1<<n)}return this},slice:function(e,t){if(void 0===e)return this.clone();if(void 0===t){t=this.data.length*o,(n=Object.create(c.prototype))._=this._,n.data=[0];for(var s=e;s<=t;s++)n.set(s-e,this.get(s));return n}if(e<=t&&0<=e){var n;(n=Object.create(c.prototype)).data=[0];for(s=e;s<=t;s++)n.set(s-e,this.get(s));return n}return null},setRange:function(e,t,s){for(var n=e;n<=t;n++)this.set(n,s);return this},clone:function(){var e=Object.create(c.prototype);return e.data=this.data.slice(),e._=this._,e},toArray:Math.clz32?function(){for(var e=[],t=this.data,s=t.length-1;s>=0;s--)for(var n=t[s];0!==n;){var r=31-Math.clz32(n);n^=1<<r,e.unshift(s*o+r)}return 0!==this._&&e.push(1/0),e}:function(){for(var e=[],t=this.data,s=0;s<t.length;s++)for(var n=t[s];0!==n;){var r=n&-n;n^=r,e.push(s*o+i(r-1))}return 0!==this._&&e.push(1/0),e},toString:function(e){var t=this.data;if(e||(e=2),0==(e&e-1)&&e<36){for(var s="",n=2+Math.log(4294967295)/Math.log(e)|0,r=t.length-1;r>=0;r--){var i=t[r];i<0&&(i+=4294967296);var l=i.toString(e);""!==s&&(s+="0".repeat(n-l.length-1)),s+=l}return 0===this._?(""===(s=s.replace(/^0+/,""))&&(s="0"),s):(s="1111"+s).replace(/^1+/,"...1111")}if(2>e||e>36)throw SyntaxError("Invalid base");s=[];var c=[];for(r=t.length;r--;)for(var p=o;p--;)c.push(t[r]>>>p&1);do{s.unshift(a(c,e).toString(e))}while(!c.every(function(e){return 0===e}));return s.join("")},isEmpty:function(){if(0!==this._)return!1;for(var e=this.data,t=e.length-1;t>=0;t--)if(0!==e[t])return!1;return!0},cardinality:function(){if(0!==this._)return 1/0;for(var e=0,t=this.data,s=0;s<t.length;s++){var n=t[s];0!==n&&(e+=i(n))}return e},msb:Math.clz32?function(){if(0!==this._)return 1/0;for(var e=this.data,t=e.length;t-- >0;){var s=Math.clz32(e[t]);if(s!==o)return t*o+o-1-s}return 1/0}:function(){if(0!==this._)return 1/0;for(var e=this.data,t=e.length;t-- >0;){var s=e[t],n=0;if(s){for(;(s>>>=1)>0;n++);return t*o+n}}return 1/0},ntz:function(){for(var e=this.data,t=0;t<e.length;t++){var s=e[t];if(0!==s)return t*o+i(s=(s^s-1)>>>1)}return 1/0},lsb:function(){for(var e=this.data,t=0;t<e.length;t++){var s=e[t],n=0;if(s){for(var r=s&-s;r>>>=1;n++);return o*t+n}}return 1&this._},equals:function(e){l(h,e);var t=this.data,s=h.data,n=this._,o=h._,r=t.length-1,i=s.length-1;if(o!==n)return!1;for(var a=r<i?r:i,c=0;c<=a;c++)if(t[c]!==s[c])return!1;for(c=r;c>i;c--)if(t[c]!==o)return!1;for(c=i;c>r;c--)if(s[c]!==n)return!1;return!0}},c.fromBinaryString=function(e){return new c("0b"+e)},c.fromHexString=function(e){return new c("0x"+e)},c.Random=function(e){(void 0===e||e<0)&&(e=o);for(var t=e%o,s=[],n=Math.ceil(e/o),r=Object.create(c.prototype),i=0;i<n;i++)s.push(4294967296*Math.random()|0);return t>0&&(s[n-1]&=(1<<t)-1),r.data=s,r._=0,r},void 0===(n=function(){return c}.apply(t,[]))||(e.exports=n)}()},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(0);class o{constructor(e,t,s){this.r=e,this.g=t,this.b=s}}t.HexColor=class extends n.BaseForLines{constructor(e,t){super(e),this.hex=t}isTransparent(){return!1}toRgb(){return function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(e,t,s,n)=>t+t+s+s+n+n);const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(t)return new o(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16));throw new Error("BUG: hex color was invalid")}(this.hex)}toHex(){return this.hex}};t.TransparentColor=class extends n.BaseForLines{constructor(e){super(e)}isTransparent(){return!0}toRgb(){throw new Error("BUG: Transparent colors do not have RGB data")}toHex(){throw new Error("BUG: Transparent colors do not have a hex color value")}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(18),o=s(19),r=s(11),i=s(5),a=s(7),l=s(9),c=s(20),p=s(21),h=s(22),m=s(10),u=s(23),f=s(24),$=s(29);function b(e){const t=[];for(const s of e)s&&t.push(s);return t}class d{constructor(e,t,s){this.source=e,this.level=t,this.message=s}toKey(){return`[${this.source.toString()}] [${this.level}] [${this.message}]`}}var _;t.ValidationMessage=d,function(e){e[e.ERROR=0]="ERROR",e[e.WARNING=1]="WARNING",e[e.INFO=2]="INFO"}(_=t.ValidationLevel||(t.ValidationLevel={}));class g{constructor(e){this.code=e,this.tileCache=new Map,this.soundCache=new Map,this.validationMessages=new Map}build(e){this.validationMessages.clear();const t=this.toSource({type:"GAME",sourceOffset:0}),s=new p.GameMetadata;e.metadata.forEach(e=>{let t;if("object"==typeof e.value&&e.value.type)switch(e.value.type){case"COLOR_HEX3":case"COLOR_HEX6":case"COLOR_NAME":{const n=e.value;t=this.buildColor(n,s.colorPalette)}break;case"WIDTH_AND_HEIGHT":{const s=e.value;t=new p.Dimension(s.width,s.height)}break;default:throw new Error(`BUG: Invalid type at this point in time: ${e.value}`)}else t=e.value;s._setValue(e.type,t)});const n=e.sprites.map(e=>this.buildSprite(e,s.colorPalette)),o=e.legendItems.map(e=>this.buildLegendItem(e)),r=e.sounds.map(e=>this.buildSound(e)),i=e.collisionLayers.map(e=>this.buildCollisionLayer(e)),a=e.rules.map(e=>this.buildRuleCollection(e)),c=e.winConditions.map(e=>this.buildWinConditon(e)),h=e.levels.map(e=>this.buildLevel(e));return{gameData:new l.GameData(t,e.title,s,n,o,r,i,a,c,h),validationMessages:this.getValidationMessages()}}buildSprite(e,t){let s;return s=e.pixels?new m.GameSpritePixels(this.toSource(e),e.name,e.mapChar,e.colors.map(e=>this.buildColor(e,t)),e.pixels):new m.GameSpriteSingleColor(this.toSource(e),e.name,e.mapChar,e.colors.map(e=>this.buildColor(e,t))),this.cacheAdd(e.name,s),e.mapChar&&this.cacheAdd(e.mapChar,s),s}buildColor(e,t){const s=this.toSource(e),n=t||"arnecolors";switch(e.type){case"COLOR_HEX6":case"COLOR_HEX3":return new i.HexColor(s,e.value);case"COLOR_NAME":if("TRANSPARENT"===e.value.toUpperCase())return new i.TransparentColor(s);{const t=o.lookupColorPalette(n,e.value);return t?new i.HexColor(s,t):(this.addValidationMessage(s,_.WARNING,`ERROR: Invalid color name ${e.value}`),new i.TransparentColor(s))}default:throw new Error(`Unsupported type ${e.type}`)}}buildLegendItem(e){const t=this.toSource(e);switch(e.type){case"LEGEND_ITEM_SIMPLE":if(!e.value)throw new Error("BUG!!!!!!");{const s=new m.GameLegendTileSimple(t,e.name,this.cacheGet(e.value));return this.cacheAdd(e.name,s),s}case"LEGEND_ITEM_AND":if(!e.values)throw new Error("BUG!!!!!!");{const s=new m.GameLegendTileAnd(t,e.name,e.values.map(e=>this.cacheGet(e)));return this.cacheAdd(e.name,s),s}case"LEGEND_ITEM_OR":if(!e.values)throw new Error("BUG!!!!!!");{const s=new m.GameLegendTileOr(t,e.name,e.values.map(e=>this.cacheGet(e)));return this.cacheAdd(e.name,s),s}default:throw new Error(`Unsupported type ${e.type}`)}}buildCollisionLayer(e){const t=this.toSource(e);return new r.CollisionLayer(t,e.tiles.map(e=>this.cacheGet(e)),e=>{this.addValidationMessage(e.source,e.level,e.message)})}buildSound(e){const t=this.toSource(e);switch(e.type){case"SOUND_SFX":{const s=e,n=new h.GameSound(t,e.soundCode);return this.soundCacheAdd(s.sfx,n),n}case"SOUND_WHEN":{const s=e;return new h.GameSoundSimpleEnum(t,s.when,e.soundCode)}case"SOUND_SPRITE_MOVE":{const s=e;return new h.GameSoundMoveSimple(t,this.cacheGet(s.sprite),e.soundCode)}case"SOUND_SPRITE_DIRECTION":{const s=e;return new h.GameSoundMoveDirection(t,this.cacheGet(s.sprite),s.spriteDirection,e.soundCode)}case"SOUND_SPRITE_EVENT":{const s=e;return new h.GameSoundNormal(t,this.cacheGet(s.sprite),s.spriteEvent,e.soundCode)}default:throw new Error(`Unsupported type ${e.type}`)}}buildRuleCollection(e){const t=this.toSource(e);switch(e.type){case"RULE_LOOP":if(!e.rules)throw new Error("BUG!!!!!!");return new f.ASTRuleLoop(t,e.rules.map(e=>this.buildRuleCollection(e)),e.debugFlag);case"RULE_GROUP":if(!e.rules)throw new Error("BUG!!!!!!");if(e.rules[0]){const s=e.rules[0].modifiers.indexOf(f.AST_RULE_MODIFIER.RANDOM)>=0;return new f.ASTRuleGroup(t,s,e.rules.map(e=>this.buildRuleCollection(e)),e.debugFlag)}throw new Error("BUG!!!!!!");case"RULE":const s=e,n=[...s.commands];return s.message&&n.push(s.message),new f.ASTRule(t,s.modifiers,s.conditions.map(e=>this.buildBracket(e)),s.actions.map(e=>this.buildBracket(e)),b(n.map(e=>this.buildCommand(e))),e.debugFlag);default:throw new Error(`Unsupported type ${e.type}`)}}buildBracket(e){const t=this.toSource(e);switch(e.type){case"BRACKET":{const s=e;return new f.ASTRuleBracket(t,s.neighbors.map(e=>this.buildNeighbor(e)),null,e.debugFlag)}case"ELLIPSIS_BRACKET":{const s=e;return new f.ASTRuleBracketEllipsis(t,s.beforeNeighbors.map(e=>this.buildNeighbor(e)),s.afterNeighbors.map(e=>this.buildNeighbor(e)),e.debugFlag)}default:throw new Error(`Unsupported type ${e.type}`)}}buildNeighbor(e){const t=this.toSource(e);return new f.ASTRuleBracketNeighbor(t,b(e.tilesWithModifier.map(e=>this.buildTileWithModifier(e))),e.debugFlag)}buildTileWithModifier(e){const t=this.toSource(e);return this.cacheHas(e.tile)?new f.ASTTileWithModifier(t,e.modifier,this.cacheGet(e.tile),e.debugFlag):(this.addValidationMessage(t,_.ERROR,`Could not find tile named ${e.tile}`),null)}buildCommand(e){const t=this.toSource(e);switch(e.type){case"COMMAND_MESSAGE":{const s=e;return new a.MessageCommand(t,s.message)}case"COMMAND_SFX":{const s=e;return this.soundCacheHas(s.sfx)?new a.SoundCommand(t,this.soundCacheGet(s.sfx)):(this.addValidationMessage(t,_.ERROR,`Could not find sound named ${s.sfx}`),null)}case"COMMAND_CANCEL":return new a.CancelCommand(t);case"COMMAND_AGAIN":return new a.AgainCommand(t);case"COMMAND_WIN":return new a.WinCommand(t);case"COMMAND_RESTART":return new a.RestartCommand(t);case"COMMAND_CHECKPOINT":return new a.CheckpointCommand(t);default:throw new Error(`Unsupported type ${e.type}`)}}buildWinConditon(e){const t=this.toSource(e);switch(e.type){case"WINCONDITION_ON":{const s=e;return new u.WinConditionOn(t,s.qualifier,this.cacheGet(s.sprite),this.cacheGet(s.onSprite))}case"WINCONDITION_SIMPLE":{const s=e;return new u.WinConditionSimple(t,s.qualifier,this.cacheGet(s.sprite))}default:throw new Error(`Unsupported type ${e.type}`)}}buildLevel(e){const t=this.toSource(e);switch(e.type){case"LEVEL_MESSAGE":{const s=e;return new c.MessageLevel(t,s.message)}case"LEVEL_MAP":{const s=e;return new c.LevelMap(t,s.rowData.map(e=>e.map(e=>this.cacheGet(e))))}default:throw new Error(`Unsupported type ${e.type}`)}}toSource(e){return{code:this.code,sourceOffset:e.sourceOffset}}addValidationMessage(e,t,s){const n=new d(e,t,s);this.validationMessages.has(n.toKey())||this.validationMessages.set(n.toKey(),n)}getValidationMessages(){return[...this.validationMessages.values()]}cacheAdd(e,t){if(this.tileCache.has(e.toLowerCase()))throw new Error(`BUG??? duplicate definition of ${e}`);this.tileCache.set(e.toLowerCase(),t)}cacheGet(e){const t=this.tileCache.get(e.toLowerCase());if(t)return t;throw new Error(`BUG: Could not find tile named ${e}`)}cacheHas(e){return this.tileCache.has(e.toLowerCase())}soundCacheAdd(e,t){if(this.soundCache.has(e.toLowerCase()))throw new Error(`BUG??? duplicate definition of ${e}`);this.soundCache.set(e.toLowerCase(),t)}soundCacheGet(e){const t=this.soundCache.get(e.toLowerCase());if(t)return t;throw new Error(`BUG: Could not find sound named ${e}`)}soundCacheHas(e){return this.soundCache.has(e.toLowerCase())}}t.default=new class{constructor(){this.grammar=n.Grammar.fromCompiled($)}parseToAST(e){const t=new n.Parser(this.grammar);t.feed(e),t.feed("\n"),t.finish();const s=t.results;if(1===s.length)return s[0];throw 0===s.length?new Error("ERROR: Could not parse"):new Error(`AMBIGUOUS: has ${s.length} results`)}parse(e){const t=this.parseToAST(e),s=new g(e),{gameData:n,validationMessages:o}=s.build(t);return{data:n,validationMessages:o}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(0);var o;!function(e){e.SFX="SFX",e.CANCEL="CANCEL",e.CHECKPOINT="CHECKPOINT",e.RESTART="RESTART",e.MESSAGE="MESSAGE",e.WIN="WIN",e.AGAIN="AGAIN"}(o=t.COMMAND_TYPE||(t.COMMAND_TYPE={}));class r extends n.BaseForLines{getSound(){throw new Error("BUG: Check getType() first")}getMessage(){throw new Error("BUG: Check getType() first")}}t.AbstractCommand=r;t.MessageCommand=class extends r{constructor(e,t){super(e),this.message=t}getType(){return o.MESSAGE}getMessage(){return this.message}isInvalid(){return null}isMap(){return!1}toKey(){return`[MESSAGE:"${this.message}"]`}};t.SoundCommand=class extends r{constructor(e,t){if(super(e),this.sound=t,!t)throw new Error(`ERROR: Sound not found\n${this.toString()}`)}getType(){return o.SFX}getSound(){return this.sound}toKey(){return`[SOUND:${this.sound.soundCode}]`}};t.CancelCommand=class extends r{constructor(e){super(e)}getType(){return o.CANCEL}toKey(){return"[CANCEL]"}};t.CheckpointCommand=class extends r{constructor(e){super(e)}getType(){return o.CHECKPOINT}toKey(){return"[CHECKPOINT]"}};t.RestartCommand=class extends r{constructor(e){super(e)}getType(){return o.RESTART}toKey(){return"[RESTART]"}};t.WinCommand=class extends r{constructor(e){super(e)}getType(){return o.WIN}toKey(){return"[WIN]"}};t.AgainCommand=class extends r{constructor(e){super(e)}getType(){return o.AGAIN}toKey(){return"[AGAIN]"}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(4);class o{constructor(e,t){this.bitSet=t||new n,e&&this.addAll(e)}isEmpty(){return this.bitSet.isEmpty()}addAll(e){for(const t of e)this.add(t)}add(e){this.bitSet.set(this._indexOf(e))}remove(e){this.bitSet.clear(this._indexOf(e))}has(e){return!!this.bitSet.get(this._indexOf(e))}containsAll(e){return e.bitSet.cardinality()===this.bitSet.and(e.bitSet).cardinality()}containsAny(e){return!this.bitSet.and(e.bitSet).isEmpty()}containsNone(e){return e.bitSet.and(this.bitSet).isEmpty()}_indexOf(e){const t=this.indexOf(e);if(t<0)throw new Error(`BUG: Expected the item index to be >= 0 but it was ${t}`);return t}}class r extends o{indexOf(e){return e.allSpritesBitSetIndex}toString(e){const t=[];for(const s of this.getSprites(e))t.push(s.getName());return t.join(" ")}union(e){let t=this;for(const s of e)t=t.or(s);return t}getSprites(e){const t=new Set;for(const s of e.objects)this.has(s)&&t.add(s);return t}or(e){return new r(void 0,this.bitSet.or(e.bitSet))}}t.SpriteBitSet=r},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(17),o=s(11);t.GameData=class{constructor(e,t,s,r,i,a,l,c,p,h){this.title=t,this.metadata=s,this.objects=r,this.legends=i,this.sounds=a,this.collisionLayers=l,this.winConditions=p,this.levels=h,this.objects.forEach((e,t)=>{e.allSpritesBitSetIndex=t});let m=this.objects.length;const u=new Map,f=new Map,$=new Map,b=new Map;this.rules=c.map(e=>e.simplify(u,f,$,b));const d=this.objects.filter(e=>e.hasPixels())[0];if(d){const e=d.getPixels(1,1);this.cacheSpriteSize={spriteHeight:e.length,spriteWidth:e[0].length}}else this.cacheSpriteSize={spriteHeight:1,spriteWidth:1};this.letterSprites=n.getLetterSprites(e);for(const e of this.letterSprites.values())e.allSpritesBitSetIndex=m++;const _=new o.CollisionLayer(e,[...this.letterSprites.values()],()=>{throw new Error("BUG: Letter collision layers should not have a problem")});this.collisionLayers.push(_)}_getSpriteByName(e){return this.objects.find(t=>t.getName().toLowerCase()===e.toLowerCase())}_getTileByName(e){return this.legends.find(t=>t.getName().toLowerCase()===e.toLowerCase())}getMagicBackgroundSprite(){if(this.cachedBackgroundSprite)return this.cachedBackgroundSprite;{const e=this._getSpriteByName("background");if(!e){const e=this.legends.find(e=>"background"===e.spriteNameOrLevelChar.toLocaleLowerCase());if(e)return e.isOr()?null:e.getSprites()[0]}if(!e)throw new Error("ERROR: Game does not have a Background Sprite or Tile");return this.cachedBackgroundSprite=e,e}}getPlayer(){const e=this._getSpriteByName("player")||this.legends.find(e=>"player"===e.spriteNameOrLevelChar.toLocaleLowerCase());if(!e)throw new Error("BUG: Could not find the Player sprite or tile in the game");return e}clearCaches(){for(const e of this.rules)e.clearCaches();for(const e of this.objects)e.clearCaches()}getSpriteSize(){return this.cacheSpriteSize}getLetterSprite(e){const t=this.letterSprites.get(e);if(!t)throw new Error(`BUG: Cannot find sprite for letter "${e}"`);return t}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(1),o=s(0),r=s(5),i=s(4);class a extends o.BaseForLines{constructor(e,t,s){super(e),this.name=t,this._optionalLegendChar=s,this.trickleCells=new Set,this.trickleTiles=new Set,this.trickleTilesWithModifier=new Set,this.allSpritesBitSetIndex=-1}isOr(){return!1}equals(e){return this===e}getName(){return this.name}isBackground(){return"background"===this.name.toLowerCase()}_getDescendantTiles(){return[]}getSprites(){return[this]}getSpritesForRuleAction(){return this.getSprites()}hasCollisionLayer(){return!!this.collisionLayer}hasSingleCollisionLayer(){return this.hasCollisionLayer()}setCollisionLayer(e){this.collisionLayer=e}setCollisionLayerAndIndex(e,t){this.collisionLayer=e,this.collisionLayerIndex=t,this.bitSet=new i,this.bitSet.set(t)}getBitSet(){return this.bitSet}getBitSetIndex(){return this.collisionLayerIndex}getCollisionLayer(){if(!this.collisionLayer)throw new Error(`ERROR: This sprite was not in a Collision Layer\n${this.toString()}`);return this.collisionLayer}isInvalid(){return this.collisionLayer?null:"This object does not have an entry in the COLLISIONLAYERS section."}clearCaches(){this.trickleCells.clear()}hasCell(e){return this.trickleCells.has(e)}matchesCell(e){return e.getSpritesAsSet().has(this)}getSpritesThatMatch(e){return e.getSpritesAsSet().has(this)?new Set([this]):new Set}subscribeToCellChanges(e){this.trickleTilesWithModifier.add(e)}subscribeToCellChangesTile(e){this.trickleTiles.add(e)}addCell(e,t){this.addCells(this,[e],t)}removeCell(e){this.removeCells(this,[e])}updateCell(e,t){for(const s of this.trickleTiles)s.updateCells(this,[e],t);for(const s of this.trickleTilesWithModifier)s.updateCells(this,[e],t)}addCells(e,t,s){for(const e of t){if(this.trickleCells.has(e))throw new Error("BUG: should not be trying to add a cell that has already been matched (right?)");this.trickleCells.add(e)}for(const e of this.trickleTiles)e.addCells(this,t,s);for(const e of this.trickleTilesWithModifier)e.addCells(this,this,t,s)}updateCells(e,t,s){for(const e of this.trickleTiles)e.updateCells(this,t,s);for(const e of this.trickleTilesWithModifier)e.updateCells(this,t,s)}removeCells(e,t){for(const e of t)this.trickleCells.delete(e);for(const e of this.trickleTiles)e.removeCells(this,t);for(const e of this.trickleTilesWithModifier)e.removeCells(this,this,t)}has(e){return this.trickleCells.has(e)}hasNegationTileWithModifier(){for(const e of this.trickleTilesWithModifier)if(e.isNo())return!0;for(const e of this.trickleTiles)if(e.hasNegationTileWithModifier())return!0;return!1}getCellsThatMatch(){return this.trickleCells}}t.GameSprite=a;t.GameSpriteSingleColor=class extends a{constructor(e,t,s,n){super(e,t,s),this.color=n[0]}hasPixels(){return!1}getPixels(e,t){const s=[];for(let n=0;n<e;n++){s.push([]);for(let e=0;e<t;e++)s[n].push(this.color)}return s}};t.GameSpritePixels=class extends a{constructor(e,t,s,n,o){super(e,t,s),this.colors=n,this.pixels=o.map(e=>e.map(e=>"."===e?new r.TransparentColor(this.__source):this.colors[e]))}isInvalid(){if(super.isInvalid())return super.isInvalid();let e=null;const t=this.colors.length,s=this.pixels[0].length;return this.pixels.forEach(n=>{n.length!==s&&(e=`Row lengths do not match. Expected ${s} but got ${n.length}. Row: ${n}`),n.forEach(s=>{"."!==s&&s>=t&&(e=`Pixel number is too high (${s}). There are only ${t} colors defined`)})}),e}getSprites(){return[this]}hasPixels(){return!0}getPixels(e,t){return this.pixels.map(e=>e.map(e=>e))}};class l extends o.BaseForLines{constructor(e,t,s){super(e),this.spriteNameOrLevelChar=t,this.tiles=s,this.trickleCells=new Set,this.trickleTilesWithModifier=new Set}equals(e){if(this.isOr()!==e.isOr())return!1;return 0===n.setDifference(new Set(this.getSprites()),e.getSprites()).size}isOr(){return!1}isInvalid(){return this.hasCollisionLayer()?null:"Missing collision layer"}getName(){return this.spriteNameOrLevelChar}getSpritesForRuleAction(){return this.getSprites()}_getDescendantTiles(){return this.tiles.concat(n._flatten(this.tiles.map(e=>e._getDescendantTiles())))}getSprites(){return this.spritesCache||(this.spritesCache=n._flatten(this.tiles.map(e=>e.getSprites())).sort((e,t)=>e.getCollisionLayer().id-t.getCollisionLayer().id).reverse()),this.spritesCache}hasCollisionLayer(){return!!this.collisionLayer}setCollisionLayer(e){this.collisionLayer=e}getCollisionLayer(){if(this.collisionLayer)return this.collisionLayer;const e=this.getSprites()[0].getCollisionLayer();for(const t of this.getSprites())if(t.getCollisionLayer()!==e)throw new Error(`ooh, sprites in a tile have different collision layers... that's a problem\n${this.toString()}`);return e}getCellsThatMatch(){const e=new Set;for(const t of this.getSprites())for(const s of t.getCellsThatMatch())e.add(s);return e}subscribeToCellChanges(e){this.trickleTilesWithModifier.add(e);for(const e of this.getSprites())e.subscribeToCellChangesTile(this)}hasNegationTileWithModifier(){for(const e of this.trickleTilesWithModifier)if(e.isNo())return!0;return!1}addCells(e,t,s){for(const n of t)if(!this.trickleCells.has(n)&&this.matchesCell(n)){this.trickleCells.add(n);for(const t of this.trickleTilesWithModifier)t.addCells(this,e,[n],s)}}updateCells(e,t,s){for(const n of this.trickleTilesWithModifier)n.updateCells(e,t,s)}removeCells(e,t){for(const s of t)if(this.matchesCell(s))this.trickleCells.has(s)?this.updateCells(e,[s],null):this.addCells(e,[s],null);else{this.trickleCells.delete(s);for(const t of this.trickleTilesWithModifier)t.removeCells(this,e,[s])}}hasCell(e){return this.trickleCells.has(e)}}t.GameLegendTile=l;t.GameLegendTileSimple=class extends l{constructor(e,t,s){super(e,t,[s])}matchesCell(e){for(const t of this.tiles)if(!t.matchesCell(e))return!1;return!0}getSpritesThatMatch(e){return n.setIntersection(new Set(this.getSprites()),e.getSpritesAsSet())}hasSingleCollisionLayer(){return!!this.collisionLayer}};t.GameLegendTileAnd=class extends l{matchesCell(e){for(const t of this.tiles)if(!t.matchesCell(e))return!1;return!0}getSpritesThatMatch(e){throw new Error("BUG: This method should only be called for OR tiles")}hasSingleCollisionLayer(){return!!this.collisionLayer}};t.GameLegendTileOr=class extends l{isOr(){return!0}matchesCell(e){for(const t of this.tiles)if(t.matchesCell(e))return!0;return!1}getSpritesThatMatch(e){return n.setIntersection(new Set(this.getSprites()),e.getSpritesAsSet())}hasSingleCollisionLayer(){const e=this.getSprites();for(const t of e)if(t.getCollisionLayer()!==e[0].getCollisionLayer())return!1;return!0}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(6),o=s(1),r=s(0);let i=0;t.CollisionLayer=class extends r.BaseForLines{constructor(e,t,s){super(e),this.id=i++,t.forEach(e=>{e.hasCollisionLayer()&&s(new n.ValidationMessage(e.__source,n.ValidationLevel.WARNING,"An Object should not belong to more than one collision layer")),e.setCollisionLayer(this),e._getDescendantTiles().forEach(e=>{e.hasCollisionLayer()&&s(new n.ValidationMessage(e.__source,n.ValidationLevel.WARNING,"An Object should not belong to more than one collision layer. This item was referenced indirectly by a LEGEND entry")),e.setCollisionLayer(this)})}),this.sprites=[...new Set(o._flatten(t.map(e=>e.getSprites())))],this.sprites.forEach((e,t)=>e.setCollisionLayerAndIndex(this,t))}getBitSetIndexOf(e){const t=this.sprites.indexOf(e);if(t<0)throw new Error("BUG: Sprite is not in this CollisionLayer");return t}toKey(){return this.sprites.map(e=>e.getName()).join(" ")}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(2),o=s(2),r=s(6),i=s(1);class a{constructor(){this.cache=new Map}get(e,t,s,n){const o=[...e].sort((e,t)=>e.getCollisionLayer().id-t.getCollisionLayer().id).reverse(),r=o.map(e=>e.getName()).join(" ");let i=this.cache.get(r);return i||(i=function(e,t,s,n){if(0===e.length){const e=[];for(let o=0;o<s;o++){e[o]=e[o]||[];for(let s=0;s<n;s++)t&&(e[o][s]=t)}return e}0;if(1===e.length)return e[0].getPixels(s,n);const o=e[0].getPixels(s,n);return e.slice(1).forEach((e,t)=>{const r=e.getPixels(s,n);for(let e=0;e<s;e++){o[e]=o[e]||[];for(let t=0;t<n;t++){const s=r[e][t];o[e][t]&&!o[e][t].isTransparent()||!s||s.isTransparent()||(o[e][t]=s)}}}),o}(o,t,s,n),this.cache.set(r,i)),i}clear(){this.cache.clear()}}t.default=class{constructor(){this.cellColorCache=new a,this.renderedPixels=[],this.windowOffsetColStart=0,this.windowOffsetRowStart=0,this.isDumpingScreen=!1,this.PIXEL_HEIGHT=1,this.PIXEL_WIDTH=2,this.SPRITE_HEIGHT=5,this.SPRITE_WIDTH=5,this.hasVisualUi=!0}setGameEngine(e){if(this.engine=e,this.gameData=e.getGameData(),this.renderedPixels=[],this.cellColorCache.clear(),this.clearScreen(),this.windowOffsetColStart=0,this.windowOffsetRowStart=0,this.windowOffsetWidth=null,this.windowOffsetHeight=null,this.gameData.metadata.flickscreen){const{width:e,height:t}=this.gameData.metadata.flickscreen;this.windowOffsetWidth=e,this.windowOffsetHeight=t}else if(this.gameData.metadata.zoomscreen){const{width:e,height:t}=this.gameData.metadata.zoomscreen;this.windowOffsetWidth=e,this.windowOffsetHeight=t}const{spriteHeight:t,spriteWidth:s}=this.gameData.getSpriteSize();this.SPRITE_HEIGHT=t,this.SPRITE_WIDTH=s}setGame(e){const{data:t}=r.default.parse(e);if(!t)throw new Error("BUG: Could not parse gameData and did not find an error");this.setGameEngine(new n.GameEngine(t))}getGameData(){if(!this.engine)throw new Error("BUG: Game has not been specified yet");return this.engine.getGameData()}press(e){this.engine&&this.engine.press(e)}pressUp(){this.press(o.RULE_DIRECTION.UP)}pressDown(){this.press(o.RULE_DIRECTION.DOWN)}pressLeft(){this.press(o.RULE_DIRECTION.LEFT)}pressRight(){this.press(o.RULE_DIRECTION.RIGHT)}pressAction(){this.press(o.RULE_DIRECTION.ACTION)}pressUndo(){this.engine&&(this.engine.pressUndo(),this.renderScreen(!1))}pressRestart(){this.engine&&(this.engine.pressRestart(),this.renderScreen(!1))}setLevel(e){this.engine&&this.engine.setLevel(e)}getCurrentLevelCells(){if(this.engine)return this.engine.getCurrentLevelCells();throw new Error("BUG: Game has not been specified yet")}tick(){if(!this.engine)throw new Error("BUG: Game has not been specified yet");const e=this.engine.tick();return this.drawCells(e.changedCells,!1),e}debugRenderScreen(){this.engine&&this.renderScreen(!0)}renderMessageScreen(e){const{windowOffsetColStart:t,windowOffsetRowStart:s,windowOffsetHeight:n,windowOffsetWidth:o}=this;if(this.windowOffsetColStart=0,this.windowOffsetRowStart=0,this.windowOffsetHeight=13,this.windowOffsetWidth=34,this.clearScreen(),this.engine){const t=this.createMessageSprites(e);this.engine.setMessageLevel(t),this.drawCellsAfterRecentering(i._flatten(this.getCurrentLevelCells()),0),this.engine.restoreFromMessageLevel()}this.windowOffsetColStart=t,this.windowOffsetRowStart=s,this.windowOffsetHeight=n,this.windowOffsetWidth=o}renderScreen(e,t=0){if(!this.gameData)throw new Error("BUG: gameData was not set yet");if(!this.engine)throw new Error("BUG: gameEngine was not set yet");const s=this.engine.getCurrentLevel();if(!s.isMap())return void this.renderMessageScreen(s.getMessage());const n=this.engine.getCurrentLevelCells();e&&(this.cellColorCache.clear(),this.renderedPixels=[]),this.renderLevelScreen(n,t)}drawCells(e,t,s=0){if(!this.gameData)throw new Error("BUG: gameData was not set yet");if(!this.engine)throw new Error("BUG: gameEngine was not set yet");const n=this.gameData.getPlayer();if(1===n.getCellsThatMatch().size&&s<=1){const t=[...n.getCellsThatMatch()][0],{isOnScreen:s}=this.cellPosToXY(t);this.recenterPlayerIfNeeded(t,s)&&(e=i._flatten(this.engine.getCurrentLevelCells()))}this.hasVisualUi&&this.drawCellsAfterRecentering(e,s)}createMessageTextScreen(e){const t=["                                  ","                                  ","                                  ","                                  ","                                  ","                                  ","                                  ","                                  ","                                  ","                                  ","          X to continue           ","                                  ","                                  "],s=t[9],n=t[10];t[10]=s;const o=t[0].length,r=function(e,t){if(t=t||75,!e)return e;const s=".{1,"+t+"}(\\s|$)|.{"+t+"}|.+$",n=e.match(RegExp(s,"g"));if(n)return n;throw new Error("BUG: Match did not work")}(e,t[0].length);let i=5-(r.length/2|0);i<0&&(i=0);const a=Math.min(r.length,12);for(let e=0;e<a;e++){const s=r[e],n=i+e,a=(o-s.length)/2|0,l=t[n];t[n]=l.slice(0,a)+s+l.slice(a+s.length)}let l=10;return a>=10&&(l=a<12?a+1:12),t[l]=n,t}createMessageSprites(e){if(!this.gameData)throw new Error("BUG: gameData was not set yet");if(!this.engine)throw new Error("BUG: gameEngine was not set yet");const t=this.createMessageTextScreen(e),s=[];for(const e of t){const t=[];s.push(t);for(const s of e){const e=this.gameData.getLetterSprite(s);t.push(new Set([e]))}}return s}cellPosToXY(e){const{colIndex:t,rowIndex:s}=e;let n=!0,o=-1,r=-1;return this.windowOffsetHeight&&this.windowOffsetWidth&&(this.windowOffsetColStart>t||this.windowOffsetRowStart>s||this.windowOffsetColStart+this.windowOffsetWidth<=t||this.windowOffsetRowStart+this.windowOffsetHeight<=s)&&(n=!1),o=(t-this.windowOffsetColStart)*this.SPRITE_WIDTH,r=(s-this.windowOffsetRowStart)*this.SPRITE_HEIGHT,n&&(n=this.checkIfCellCanBeDrawnOnScreen(o,r)),(o<0||r<0)&&(n=!1),{isOnScreen:n,cellStartX:o,cellStartY:r}}getPixelsForCell(e){if(!this.gameData)throw new Error("BUG: gameData was not set yet");const t=e.getSpritesAsSet(),s=this.gameData.getMagicBackgroundSprite();return s&&t.add(s),this.cellColorCache.get(t,this.gameData.metadata.backgroundColor,this.SPRITE_HEIGHT,this.SPRITE_WIDTH)}clearScreen(){this.renderedPixels=[]}hasAgainThatNeedsToRun(){if(!this.engine)throw new Error("BUG: Engine has not been set yet");return this.engine.hasAgain()}recenterPlayerIfNeeded(e,t){if(!this.gameData)throw new Error("BUG: gameData was not set yet");if(!this.engine)throw new Error("BUG: gameEngine was not set yet");let s,n,o,r;const i=this.windowOffsetColStart,a=this.windowOffsetRowStart;let l,c;const p=this.gameData.metadata.flickscreen,h=this.gameData.metadata.zoomscreen,{columns:m,rows:u}=this.getMaxSize(),f=Math.floor(m/this.SPRITE_WIDTH/this.PIXEL_WIDTH),$=Math.floor(u/this.SPRITE_HEIGHT/this.PIXEL_HEIGHT);if(p?(n=e.rowIndex-e.rowIndex%p.height,s=e.colIndex-e.colIndex%p.width,r=p.height,o=p.width):(s=0,n=0,r=this.engine.getCurrentLevelCells().length,o=this.engine.getCurrentLevelCells()[0].length),h?(c=Math.min(h.height,$),l=Math.min(h.width,f)):(c=$,l=f),!(r<=c&&o<=l)){let p=!1;if(o>l&&(i+Math.round(l/4)>e.colIndex||i+Math.round(3*l/4)<=e.colIndex)){let t=e.colIndex-Math.floor(l/2);(t=Math.max(t,s))+l>s+o&&(t=s+o-l),t!==this.windowOffsetColStart&&(this.windowOffsetColStart=t,p=!0)}if(r>c&&(a+Math.round(c/4)>e.rowIndex||a+Math.round(3*c/4)<=e.rowIndex)){let t=e.rowIndex-Math.floor(c/2);(t=Math.max(t,n))+c>n+r&&(t=n+r-c),t!==this.windowOffsetRowStart&&(this.windowOffsetRowStart=t,p=!0)}return p||t?p:(this.windowOffsetColStart=s,this.windowOffsetRowStart=n,!0)}return!t&&(this.windowOffsetColStart=s,this.windowOffsetRowStart=n,!0)}}},function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))(function(o,r){function i(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){e.done?o(e.value):new s(function(t){t(e.value)}).then(i,a)}l((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=s(14);t.keymaster=o;const r=s(2);t.BaseUI=r.BaseUI,t.Cell=r.Cell,t.closeSounds=r.closeSounds,t.GameData=r.GameData,t.GameEngine=r.GameEngine,t.Parser=r.Parser,t.playSound=r.playSound,t.RULE_DIRECTION=r.RULE_DIRECTION;const i=s(34);t.TableUI=i.default;t.TableEngine=class{constructor(e){this.tableUI=new i.default(e),this.timer=0,this.currentLevel=0}setGame(e,t){this.tableUI.setGame(e),this.tableUI.setLevel(t),this.currentLevel=t}start(){this.startKeyboardListener(),this.startTickHandler()}stop(){cancelAnimationFrame(this.timer)}startKeyboardListener(){o("up, w",()=>this.tableUI.pressUp()),o("down, s",()=>this.tableUI.pressDown()),o("left, a",()=>this.tableUI.pressLeft()),o("right, d",()=>this.tableUI.pressRight()),o("space, x",()=>this.tableUI.pressAction()),o("z, u",()=>this.tableUI.pressUndo()),o("r",()=>this.tableUI.pressRestart())}startTickHandler(){const e=()=>n(this,void 0,void 0,function*(){for(;this.tableUI.isCurrentLevelAMessage();)alert(this.tableUI.getCurrentLevelMessage()),this.currentLevel++,this.tableUI.setLevel(this.currentLevel);const{didLevelChange:t,didWinGame:s,messageToShow:n,soundToPlay:o}=this.tableUI.tick();if(o&&r.playSound(o),s)return alert("You Won!"),void cancelAnimationFrame(this.timer);t?(this.currentLevel+=1,this.tableUI.setLevel(this.currentLevel),this.tableUI.isCurrentLevelAMessage()||alert("Congratulations! You completed the level.")):n&&(alert(n),this.tableUI.pressAction()),this.timer=window.requestAnimationFrame(e)});this.timer=window.requestAnimationFrame(e)}}},function(e,t,s){!function(t){var s,n={},o={16:!1,18:!1,17:!1,91:!1},r="all",i={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},a={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},l=function(e){return a[e]||e.toUpperCase().charCodeAt(0)},c=[];for(s=1;s<20;s++)a["f"+s]=111+s;function p(e,t){for(var s=e.length;s--;)if(e[s]===t)return s;return-1}function h(e,t){if(e.length!=t.length)return!1;for(var s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}var m={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};function u(e){for(s in o)o[s]=e[m[s]]}function f(e,t,s){var o,r;o=b(e),void 0===s&&(s=t,t="all");for(var i=0;i<o.length;i++)r=[],(e=o[i].split("+")).length>1&&(r=d(e),e=[e[e.length-1]]),e=e[0],(e=l(e))in n||(n[e]=[]),n[e].push({shortcut:o[i],scope:t,method:s,key:o[i],mods:r})}for(s in i)f[s]=!1;function $(){return r||"all"}function b(e){var t;return""==(t=(e=e.replace(/\s/g,"")).split(","))[t.length-1]&&(t[t.length-2]+=","),t}function d(e){for(var t=e.slice(0,e.length-1),s=0;s<t.length;s++)t[s]=i[t[s]];return t}function _(e,t,s){e.addEventListener?e.addEventListener(t,s,!1):e.attachEvent&&e.attachEvent("on"+t,function(){s(window.event)})}_(document,"keydown",function(e){!function(e){var t,s,r,a,l,h;if(t=e.keyCode,-1==p(c,t)&&c.push(t),93!=t&&224!=t||(t=91),t in o)for(r in o[t]=!0,i)i[r]==t&&(f[r]=!0);else if(u(e),f.filter.call(this,e)&&t in n)for(h=$(),a=0;a<n[t].length;a++)if((s=n[t][a]).scope==h||"all"==s.scope){for(r in l=s.mods.length>0,o)(!o[r]&&p(s.mods,+r)>-1||o[r]&&-1==p(s.mods,+r))&&(l=!1);(0!=s.mods.length||o[16]||o[18]||o[17]||o[91])&&!l||!1===s.method(e,s)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}(e)}),_(document,"keyup",function(e){var t,s=e.keyCode,n=p(c,s);if(n>=0&&c.splice(n,1),93!=s&&224!=s||(s=91),s in o)for(t in o[s]=!1,i)i[t]==s&&(f[t]=!1)}),_(window,"focus",function(){for(s in o)o[s]=!1;for(s in i)f[s]=!1});var g=t.key;t.key=f,t.key.setScope=function(e){r=e||"all"},t.key.getScope=$,t.key.deleteScope=function(e){var t,s,o;for(t in n)for(s=n[t],o=0;o<s.length;)s[o].scope===e?s.splice(o,1):o++},t.key.filter=function(e){var t=(e.target||e.srcElement).tagName;return!("INPUT"==t||"SELECT"==t||"TEXTAREA"==t)},t.key.isPressed=function(e){return"string"==typeof e&&(e=l(e)),-1!=p(c,e)},t.key.getPressedKeyCodes=function(){return c.slice(0)},t.key.noConflict=function(){var e=t.key;return t.key=g,e},t.key.unbind=function(e,t){var s,o,r,i,a,c=[];for(s=b(e),i=0;i<s.length;i++){if((o=s[i].split("+")).length>1&&(c=d(o),e=o[o.length-1]),e=l(e),void 0===t&&(t=$()),!n[e])return;for(r=0;r<n[e].length;r++)(a=n[e][r]).scope===t&&h(a.mods,c)&&(n[e][r]={})}},e.exports=f}(this)},function(e,t,s){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=s(16),o=s(7),r=s(8),i=s(1);class a{constructor(e,t,s,n){this.level=e,this.rowIndex=s,this.colIndex=n,this.state=new Map,this.cacheCollisionLayers=[],this.spriteBitSet=new r.SpriteBitSet(t),this.cachedKeyValue=null;for(const e of t)this._setWantsToMove(e,i.RULE_DIRECTION.STATIONARY)}_setWantsToMove(e,t){const s=e.getCollisionLayer(),{wantsToMove:n,sprite:o}=this.getStateForCollisionLayer(s),r=n!==t,i=o!==e;if(o!==e){if(o)throw new Error("BUG: Should have already been removed?");this.spriteBitSet.add(e)}return this._setState(s,e,t),o!==e&&this.replaceSpriteInLevel(o,e),i||r}_deleteWantsToMove(e){const t=e.getCollisionLayer(),s=this.getSpriteByCollisionLayer(t),n=!!s;return s&&this.spriteBitSet.remove(s),this._setState(t,null,null),n}setWantsToMoveCollisionLayer(e,t){const{sprite:s,wantsToMove:n}=this.getStateForCollisionLayer(e);if(!s)throw new Error(`BUG: No sprite for collision layer. Cannot set direction.\n${e.toString()}`);const o=n!==t;return this._setState(e,s,t),s.updateCell(this,t),o}getSpriteByCollisionLayer(e){const{sprite:t}=this.getStateForCollisionLayer(e);return t||null}getCollisionLayers(){return this.cacheCollisionLayers}getSprites(){const e=[],t=this.getCollisionLayers();for(const s of t){const t=this.getSpriteByCollisionLayer(s);t&&e.push(t)}return e.reverse()}getSpritesAsSet(){const e=new Set;for(const{sprite:t}of this.state.values())e.add(t);return e}getSpriteAndWantsToMoves(){const e=new Map;for(const t of this.getCollisionLayers()){const{sprite:s,wantsToMove:n}=this.getStateForCollisionLayer(t);e.set(s,n)}return e}getCollisionLayerWantsToMove(e){const{wantsToMove:t}=this.getStateForCollisionLayer(e);return t||null}hasSprite(e){return e===this.getSpriteByCollisionLayer(e.getCollisionLayer())}getNeighbor(e){switch(e){case i.RULE_DIRECTION.UP:return this.getRelativeNeighbor(-1,0);case i.RULE_DIRECTION.DOWN:return this.getRelativeNeighbor(1,0);case i.RULE_DIRECTION.LEFT:return this.getRelativeNeighbor(0,-1);case i.RULE_DIRECTION.RIGHT:return this.getRelativeNeighbor(0,1);default:throw new Error(`BUG: Unsupported direction "${e}"`)}}getWantsToMove(e){return this.getCollisionLayerWantsToMove(e.getCollisionLayer())}hasCollisionWithSprite(e){return!!this.getCollisionLayerWantsToMove(e.getCollisionLayer())}clearWantsToMove(e){this._setWantsToMove(e,i.RULE_DIRECTION.STATIONARY),e.updateCell(this,i.RULE_DIRECTION.STATIONARY)}addSprite(e,t){let s=!1;const n=this.getSpriteByCollisionLayer(e.getCollisionLayer()),o=this.getCollisionLayerWantsToMove(e.getCollisionLayer());return n&&n!==e&&this.removeSprite(n),t?s=this._setWantsToMove(e,t):this.hasSprite(e)||(t=o||i.RULE_DIRECTION.STATIONARY,s=this._setWantsToMove(e,t)),e.addCell(this,t),s}updateSprite(e,t){let s=!1;if(this.getSpriteByCollisionLayer(e.getCollisionLayer())!==e)throw new Error("BUG: Should not be trying to update the direction of a sprite that is not in the cell");if(t)s=this._setWantsToMove(e,t);else if(!this.hasSprite(e))throw new Error("BUG: sprite should already be in the cell since we are updating it");return e.updateCell(this,t),s}removeSprite(e){const t=this._deleteWantsToMove(e);return e.removeCell(this),t}toString(){return`Cell [${this.rowIndex}][${this.colIndex}] ${[...this.getSpriteAndWantsToMoves().entries()].map(([e,t])=>`${t} ${e.getName()}`).join(" ")}`}toKey(){return this.cachedKeyValue||(this.cachedKeyValue=[...this.state.values()].map(({sprite:e,wantsToMove:t})=>`${t} ${e.getName()}`).join(" ")),this.cachedKeyValue}toSnapshot(){return this.getSpritesAsSet()}fromSnapshot(e){const t=this.getSpritesAsSet(),s=i.setDifference(t,e),n=i.setDifference(e,t);this.removeSprites(s),this.addSprites(n)}replaceSpriteInLevel(e,t){this.getLevel().replaceSprite(this,e,t)}_setState(e,t,s){let n;t?(n=this.cacheCollisionLayers.indexOf(e)<0,this.state.set(e,{wantsToMove:s,sprite:t})):(this.state.delete(e),n=!0),n&&(this.cacheCollisionLayers=[...this.state.keys()].sort((e,t)=>e.id-t.id)),this.invalidateKey()}getLevel(){if(!this.level)throw new Error("BUG: we need an engine Level in order to find neighbors. It is optional for letters in messages");return this.level}getStateForCollisionLayer(e){const t=this.state.get(e);return t||{wantsToMove:null,sprite:null}}getRelativeNeighbor(e,t){return this.getLevel().getCellOrNull(this.rowIndex+e,this.colIndex+t)}removeSprites(e){for(const t of e)this.removeSprite(t)}addSprites(e){for(const t of e)this.addSprite(t,null)}invalidateKey(){this.cachedKeyValue=null}}t.Cell=a;class l{constructor(){this.rowCache=[],this.colCache=[]}setCells(e){this.cells=e}getCells(){if(!this.cells)throw new Error("BUG: Should have called setCells() first");return this.cells}getCellOrNull(e,t){const s=this.getCells()[e];return s?s[t]:null}getCell(e,t){return this.getCells()[e][t]}replaceSprite(e,t,s){this.cells&&(this.rowCache[e.rowIndex]=null,this.colCache[e.colIndex]=null)}rowContainsSprites(e,t,s){let n=this.rowCache[e];return n||(n=this.computeRowCache(e),this.rowCache[e]=n),!(!n.containsAll(t)||!s.isEmpty())||n.containsAny(s)}colContainsSprites(e,t,s){let n=this.colCache[e];return n||(n=this.computeColCache(e),this.colCache[e]=n),!(!n.containsAll(t)||!s.isEmpty())||n.containsAny(s)}computeRowCache(e){const t=this.getCells()[0].length,s=[];for(let n=0;n<t;n++)s.push(this.getCell(e,n).spriteBitSet);return(new r.SpriteBitSet).union(s)}computeColCache(e){const t=this.getCells().length,s=[];for(let n=0;n<t;n++)s.push(this.getCell(n,e).spriteBitSet);return(new r.SpriteBitSet).union(s)}}t.Level=l;class c extends n.EventEmitter2{constructor(e){super(),this.gameData=e,this.hasAgainThatNeedsToRun=!1,this.undoStack=[]}setLevel(e){this.undoStack=[],this.gameData.clearCaches();const t=this.gameData.levels[e];if(!t)throw new Error(`Invalid levelNum: ${e}`);i.resetRandomSeed();const s=t.getRows().map(e=>e.map(e=>{const t=new Set(e.getSprites()),s=this.gameData.getMagicBackgroundSprite();return s&&t.add(s),t}));return this._setLevel(s),this.takeSnapshot(this.createSnapshot()),this.getCells()}setMessageLevel(e){this.tempOldLevel=this.currentLevel,this._setLevel(e)}restoreFromMessageLevel(){this.currentLevel=this.tempOldLevel,this.tempOldLevel=null}getCurrentLevel(){if(this.currentLevel)return this.currentLevel;throw new Error("BUG: There is no current level. Maybe it is a message level or maybe setLevel was never called")}toSnapshot(){return this.getCurrentLevel().getCells().map(e=>e.map(e=>{const t=[];return e.getSpriteAndWantsToMoves().forEach((e,s)=>{t.push(`${e} ${s.getName()}`)}),t}))}tick(){"debug"===e.env.LOG_LEVEL&&console.error(""),this.hasAgainThatNeedsToRun&&(this.hasAgainThatNeedsToRun=!1);const t=this.tickNormal();let s=null,n=null,r=!1,i=!1;for(const e of t.commands)switch(e.getType()){case o.COMMAND_TYPE.RESTART:i=!0;break;case o.COMMAND_TYPE.SFX:s=e.getSound();break;case o.COMMAND_TYPE.MESSAGE:this.hasAgainThatNeedsToRun=!1,n=e.getMessage();break;case o.COMMAND_TYPE.WIN:r=!0}return"debug"===e.env.LOG_LEVEL&&console.error("checking win condition."),this.hasAgainThatNeedsToRun&&"debug"===e.env.LOG_LEVEL&&console.error("AGAIN command executed, with changes detected - will execute another turn."),{changedCells:new Set(t.changedCells.keys()),soundToPlay:s,messageToShow:n,hasRestart:i,isWinning:r||this.isWinning()}}hasAgain(){return this.hasAgainThatNeedsToRun}press(e){this.pendingPlayerWantsToMove=e}pressRestart(){const e=this.undoStack[0];this.undoStack.push(e),this.applySnapshot(e)}pressUndo(){const e=this.undoStack.pop();e&&this.undoStack.length>0?this.applySnapshot(e):e&&this.undoStack.push(e)}_setLevel(e){const t=new l;this.currentLevel=t;const s=e.map((e,s)=>e.map((e,n)=>{const o=this.gameData.getMagicBackgroundSprite();return o&&e.add(o),new a(t,e,s,n)}));t.setCells(s);const n=new Map;function o(e){const t=[];for(const s of[...e].map(e=>e.getName()).sort())t.push(s);return t.join(" ")}const r=this.getCells();for(const e of this.gameData.rules)e.addCellsToEmptyRules(r);for(const e of r){const t=o(e.getSpritesAsSet());let s=n.get(t);s||(s=[],n.set(t,s)),s.push(e)}let c=0;for(const[e,t]of n){(n.size>100&&c%10==0||t.length>100)&&this.emit("loading-cells",{cellStart:c,cellEnd:c+t.length,cellTotal:r.length,key:e});for(const e of this.gameData.objects){const s=t[0].getSpritesAsSet().has(e);(s||e.hasNegationTileWithModifier())&&(s?e.addCells(e,t,i.RULE_DIRECTION.STATIONARY):e.removeCells(e,t))}c+=t.length}return t}getCells(){return i._flatten(this.getCurrentLevel().getCells())}tickUpdateCells(){return"debug"===e.env.LOG_LEVEL&&console.error("applying rules"),this._tickUpdateCells(this.gameData.rules.filter(e=>!e.isLate()))}tickUpdateCellsLate(){return"debug"===e.env.LOG_LEVEL&&console.error("applying late rules"),this._tickUpdateCells(this.gameData.rules.filter(e=>e.isLate()))}_tickUpdateCells(e){const t=new Set,s=[];if(!this.currentLevel)throw new Error("BUG: Level Cells do not exist yet");for(const n of e){const e=n.evaluate(this.currentLevel,!1);e.length>0&&s.push(n);for(const s of e)t.add(s)}const n=new Set,o=new Set;for(const e of t)e.hasCell()?n.add(e.getCell()):o.add(e.getCommand());return{evaluatedRules:s,changedCells:n,commands:o}}tickMoveSprites(e){const t=new Set;let s;do{s=!1;for(const n of e)for(const[e,o]of n.getSpriteAndWantsToMoves())switch(o){case i.RULE_DIRECTION.STATIONARY:break;case i.RULE_DIRECTION.ACTION:s=!0,n.clearWantsToMove(e);break;case i.RULE_DIRECTION.UP:case i.RULE_DIRECTION.DOWN:case i.RULE_DIRECTION.LEFT:case i.RULE_DIRECTION.RIGHT:const r=n.getNeighbor(o);r&&!r.hasCollisionWithSprite(e)&&(n.removeSprite(e),r.addSprite(e,i.RULE_DIRECTION.STATIONARY),t.add(r),t.add(n),s=!0);break;default:throw new Error("BUG: wantsToMove should have been handled earlier")}}while(s);for(const t of e)for(const[e]of t.getSpriteAndWantsToMoves())t.clearWantsToMove(e);return t}tickNormal(){let t=new Set;const s=this.createSnapshot();if(this.pendingPlayerWantsToMove){this.takeSnapshot(s),"debug"===e.env.LOG_LEVEL&&(console.error("======================="),console.error(`Turn starts with input of ${this.pendingPlayerWantsToMove.toLowerCase()}.`));const n=this.gameData.getPlayer();for(const e of n.getCellsThatMatch())for(const s of n.getSpritesThatMatch(e))e.updateSprite(s,this.pendingPlayerWantsToMove),t.add(e);this.pendingPlayerWantsToMove=null}else"debug"===e.env.LOG_LEVEL&&console.error("Turn starts with no input.");const{changedCells:n,evaluatedRules:r,commands:a}=this.tickUpdateCells();t=i.setAddAll(t,n);const l=this.tickMoveSprites(new Set(t.keys())),{changedCells:c,evaluatedRules:p,commands:h}=this.tickUpdateCellsLate(),m=[...a,...h];if(!!m.filter(e=>e.getType()===o.COMMAND_TYPE.CANCEL)[0])return this.hasAgainThatNeedsToRun=!1,this.undoStack.length>0&&this.applySnapshot(this.undoStack[this.undoStack.length-1]),{changedCells:new Set,commands:new Set,evaluatedRules:r};!!m.find(e=>e.getType()===o.COMMAND_TYPE.CHECKPOINT)&&(this.undoStack=[],this.takeSnapshot(this.createSnapshot()));const u=i.setAddAll(i.setAddAll(t,c),l);return m.find(e=>e.getType()===o.COMMAND_TYPE.AGAIN)&&(this.hasAgainThatNeedsToRun=this.doSnapshotsDiffer(s,this.createSnapshot())),{changedCells:u,evaluatedRules:r.concat(p),commands:m}}isWinning(){let e=this.gameData.winConditions.length>0;return this.gameData.winConditions.forEach(t=>{t.isSatisfied(this.getCells())||(e=!1)}),e}createSnapshot(){return this.getCurrentLevel().getCells().map(e=>e.map(e=>e.toSnapshot()))}takeSnapshot(e){this.undoStack.push(e)}applySnapshot(e){const t=this.getCurrentLevel().getCells();for(let s=0;s<t.length;s++){const n=t[s],o=e[s];for(let e=0;e<n.length;e++){const t=n[e],s=o[e];t.fromSnapshot(s)}}}doSnapshotsDiffer(e,t){for(let s=0;s<e.length;s++)for(let n=0;n<e[0].length;n++){const o=e[s][n],r=t[s][n];if(!i.setEquals(o,r))return!0}return!1}}t.LevelEngine=c;t.GameEngine=class{constructor(e){this.isFirstTick=!0,this.currentLevelNum=-1234567,this.messageShownAndWaitingForActionPress=!1,this.levelEngine=new c(e),this.messageShownAndWaitingForActionPress=!1}on(e,t){this.levelEngine.on(e,t)}getGameData(){return this.levelEngine.gameData}getCurrentLevelCells(){return this.levelEngine.getCurrentLevel().getCells()}getCurrentLevel(){return this.getGameData().levels[this.getCurrentLevelNum()]}getCurrentLevelNum(){return this.currentLevelNum}hasAgain(){return this.levelEngine.hasAgain()}setLevel(e){this.messageShownAndWaitingForActionPress=!1,this.levelEngine.hasAgainThatNeedsToRun=!1,this.getGameData().levels[e].isMap()&&(this.isFirstTick=!0,this.levelEngine.setLevel(e)),this.currentLevelNum=e}tick(){if(!this.getCurrentLevel().isMap()){let e=!1,t=!1;return this.levelEngine.pendingPlayerWantsToMove===i.RULE_DIRECTION.ACTION&&(t=!0,this.currentLevelNum===this.levelEngine.gameData.levels.length-1?e=!0:this.setLevel(this.currentLevelNum+1)),this.levelEngine.pendingPlayerWantsToMove=null,{changedCells:new Set,soundToPlay:null,messageToShow:null,didWinGame:e,didLevelChange:t,wasAgainTick:!1}}const e=this.levelEngine.hasAgain();if(this.levelEngine.gameData.metadata.runRulesOnLevelStart&&this.isFirstTick);else if(!e&&!this.levelEngine.gameData.metadata.realtimeInterval&&!this.levelEngine.pendingPlayerWantsToMove)return{changedCells:new Set,soundToPlay:null,messageToShow:null,didWinGame:!1,didLevelChange:!1,wasAgainTick:!1};if(this.messageShownAndWaitingForActionPress)return this.levelEngine.pendingPlayerWantsToMove===i.RULE_DIRECTION.ACTION?(this.messageShownAndWaitingForActionPress=!1,this.levelEngine.pendingPlayerWantsToMove=null,{changedCells:new Set(i._flatten(this.getCurrentLevelCells())),soundToPlay:null,messageToShow:null,didWinGame:!1,didLevelChange:!1,wasAgainTick:!1}):{changedCells:new Set,soundToPlay:null,messageToShow:null,didWinGame:!1,didLevelChange:!1,wasAgainTick:!1};const{changedCells:t,soundToPlay:s,messageToShow:n,isWinning:o,hasRestart:r}=this.levelEngine.tick();if(this.isFirstTick=!1,r)return this.pressRestart(),{changedCells:new Set(i._flatten(this.getCurrentLevelCells())),soundToPlay:null,messageToShow:null,didWinGame:!1,didLevelChange:!1,wasAgainTick:!1};let a=!1;return o&&(this.currentLevelNum===this.levelEngine.gameData.levels.length-1?a=!0:this.setLevel(this.currentLevelNum+1)),n&&(this.messageShownAndWaitingForActionPress=!0),{changedCells:t,soundToPlay:s,messageToShow:n,didWinGame:a,didLevelChange:o,wasAgainTick:e}}press(e){return this.levelEngine.press(e)}pressUp(){this.levelEngine.press(i.RULE_DIRECTION.UP)}pressDown(){this.levelEngine.press(i.RULE_DIRECTION.DOWN)}pressLeft(){this.levelEngine.press(i.RULE_DIRECTION.LEFT)}pressRight(){this.levelEngine.press(i.RULE_DIRECTION.RIGHT)}pressAction(){this.levelEngine.press(i.RULE_DIRECTION.ACTION)}pressRestart(){this.isFirstTick=!0,this.levelEngine.pressRestart()}pressUndo(){this.messageShownAndWaitingForActionPress=!1,this.levelEngine.pressUndo()}getSpriteSize(){return this.getGameData().getSpriteSize()}saveSnapshotToJSON(){return this.getCurrentLevelCells().map(e=>e.map(e=>[...e.toSnapshot()].map(e=>e.getName())))}loadSnapshotFromJSON(e){e.forEach((e,t)=>{e.forEach((e,s)=>{const n=this.levelEngine.getCurrentLevel().getCell(t,s),o=e.map(e=>{const t=this.getGameData()._getSpriteByName(e);if(t)return t;throw new Error(`BUG: Could not find sprite to add named ${e}`)});n.fromSnapshot(new Set(o))})})}setMessageLevel(e){this.levelEngine.setMessageLevel(e)}restoreFromMessageLevel(){this.levelEngine.restoreFromMessageLevel()}}}).call(this,s(3))},function(e,t,s){(function(n){var o;
/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */!function(r){var i=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=10;function l(){this._events={},this._conf&&c.call(this,this._conf)}function c(e){e?(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),this._maxListeners=e.maxListeners!==r?e.maxListeners:a,e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._maxListeners=a}function p(e,t){var s="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(s+=" Event name: "+t+"."),void 0!==n&&n.emitWarning){var o=new Error(s);o.name="MaxListenersExceededWarning",o.emitter=this,o.count=e,n.emitWarning(o)}else console.error(s),console.trace&&console.trace()}function h(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,c.call(this,e)}function m(e,t,s,n){if(!s)return[];var o,r,i,a,l,c,p,h=[],u=t.length,f=t[n],$=t[n+1];if(n===u&&s._listeners){if("function"==typeof s._listeners)return e&&e.push(s._listeners),[s];for(o=0,r=s._listeners.length;o<r;o++)e&&e.push(s._listeners[o]);return[s]}if("*"===f||"**"===f||s[f]){if("*"===f){for(i in s)"_listeners"!==i&&s.hasOwnProperty(i)&&(h=h.concat(m(e,t,s[i],n+1)));return h}if("**"===f){for(i in(p=n+1===u||n+2===u&&"*"===$)&&s._listeners&&(h=h.concat(m(e,t,s,u))),s)"_listeners"!==i&&s.hasOwnProperty(i)&&("*"===i||"**"===i?(s[i]._listeners&&!p&&(h=h.concat(m(e,t,s[i],u))),h=h.concat(m(e,t,s[i],n))):h=i===$?h.concat(m(e,t,s[i],n+2)):h.concat(m(e,t,s[i],n)));return h}h=h.concat(m(e,t,s[f],n+1))}if((a=s["*"])&&m(e,t,a,n+1),l=s["**"])if(n<u)for(i in l._listeners&&m(e,t,l,u),l)"_listeners"!==i&&l.hasOwnProperty(i)&&(i===$?m(e,t,l[i],n+2):i===f?m(e,t,l[i],n+1):((c={})[i]=l[i],m(e,t,{"**":c},n+1)));else l._listeners?m(e,t,l,u):l["*"]&&l["*"]._listeners&&m(e,t,l["*"],u);return h}h.EventEmitter2=h,h.prototype.delimiter=".",h.prototype.setMaxListeners=function(e){e!==r&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},h.prototype.event="",h.prototype.once=function(e,t){return this._once(e,t,!1)},h.prototype.prependOnceListener=function(e,t){return this._once(e,t,!0)},h.prototype._once=function(e,t,s){return this._many(e,1,t,s),this},h.prototype.many=function(e,t,s){return this._many(e,t,s,!1)},h.prototype.prependMany=function(e,t,s){return this._many(e,t,s,!0)},h.prototype._many=function(e,t,s,n){var o=this;if("function"!=typeof s)throw new Error("many only accepts instances of Function");function r(){return 0==--t&&o.off(e,r),s.apply(this,arguments)}return r._origin=s,this._on(e,r,n),o},h.prototype.emit=function(){this._events||l.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return!1;var t,s,n,o,r,i=arguments.length;if(this._all&&this._all.length){if(r=this._all.slice(),i>3)for(t=new Array(i),o=0;o<i;o++)t[o]=arguments[o];for(n=0,s=r.length;n<s;n++)switch(this.event=e,i){case 1:r[n].call(this,e);break;case 2:r[n].call(this,e,arguments[1]);break;case 3:r[n].call(this,e,arguments[1],arguments[2]);break;default:r[n].apply(this,t)}}if(this.wildcard){r=[];var a="string"==typeof e?e.split(this.delimiter):e.slice();m.call(this,r,a,this.listenerTree,0)}else{if("function"==typeof(r=this._events[e])){switch(this.event=e,i){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(i-1),o=1;o<i;o++)t[o-1]=arguments[o];r.apply(this,t)}return!0}r&&(r=r.slice())}if(r&&r.length){if(i>3)for(t=new Array(i-1),o=1;o<i;o++)t[o-1]=arguments[o];for(n=0,s=r.length;n<s;n++)switch(this.event=e,i){case 1:r[n].call(this);break;case 2:r[n].call(this,arguments[1]);break;case 3:r[n].call(this,arguments[1],arguments[2]);break;default:r[n].apply(this,t)}return!0}if(!this._all&&"error"===e)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},h.prototype.emitAsync=function(){this._events||l.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);var t,s,n,o,r,i=[],a=arguments.length;if(this._all){if(a>3)for(t=new Array(a),o=1;o<a;o++)t[o]=arguments[o];for(n=0,s=this._all.length;n<s;n++)switch(this.event=e,a){case 1:i.push(this._all[n].call(this,e));break;case 2:i.push(this._all[n].call(this,e,arguments[1]));break;case 3:i.push(this._all[n].call(this,e,arguments[1],arguments[2]));break;default:i.push(this._all[n].apply(this,t))}}if(this.wildcard){r=[];var c="string"==typeof e?e.split(this.delimiter):e.slice();m.call(this,r,c,this.listenerTree,0)}else r=this._events[e];if("function"==typeof r)switch(this.event=e,a){case 1:i.push(r.call(this));break;case 2:i.push(r.call(this,arguments[1]));break;case 3:i.push(r.call(this,arguments[1],arguments[2]));break;default:for(t=new Array(a-1),o=1;o<a;o++)t[o-1]=arguments[o];i.push(r.apply(this,t))}else if(r&&r.length){if(r=r.slice(),a>3)for(t=new Array(a-1),o=1;o<a;o++)t[o-1]=arguments[o];for(n=0,s=r.length;n<s;n++)switch(this.event=e,a){case 1:i.push(r[n].call(this));break;case 2:i.push(r[n].call(this,arguments[1]));break;case 3:i.push(r[n].call(this,arguments[1],arguments[2]));break;default:i.push(r[n].apply(this,t))}}else if(!this._all&&"error"===e)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(i)},h.prototype.on=function(e,t){return this._on(e,t,!1)},h.prototype.prependListener=function(e,t){return this._on(e,t,!0)},h.prototype.onAny=function(e){return this._onAny(e,!1)},h.prototype.prependAny=function(e){return this._onAny(e,!0)},h.prototype.addListener=h.prototype.on,h.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},h.prototype._on=function(e,t,s){if("function"==typeof e)return this._onAny(e,t),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");return this._events||l.call(this),this._newListener&&this.emit("newListener",e,t),this.wildcard?(function(e,t){for(var s=0,n=(e="string"==typeof e?e.split(this.delimiter):e.slice()).length;s+1<n;s++)if("**"===e[s]&&"**"===e[s+1])return;for(var o=this.listenerTree,i=e.shift();i!==r;){if(o[i]||(o[i]={}),o=o[i],0===e.length)return o._listeners?("function"==typeof o._listeners&&(o._listeners=[o._listeners]),o._listeners.push(t),!o._listeners.warned&&this._maxListeners>0&&o._listeners.length>this._maxListeners&&(o._listeners.warned=!0,p.call(this,o._listeners.length,i))):o._listeners=t,!0;i=e.shift()}return!0}.call(this,e,t),this):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),s?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,p.call(this,this._events[e].length,e))):this._events[e]=t,this)},h.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var s,n=[];if(this.wildcard){var o="string"==typeof e?e.split(this.delimiter):e.slice();n=m.call(this,null,o,this.listenerTree,0)}else{if(!this._events[e])return this;s=this._events[e],n.push({_listeners:s})}for(var a=0;a<n.length;a++){var l=n[a];if(s=l._listeners,i(s)){for(var c=-1,p=0,h=s.length;p<h;p++)if(s[p]===t||s[p].listener&&s[p].listener===t||s[p]._origin&&s[p]._origin===t){c=p;break}if(c<0)continue;return this.wildcard?l._listeners.splice(c,1):this._events[e].splice(c,1),0===s.length&&(this.wildcard?delete l._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(s===t||s.listener&&s.listener===t||s._origin&&s._origin===t)&&(this.wildcard?delete l._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return function e(t){if(t!==r){var s=Object.keys(t);for(var n in s){var o=s[n],i=t[o];i instanceof Function||"object"!=typeof i||null===i||(Object.keys(i).length>0&&e(t[o]),0===Object.keys(i).length&&delete t[o])}}}(this.listenerTree),this},h.prototype.offAny=function(e){var t,s=0,n=0;if(e&&this._all&&this._all.length>0){for(s=0,n=(t=this._all).length;s<n;s++)if(e===t[s])return t.splice(s,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(s=0,n=t.length;s<n;s++)this.emit("removeListenerAny",t[s]);this._all=[]}return this},h.prototype.removeListener=h.prototype.off,h.prototype.removeAllListeners=function(e){if(e===r)return!this._events||l.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),s=m.call(this,null,t,this.listenerTree,0),n=0;n<s.length;n++){s[n]._listeners=null}else this._events&&(this._events[e]=null);return this},h.prototype.listeners=function(e){if(this.wildcard){var t=[],s="string"==typeof e?e.split(this.delimiter):e.slice();return m.call(this,t,s,this.listenerTree,0),t}return this._events||l.call(this),this._events[e]||(this._events[e]=[]),i(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},h.prototype.eventNames=function(){return Object.keys(this._events)},h.prototype.listenerCount=function(e){return this.listeners(e).length},h.prototype.listenersAny=function(){return this._all?this._all:[]},(o=function(){return h}.call(t,s,t,e))===r||(e.exports=o)}()}).call(this,s(3))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(5),o=s(10),r=new Map;function i(e,t,s){return new o.GameSpritePixels(e,`letterchar="${t}"`,"",[new n.HexColor(e,"#000000"),new n.HexColor(e,"#ffffff")],s)}function a(e,t){r.set(e,t)}t.getLetterSprites=function(e){const t=new Map;for(const[s,n]of r.entries()){const o=i(e,s,n);t.set(s,o)}return t},a("a",[[0,0,0,0,0],[0,1,1,1,0],[1,0,0,1,0],[1,0,0,1,0],[0,1,1,1,0]]),a("b",[[1,0,0,0,0],[1,0,0,0,0],[1,1,1,0,0],[1,0,0,1,0],[0,1,1,0,0]]),a("c",[[0,0,0,0,0],[0,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[0,1,1,1,0]]),a("d",[[0,0,0,1,0],[0,0,0,1,0],[0,1,1,1,0],[1,0,0,1,0],[0,1,1,0,0]]),a("e",[[0,1,1,0,0],[1,0,0,1,0],[1,1,1,0,0],[1,0,0,0,0],[0,1,1,0,0]]),a("f",[[0,0,0,0,0],[0,0,1,1,0],[0,1,0,0,0],[1,1,1,0,0],[0,1,0,0,0]]),a("g",[[0,1,1,0,0],[1,0,0,1,0],[0,1,1,1,0],[0,0,0,1,0],[0,1,1,0,0]]),a("h",[[1,0,0,0,0],[1,0,0,0,0],[1,1,1,0,0],[1,0,0,1,0],[1,0,0,1,0]]),a("i",[[0,0,1,0,0],[0,0,0,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,1,1,1,0]]),a("j",[[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0],[1,0,1,0,0],[0,1,0,0,0]]),a("k",[[1,0,0,0,0],[1,0,0,1,0],[1,1,1,0,0],[1,0,0,1,0],[1,0,0,1,0]]),a("l",[[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,1,0],[0,1,1,0,0]]),a("m",[[0,0,0,0,0],[0,1,0,1,0],[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1]]),a("n",[[0,0,0,0,0],[0,1,1,0,0],[1,0,0,1,0],[1,0,0,1,0],[1,0,0,1,0]]),a("o",[[0,0,0,0,0],[0,1,1,0,0],[1,0,0,1,0],[1,0,0,1,0],[0,1,1,0,0]]),a("p",[[0,0,0,0,0],[0,1,1,0,0],[1,0,0,1,0],[1,1,1,0,0],[1,0,0,0,0]]),a("q",[[0,0,0,0,0],[0,1,1,0,0],[1,0,0,1,0],[0,1,1,1,0],[0,0,0,1,0]]),a("r",[[0,0,0,0,0],[0,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0]]),a("s",[[0,1,1,1,0],[1,0,0,0,0],[0,1,1,0,0],[0,0,0,1,0],[1,1,1,0,0]]),a("t",[[0,1,0,0,0],[1,1,1,0,0],[0,1,0,0,0],[0,1,0,0,1],[0,0,1,1,0]]),a("u",[[0,0,0,0,0],[1,0,0,1,0],[1,0,0,1,0],[1,0,0,1,0],[1,1,1,0,0]]),a("v",[[0,0,0,0,0],[1,0,0,1,0],[1,0,1,0,0],[1,1,0,0,0],[1,0,0,0,0]]),a("w",[[0,0,0,0,0],[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1],[0,1,0,1,0]]),a("x",[[0,0,0,0,0],[1,0,0,1,0],[0,1,1,0,0],[0,1,1,0,0],[1,0,0,1,0]]),a("y",[[1,0,0,1,0],[1,0,0,1,0],[0,1,1,1,0],[0,0,0,1,0],[1,1,1,0,0]]),a("z",[[0,0,0,0,0],[1,1,1,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,1,1,1,0]]),a("A",[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1]]),a("B",[[1,1,1,1,0],[1,0,0,0,1],[1,1,1,1,0],[1,0,0,0,1],[1,1,1,1,0]]),a("C",[[1,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,1]]),a("D",[[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0]]),a("E",[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1]]),a("F",[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0]]),a("G",[[0,1,1,1,1],[1,0,0,0,0],[1,0,0,1,1],[1,0,0,0,1],[0,1,1,1,1]]),a("H",[[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1]]),a("I",[[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1]]),a("J",[[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[1,1,1,0,0]]),a("K",[[1,0,0,0,1],[1,0,1,1,0],[1,1,0,0,0],[1,0,1,1,0],[1,0,0,0,1]]),a("L",[[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,1]]),a("M",[[1,1,1,1,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1]]),a("N",[[1,0,0,0,1],[1,1,0,0,1],[1,0,1,0,1],[1,0,0,1,1],[1,0,0,0,1]]),a("O",[[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1]]),a("P",[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0]]),a("Q",[[1,1,1,1,1],[1,0,0,0,1],[1,1,1,1,1],[0,0,0,0,1],[0,0,0,0,1]]),a("R",[[1,1,1,1,0],[1,0,0,0,1],[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1]]),a("S",[[0,1,1,1,1],[1,0,0,0,0],[0,1,1,1,0],[0,0,0,0,1],[1,1,1,1,0]]),a("T",[[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]]),a("U",[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1]]),a("V",[[1,0,0,0,1],[0,1,0,1,0],[0,1,0,1,0],[0,0,1,0,0],[0,0,1,0,0]]),a("W",[[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1],[0,1,0,1,0]]),a("X",[[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,1,0,1,0],[1,0,0,0,1]]),a("Y",[[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]]),a("Z",[[1,1,1,1,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,1,1,1,1]]),a("0",[[1,1,1,1,1],[1,0,0,1,1],[1,0,1,0,1],[1,1,0,0,1],[1,1,1,1,1]]),a("1",[[1,1,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1]]),a("2",[[1,1,1,1,1],[0,0,0,0,1],[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,1]]),a("3",[[1,1,1,1,0],[0,0,0,0,1],[0,0,1,1,0],[0,0,0,0,1],[1,1,1,1,0]]),a("4",[[1,0,0,0,0],[1,0,0,0,0],[1,0,0,1,0],[1,1,1,1,1],[0,0,0,1,0]]),a("5",[[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,0],[0,0,0,0,1],[1,1,1,1,0]]),a("6",[[0,1,1,1,0],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,1],[0,1,1,1,0]]),a("7",[[1,1,1,1,1],[0,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0]]),a("8",[[0,1,1,1,0],[1,0,0,0,1],[0,1,1,1,0],[1,0,0,0,1],[0,1,1,1,0]]),a("9",[[0,1,1,1,0],[1,0,0,0,1],[0,1,1,1,1],[0,0,0,0,1],[0,1,1,1,0]]),a(".",[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0]]),a(",",[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,1,1,0,0]]),a(";",[[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,1,1,0,0]]),a(":",[[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0]]),a("?",[[0,1,1,1,0],[1,0,0,0,1],[0,0,1,1,0],[0,0,1,0,0],[0,0,1,0,0]]),a("!",[[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0]]),a("@",[[0,1,1,1,0],[1,0,0,0,1],[1,0,1,1,1],[1,0,0,0,0],[0,1,1,1,0]]),a("£",[[0,1,1,1,0],[0,1,0,0,1],[1,1,1,0,0],[0,1,0,0,0],[1,1,1,1,1]]),a("$",[[0,1,1,1,1],[1,0,1,0,0],[0,1,1,1,0],[0,0,1,0,1],[1,1,1,1,0]]),a("%",[[1,1,0,0,1],[1,1,0,1,0],[0,0,1,0,0],[0,1,0,1,1],[1,0,0,1,1]]),a("^",[[0,0,1,0,0],[0,1,0,1,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]),a("&",[[0,1,1,0,0],[1,0,0,0,0],[0,1,0,1,1],[1,0,0,1,0],[0,1,1,0,0]]),a("*",[[0,1,0,1,0],[0,0,1,0,0],[0,1,0,1,0],[0,0,0,0,0],[0,0,0,0,0]]),a("(",[[0,0,0,1,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,1,0]]),a(")",[[0,1,0,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,1,0,0,0]]),a("+",[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]]),a("-",[[0,0,0,0,0],[0,0,0,0,0],[0,1,1,1,0],[0,0,0,0,0],[0,0,0,0,0]]),a("_",[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,1]]),a("=",[[0,0,0,0,0],[1,1,1,1,1],[0,0,0,0,0],[1,1,1,1,1],[0,0,0,0,0]]),a(" ",[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]),a("{",[[0,0,1,1,0],[0,0,1,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,0,1,1,0]]),a("}",[[0,1,1,0,0],[0,0,1,0,0],[0,0,1,1,0],[0,0,1,0,0],[0,1,1,0,0]]),a("[",[[0,0,1,1,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,1,0]]),a("]",[[0,1,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,1,1,0,0]]),a("'",[[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]),a('"',[[0,1,0,1,0],[0,1,0,1,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]),a("/",[[0,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,0,0,0,0]]),a("\\",[[1,0,0,0,0],[0,1,0,0,0],[0,0,1,0,0],[0,0,0,1,0],[0,0,0,0,1]]),a("|",[[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]]),a("<",[[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[0,0,1,0,0],[0,0,0,1,0]]),a(">",[[0,1,0,0,0],[0,0,1,0,0],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0]]),a("~",[[0,0,0,0,0],[0,1,0,0,0],[1,0,1,0,1],[0,0,0,1,0],[0,0,0,0,0]]),a("`",[[0,1,0,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]),a("#",[[0,1,0,1,0],[1,1,1,1,1],[0,1,0,1,0],[1,1,1,1,1],[0,1,0,1,0]])},function(e,t){!function(t,s){"object"==typeof e&&e.exports?e.exports=s():t.nearley=s()}(this,function(){function e(t,s,n){return this.id=++e.highestId,this.name=t,this.symbols=s,this.postprocess=n,this}function t(e,t,s,n){this.rule=e,this.dot=t,this.reference=s,this.data=[],this.wantedBy=n,this.isComplete=this.dot===e.symbols.length}function s(e,t){this.grammar=e,this.index=t,this.states=[],this.wants={},this.scannable=[],this.completed={}}function n(e,t){this.rules=e,this.start=t||this.rules[0].name;var s=this.byName={};this.rules.forEach(function(e){s.hasOwnProperty(e.name)||(s[e.name]=[]),s[e.name].push(e)})}function o(){this.reset("")}function r(e,t,r){if(e instanceof n){var i=e;r=t}else i=n.fromCompiled(e,t);for(var a in this.grammar=i,this.options={keepHistory:!1,lexer:i.lexer||new o},r||{})this.options[a]=r[a];this.lexer=this.options.lexer,this.lexerState=void 0;var l=new s(i,0);this.table=[l];l.wants[i.start]=[],l.predict(i.start),l.process(),this.current=0}return e.highestId=0,e.prototype.toString=function(e){function t(e){return e.literal?JSON.stringify(e.literal):e.type?"%"+e.type:e.toString()}var s=void 0===e?this.symbols.map(t).join(" "):this.symbols.slice(0,e).map(t).join(" ")+" ● "+this.symbols.slice(e).map(t).join(" ");return this.name+" → "+s},t.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},t.prototype.nextState=function(e){var s=new t(this.rule,this.dot+1,this.reference,this.wantedBy);return s.left=this,s.right=e,s.isComplete&&(s.data=s.build()),s},t.prototype.build=function(){var e=[],t=this;do{e.push(t.right.data),t=t.left}while(t.left);return e.reverse(),e},t.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,r.fail))},s.prototype.process=function(e){for(var t=this.states,s=this.wants,n=this.completed,o=0;o<t.length;o++){var i=t[o];if(i.isComplete){if(i.finish(),i.data!==r.fail){for(var a=i.wantedBy,l=a.length;l--;){var c=a[l];this.complete(c,i)}if(i.reference===this.index){var p=i.rule.name;(this.completed[p]=this.completed[p]||[]).push(i)}}}else{if("string"!=typeof(p=i.rule.symbols[i.dot])){this.scannable.push(i);continue}if(s[p]){if(s[p].push(i),n.hasOwnProperty(p)){var h=n[p];for(l=0;l<h.length;l++){var m=h[l];this.complete(i,m)}}}else s[p]=[i],this.predict(p)}}},s.prototype.predict=function(e){for(var s=this.grammar.byName[e]||[],n=0;n<s.length;n++){var o=s[n],r=this.wants[e],i=new t(o,0,this.index,r);this.states.push(i)}},s.prototype.complete=function(e,t){var s=e.nextState(t);this.states.push(s)},n.fromCompiled=function(t,s){var o=t.Lexer;t.ParserStart&&(s=t.ParserStart,t=t.ParserRules);var r=new n(t=t.map(function(t){return new e(t.name,t.symbols,t.postprocess)}),s);return r.lexer=o,r},o.prototype.reset=function(e,t){this.buffer=e,this.index=0,this.line=t?t.line:1,this.lastLineBreak=t?-t.col:0},o.prototype.next=function(){if(this.index<this.buffer.length){var e=this.buffer[this.index++];return"\n"===e&&(this.line+=1,this.lastLineBreak=this.index),{value:e}}},o.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},o.prototype.formatError=function(e,t){var s=this.buffer;if("string"==typeof s){var n=s.indexOf("\n",this.index);-1===n&&(n=s.length);var o=s.substring(this.lastLineBreak,n),r=this.index-this.lastLineBreak;return t+=" at line "+this.line+" col "+r+":\n\n",t+="  "+o+"\n",t+="  "+Array(r).join(" ")+"^"}return t+" at index "+(this.index-1)},r.fail={},r.prototype.feed=function(e){var t,n=this.lexer;for(n.reset(e,this.lexerState);t=n.next();){var r=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var i=this.current+1,a=new s(this.grammar,i);this.table.push(a);for(var l=void 0!==t.text?t.text:t.value,c=n.constructor===o?t.value:t,p=r.scannable,h=p.length;h--;){var m=p[h],u=m.rule.symbols[m.dot];if(u.test?u.test(c):u.type?u.type===t.type:u.literal===l){var f=m.nextState({data:c,token:t,isToken:!0,reference:i-1});a.states.push(f)}}if(a.process(),0===a.states.length){var $=this.lexer.formatError(t,"invalid syntax")+"\n";$+="Unexpected "+(t.type?t.type+" token: ":""),$+=JSON.stringify(void 0!==t.value?t.value:t)+"\n";var b=new Error($);throw b.offset=this.current,b.token=t,b}this.options.keepHistory&&(r.lexerState=n.save()),this.current++}return r&&(this.lexerState=n.save()),this.results=this.finish(),this},r.prototype.save=function(){var e=this.table[this.current];return e.lexerState=this.lexerState,e},r.prototype.restore=function(e){var t=e.index;this.current=t,this.table[t]=e,this.table.splice(t+1),this.lexerState=e.lexerState,this.results=this.finish()},r.prototype.rewind=function(e){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[e])},r.prototype.finish=function(){var e=[],t=this.grammar.start;return this.table[this.table.length-1].states.forEach(function(s){s.rule.name===t&&s.dot===s.rule.symbols.length&&0===s.reference&&s.data!==r.fail&&e.push(s)}),e.map(function(e){return e.data})},{Parser:r,Grammar:n,Rule:e}})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=["arnecolors","mastersystem","gameboycolour","amiga","arnecolors","famicom","atari","pastel","ega","amstrad","proteus_mellow","proteus_rich","proteus_night","c64","whitingjp"],o=new Map;o.set("mastersystem",{black:"#000000",white:"#FFFFFF",grey:"#555555",darkgrey:"#555500",lightgrey:"#AAAAAA",gray:"#555555",darkgray:"#555500",lightgray:"#AAAAAA",red:"#FF0000",darkred:"#AA0000",lightred:"#FF5555",brown:"#AA5500",darkbrown:"#550000",lightbrown:"#FFAA00",orange:"#FF5500",yellow:"#FFFF55",green:"#55AA00",darkgreen:"#005500",lightgreen:"#AAFF00",blue:"#5555AA",lightblue:"#AAFFFF",darkblue:"#000055",purple:"#550055",pink:"#FFAAFF"}),o.set("gameboycolour",{black:"#000000",white:"#FFFFFF",grey:"#7F7F7C",darkgrey:"#3E3E44",lightgrey:"#BAA7A7",gray:"#7F7F7C",darkgray:"#3E3E44",lightgray:"#BAA7A7",red:"#A7120C",darkred:"#880606",lightred:"#BA381F",brown:"#57381F",darkbrown:"#3E2519",lightbrown:"#8E634B",orange:"#BA4B32",yellow:"#C0BA6F",green:"#517525",darkgreen:"#385D12",lightgreen:"#6F8E44",blue:"#5D6FA7",lightblue:"#8EA7A7",darkblue:"#4B575D",purple:"#3E3E44",pink:"#BA381F"}),o.set("amiga",{black:"#000000",white:"#FFFFFF",grey:"#BBBBBB",darkgrey:"#333333",lightgrey:"#FFEEDD",gray:"#BBBBBB",darkgray:"#333333",lightgray:"#FFEEDD",red:"#DD1111",darkred:"#990000",lightred:"#FF4422",brown:"#663311",darkbrown:"#331100",lightbrown:"#AA6644",orange:"#FF6644",yellow:"#FFDD66",green:"#448811",darkgreen:"#335500",lightgreen:"#88BB77",blue:"#8899DD",lightblue:"#BBDDEE",darkblue:"#666688",purple:"#665555",pink:"#997788"}),o.set("arnecolors",{black:"#000000",white:"#FFFFFF",grey:"#9d9d9d",darkgrey:"#697175",lightgrey:"#cccccc",gray:"#9d9d9d",darkgray:"#697175",lightgray:"#cccccc",red:"#be2633",darkred:"#732930",lightred:"#e06f8b",brown:"#a46422",darkbrown:"#493c2b",lightbrown:"#eeb62f",orange:"#eb8931",yellow:"#f7e26b",green:"#44891a",darkgreen:"#2f484e",lightgreen:"#a3ce27",blue:"#1d57f7",lightblue:"#B2DCEF",darkblue:"#1B2632",purple:"#342a97",pink:"#de65e2"}),o.set("famicom",{black:"#000000",white:"#ffffff",grey:"#7c7c7c",darkgrey:"#080808",lightgrey:"#bcbcbc",gray:"#7c7c7c",darkgray:"#080808",lightgray:"#bcbcbc",red:"#f83800",darkred:"#881400",lightred:"#f87858",brown:"#AC7C00",darkbrown:"#503000",lightbrown:"#FCE0A8",orange:"#FCA044",yellow:"#F8B800",green:"#00B800",darkgreen:"#005800",lightgreen:"#B8F8B8",blue:"#0058F8",lightblue:"#3CBCFC",darkblue:"#0000BC",purple:"#6644FC",pink:"#F878F8"}),o.set("atari",{black:"#000000",white:"#FFFFFF",grey:"#909090",darkgrey:"#404040",lightgrey:"#b0b0b0",gray:"#909090",darkgray:"#404040",lightgray:"#b0b0b0",red:"#A03C50",darkred:"#700014",lightred:"#DC849C",brown:"#805020",darkbrown:"#703400",lightbrown:"#CB9870",orange:"#CCAC70",yellow:"#ECD09C",green:"#58B06C",darkgreen:"#006414",lightgreen:"#70C484",blue:"#1C3C88",lightblue:"#6888C8",darkblue:"#000088",purple:"#3C0080",pink:"#B484DC"}),o.set("pastel",{black:"#000000",white:"#FFFFFF",grey:"#3e3e3e",darkgrey:"#313131",lightgrey:"#9cbcbc",gray:"#3e3e3e",darkgray:"#313131",lightgray:"#9cbcbc",red:"#f56ca2",darkred:"#a63577",lightred:"#ffa9cf",brown:"#b58c53",darkbrown:"#787562",lightbrown:"#B58C53",orange:"#EB792D",yellow:"#FFe15F",green:"#00FF4F",darkgreen:"#2b732c",lightgreen:"#97c04f",blue:"#0f88d3",lightblue:"#00fffe",darkblue:"#293a7b",purple:"#ff6554",pink:"#eb792d"}),o.set("ega",{black:"#000000",white:"#ffffff",grey:"#555555",darkgrey:"#555555",lightgrey:"#aaaaaa",gray:"#555555",darkgray:"#555555",lightgray:"#aaaaaa",red:"#ff5555",darkred:"#aa0000",lightred:"#ff55ff",brown:"#aa5500",darkbrown:"#aa5500",lightbrown:"#ffff55",orange:"#ff5555",yellow:"#ffff55",green:"#00aa00",darkgreen:"#00aaaa",lightgreen:"#55ff55",blue:"#5555ff",lightblue:"#55ffff",darkblue:"#0000aa",purple:"#aa00aa",pink:"#ff55ff"}),o.set("proteus_mellow",{black:"#3d2d2e",white:"#ddf1fc",grey:"#9fb2d4",darkgrey:"#7b8272",lightgrey:"#a4bfda",gray:"#9fb2d4",darkgray:"#7b8272",lightgray:"#a4bfda",red:"#9d5443",darkred:"#8c5b4a",lightred:"#94614c",brown:"#89a78d",darkbrown:"#829e88",lightbrown:"#aaae97",orange:"#d1ba86",yellow:"#d6cda2",green:"#75ac8d",darkgreen:"#8fa67f",lightgreen:"#8eb682",blue:"#88a3ce",lightblue:"#a5adb0",darkblue:"#5c6b8c",purple:"#d39fac",pink:"#c8ac9e"}),o.set("proteus_night",{black:"#010912",white:"#fdeeec",grey:"#051d40",darkgrey:"#091842",lightgrey:"#062151",gray:"#051d40",darkgray:"#091842",lightgray:"#062151",red:"#ad4576",darkred:"#934765",lightred:"#ab6290",brown:"#61646b",darkbrown:"#3d2d2d",lightbrown:"#8393a0",orange:"#0a2227",yellow:"#0a2541",green:"#75ac8d",darkgreen:"#0a2434",lightgreen:"#061f2e",blue:"#0b2c79",lightblue:"#809ccb",darkblue:"#08153b",purple:"#666a87",pink:"#754b4d"}),o.set("proteus_rich",{black:"#6f686f",white:"#d1b1e2",grey:"#b9aac1",darkgrey:"#8e8b84",lightgrey:"#c7b5cd",gray:"#b9aac1",darkgray:"#8e8b84",lightgray:"#c7b5cd",red:"#a11f4f",darkred:"#934765",lightred:"#c998ad",brown:"#89867d",darkbrown:"#797f75",lightbrown:"#ab9997",orange:"#ce8c5c",yellow:"#f0d959",green:"#75bc54",darkgreen:"#599d79",lightgreen:"#90cf5c",blue:"#8fd0ec",lightblue:"#bcdce7",darkblue:"#0b2c70",purple:"#9b377f",pink:"#cd88e5"}),o.set("amstrad",{black:"#000000",white:"#ffffff",grey:"#7f7f7f",darkgrey:"#636363",lightgrey:"#afafaf",gray:"#7f7f7f",darkgray:"#636363",lightgray:"#afafaf",red:"#ff0000",darkred:"#7f0000",lightred:"#ff7f7f",brown:"#ff7f00",darkbrown:"#7f7f00",lightbrown:"#ffff00",orange:"#ff007f",yellow:"#ffff7f",green:"#01ff00",darkgreen:"#007f00",lightgreen:"#7fff7f",blue:"#0000ff",lightblue:"#7f7fff",darkblue:"#00007f",purple:"#7f007f",pink:"#ff7fff"}),o.set("c64",{black:"#000000",white:"#ffffff",grey:"#6C6C6C",darkgrey:"#444444",lightgrey:"#959595",gray:"#6C6C6C",darkgray:"#444444",lightgray:"#959595",red:"#68372B",darkred:"#3f1e17",lightred:"#9A6759",brown:"#433900",darkbrown:"#221c02",lightbrown:"#6d5c0d",orange:"#6F4F25",yellow:"#B8C76F",green:"#588D43",darkgreen:"#345129",lightgreen:"#9AD284",blue:"#6C5EB5",lightblue:"#70A4B2",darkblue:"#352879",purple:"#6F3D86",pink:"#b044ac"}),o.set("whitingjp",{black:"#202527",white:"#eff8fd",grey:"#7b7680",darkgrey:"#3c3b44",lightgrey:"#bed0d7",gray:"#7b7680",darkgray:"#3c3b44",lightgray:"#bed0d7",red:"#bd194b",darkred:"#6b1334",lightred:"#ef2358",brown:"#b52e1c",darkbrown:"#681c12",lightbrown:"#e87b45",orange:"#ff8c10",yellow:"#fbd524",green:"#36bc3c",darkgreen:"#317610",lightgreen:"#8ce062",blue:"#3f62c6",lightblue:"#57bbe0",darkblue:"#2c2fa0",purple:"#7037d9",pink:"#ec2b8f"}),t.lookupColorPalette=function(e,t){let s;s=Number.parseInt(e,10)>=1?n[Number.parseInt(e,10)]:e;const r=o.get(s);if(!r)throw new Error(`BUG: Invalid color palette name or number: "${e}" "${s}"`);return r[t.toLowerCase()]}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(0);t.LevelMap=class extends n.BaseForLines{constructor(e,t){super(e),this.rows=t}isInvalid(){const e=this.rows[0].length;let t=null;return this.rows.forEach((s,n)=>{e!==s.length&&(t=`Row ${n+1} does not have the same column count as the first row. Expected ${e} columns but found ${s.length}.`)}),t}isMap(){return!0}getRows(){return this.rows}getWidth(){return this.rows[0].length}getHeight(){return this.rows.length}getMessage(){throw new Error("BUG: Check .isMap() before calling this")}};t.MessageLevel=class extends n.BaseForLines{constructor(e,t){super(e),this.message=t}isInvalid(){return null}isMap(){return!1}getRows(){throw new Error("BUG: Should have checked isMap first")}getMessage(){return this.message}getWidth(){throw new Error("BUG: Should have checked isMap first")}getHeight(){throw new Error("BUG: Should have checked isMap first")}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Dimension=class{constructor(e,t){this.width=e,this.height=t}};t.GameMetadata=class{constructor(){this.noAction=!1,this.noUndo=!1,this.noRepeatAction=!1,this.throttleMovement=!1,this.noRestart=!1,this.requirePlayerMovement=!1,this.verboseLogging=!1}_setValue(e,t){switch(e.toLowerCase()){case"author":this.author=t;break;case"homepage":this.homepage=t;break;case"youtube":this.youtube=t;break;case"zoomscreen":this.zoomscreen=t;break;case"flickscreen":this.flickscreen=t;break;case"color_palette":this.colorPalette=t;break;case"background_color":this.backgroundColor=t;break;case"text_color":this.textColor=t;break;case"realtime_interval":this.realtimeInterval=t;break;case"key_repeat_interval":this.keyRepeatInterval=t;break;case"again_interval":this.againInterval=t;break;case"noaction":this.noAction=t;break;case"noundo":this.noUndo=t;break;case"run_rules_on_level_start":this.runRulesOnLevelStart=t;break;case"norepeat_action":this.noRepeatAction=t;break;case"throttle_movement":this.throttleMovement=t;break;case"norestart":this.noRestart=t;break;case"require_player_movement":this.requirePlayerMovement=t;break;case"verbose_logging":this.verboseLogging=t;break;default:throw new Error(`BUG: Unsupported config field "${e}" with value "${t}"`)}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(0);class o extends n.BaseForLines{constructor(e,t){super(e),this.soundCode=t}}t.GameSound=o;t.GameSoundSfx=class extends o{constructor(e,t,s){super(e,s),this.sfxName=t}};t.GameSoundSimpleEnum=class extends o{constructor(e,t,s){super(e,s),this.simpleEventName=t}};t.GameSoundNormal=class extends o{constructor(e,t,s,n){super(e,n),this.tile=t,this.conditionEnum=s}};t.GameSoundMoveSimple=class extends o{constructor(e,t,s){super(e,s),this.tile=t}};t.GameSoundMoveDirection=class extends o{constructor(e,t,s,n){super(e,n),this.tile=t,this.directionEnum=s}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(0);var o;!function(e){e.NO="NO",e.ALL="ALL",e.ANY="ANY",e.SOME="SOME"}(o=t.WIN_QUALIFIER||(t.WIN_QUALIFIER={}));class r extends n.BaseForLines{constructor(e,t,s){if(super(e),this.qualifier=t,this.tile=s,!s)throw new Error("BUG: Could not find win condition tile")}cellsThatMatchTile(e,t){return[...e].filter(e=>t.matchesCell(e))}isSatisfied(e){const t=this._isSatisfied(e);return t}_isSatisfied(e){const t=this.cellsThatMatchTile(e,this.tile);switch(this.qualifier){case o.NO:return 0===t.length;case o.ANY:case o.SOME:return t.length>0;default:throw new Error(`BUG: Invalid qualifier: "${this.qualifier}"`)}}}t.WinConditionSimple=r;t.WinConditionOn=class extends r{constructor(e,t,s,n){super(e,t,s),this.onTile=n}_isSatisfied(e){const t=this.cellsThatMatchTile(e,this.tile),s=this.cellsThatMatchTile(t,this.onTile);switch(this.qualifier){case o.NO:return 0===s.length;case o.ANY:case o.SOME:return s.length>0;case o.ALL:return s.length===t.length;default:throw new Error(`BUG: Invalid qualifier: "${this.qualifier}"`)}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(0),o=s(25),r=s(1);var i;!function(e){e.RANDOM="RANDOM",e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT",e.VERTICAL="VERTICAL",e.HORIZONTAL="HORIZONTAL",e.ORTHOGONAL="ORTHOGONAL",e.PERPENDICULAR="PERPENDICULAR",e.PARALLEL="PARALLEL",e.MOVING="MOVING",e.LATE="LATE",e.RIGID="RIGID"}(i=t.AST_RULE_MODIFIER||(t.AST_RULE_MODIFIER={}));const a=[r.RULE_DIRECTION.UP,r.RULE_DIRECTION.DOWN,r.RULE_DIRECTION.LEFT,r.RULE_DIRECTION.RIGHT],l=new Set(a);function c(e,t){const s=t.toKey();return e.has(s)||e.set(s,t),e.get(s)}class p extends n.BaseForLines{constructor(e,t,s,n,o,r){if(super(e),this.modifiers=t,this.commands=o,this.brackets=s,this.actionBrackets=n,this.debugFlag=r,s.length!==n.length&&0!==n.length)throw new Error(`Left side has "${s.length}" conditions and right side has "${n.length}" actions!`);if(s.length===n.length);else if(0!==n.length)throw new Error("Invalid Rule. The number of brackets on the right must match the structure of the left hand side or be 0")}simplify(e,t,s,n){const r=this.convertToMultiple().map(o=>o.toSimple(e,t,s,n));if(1===r.length||!this.isRandom()&&r[1]&&r[0].canCollapseBecauseBracketsMatch(r[1]))return r[0].subscribeToCellChanges(),new o.SimpleRuleGroup(this.__source,this.isRandom(),[r[0]]);for(const e of r)e.subscribeToCellChanges();return new o.SimpleRuleGroup(this.__source,this.isRandom(),r)}isRandom(){return this.modifiers.indexOf(i.RANDOM)>=0}toSimple(e,t,s,n){const r=this.getDirectionModifiers();if(1!==r.length)throw new Error(`BUG: should have exactly 1 direction by now but found the following: "${r}"`);const i=this.brackets.map(o=>o.toSimple(r[0],e,t,s,n)),a=this.actionBrackets.map(o=>o.toSimple(r[0],e,t,s,n));for(let e=0;e<i.length;e++){a[e]}return c(e,new o.SimpleRule(this.__source,r[0],i,a,this.commands,this.isLate(),this.isRigid(),this.debugFlag))}convertToMultiple(){let e=[],t=[];for(const t of this.getDirectionModifiers()){const s=this.clone(t,null,null);e.push(s)}const s=new Map;let n;s.set(i.HORIZONTAL,[r.RULE_DIRECTION.LEFT,r.RULE_DIRECTION.RIGHT]),s.set(i.VERTICAL,[r.RULE_DIRECTION.UP,r.RULE_DIRECTION.DOWN]),s.set(i.MOVING,[r.RULE_DIRECTION.UP,r.RULE_DIRECTION.DOWN,r.RULE_DIRECTION.LEFT,r.RULE_DIRECTION.RIGHT,r.RULE_DIRECTION.ACTION]);do{n=!1;for(const o of e){let e=!1;const a=o.getDirectionModifiers()[0];if(1!==o.getDirectionModifiers().length)throw new Error("BUG: should have already expanded the rule to only contian one direction");for(const[r,i]of s)if(o.hasModifier(r))for(const s of i)t.push(o.clone(a,r,s)),e=!0,n=!0;if(!e){let s,l;switch(a){case r.RULE_DIRECTION.UP:case r.RULE_DIRECTION.DOWN:s=[r.RULE_DIRECTION.LEFT,r.RULE_DIRECTION.RIGHT],l=[r.RULE_DIRECTION.UP,r.RULE_DIRECTION.DOWN];break;case r.RULE_DIRECTION.LEFT:case r.RULE_DIRECTION.RIGHT:s=[r.RULE_DIRECTION.UP,r.RULE_DIRECTION.DOWN],l=[r.RULE_DIRECTION.LEFT,r.RULE_DIRECTION.RIGHT];break;default:throw new Error("BUG: There must be some direction")}if(s&&l){const r=[{nameToExpand:i.ORTHOGONAL,variations:s},{nameToExpand:i.PERPENDICULAR,variations:s},{nameToExpand:i.PARALLEL,variations:l}];for(const{nameToExpand:s,variations:i}of r)if(o.hasModifier(s))for(const r of i)t.push(o.clone(a,s,r)),e=!0,n=!0}}e||t.push(o)}e=t,t=[]}while(n);return e}clone(e,t,s){const n=this.brackets.map(n=>n.clone(e,t,s)),o=this.actionBrackets.map(n=>n.clone(e,t,s));let a;switch(e){case r.RULE_DIRECTION.UP:a=i.UP;break;case r.RULE_DIRECTION.DOWN:a=i.DOWN;break;case r.RULE_DIRECTION.LEFT:a=i.LEFT;break;case r.RULE_DIRECTION.RIGHT:a=i.RIGHT;break;default:throw new Error(`BUG: Invalid direction "${e}"`)}const l=[...r.setIntersection(new Set(this.modifiers),[i.LATE,i.RIGID,i.RANDOM])].concat([a]);return new p(this.__source,l,n,o,this.commands,this.debugFlag)}hasModifier(e){for(const t of this.brackets)for(const s of t._getAllNeighbors())for(const t of s.tilesWithModifier)if(t.modifier===e)return!0;return!1}getDirectionModifiers(){if(this.modifiers.indexOf(i.HORIZONTAL)>=0)return[r.RULE_DIRECTION.LEFT,r.RULE_DIRECTION.RIGHT];if(this.modifiers.indexOf(i.VERTICAL)>=0)return[r.RULE_DIRECTION.UP,r.RULE_DIRECTION.DOWN];const e=this.modifiers.filter(e=>l.has(e)).map(e=>{switch(e){case i.UP:return r.RULE_DIRECTION.UP;case i.DOWN:return r.RULE_DIRECTION.DOWN;case i.LEFT:return r.RULE_DIRECTION.LEFT;case i.RIGHT:return r.RULE_DIRECTION.RIGHT;default:throw new Error(`BUG: Invalid rule direction "${e}"`)}});return 0===e.length?a:e}isLate(){return this.modifiers.indexOf(i.LATE)>=0}isRigid(){return this.modifiers.indexOf(i.RIGID)>=0}}t.ASTRule=p;class h extends n.BaseForLines{constructor(e,t,s,n){super(e),this.neighbors=t,this.debugFlag=n,this.firstCellsInEachDirection=new Map;for(const e of o.SIMPLE_DIRECTION_DIRECTIONS)this.firstCellsInEachDirection.set(e,new Set);this.firstCellsInEachDirection.set(r.RULE_DIRECTION.ACTION,new Set)}toKey(){return this.neighbors.map(e=>e.toKey()).join("|")}clone(e,t,s){return new h(this.__source,this.neighbors.map(n=>n.clone(e,t,s)),null,this.debugFlag)}toSimple(e,t,s,n,r){return c(s,new o.SimpleBracket(this.__source,e,this.neighbors.map(e=>e.toSimple(t,s,n,r)),this.debugFlag))}_getAllNeighbors(){return this.neighbors}}t.ASTRuleBracket=h;class m extends n.BaseForLines{constructor(e,t,s,n){super(e),this.beforeEllipsisNeighbors=t,this.afterEllipsisNeighbors=s,this.debugFlag=n}toKey(){return`${this.beforeEllipsisNeighbors.map(e=>e.toKey()).join("|")} ... ${this.afterEllipsisNeighbors.map(e=>e.toKey()).join("|")}`}clone(e,t,s){const n=this.beforeEllipsisNeighbors.map(n=>n.clone(e,t,s)),o=this.afterEllipsisNeighbors.map(n=>n.clone(e,t,s));return new m(this.__source,n,o,this.debugFlag)}toSimple(e,t,s,n,r){const i=this.beforeEllipsisNeighbors.map(e=>e.toSimple(t,s,n,r)),a=this.afterEllipsisNeighbors.map(e=>e.toSimple(t,s,n,r));return c(s,new o.SimpleEllipsisBracket(this.__source,e,i,a,this.debugFlag))}_getAllNeighbors(){return[...this.beforeEllipsisNeighbors,...this.afterEllipsisNeighbors]}}t.ASTRuleBracketEllipsis=m;class u extends n.BaseForLines{constructor(e,t,s){super(e),this.debugFlag=s;const n=new Map;for(const e of t)n.has(e.tile)||n.set(e.tile,e);this.tilesWithModifier=[...n.values()]}toKey(){return`{${this.tilesWithModifier.map(e=>e.toKey()).sort().join(" ")} debugging?${!!this.debugFlag}}`}clone(e,t,s){return new u(this.__source,this.tilesWithModifier.map(n=>n.clone(e,t,s)),this.debugFlag)}toSimple(e,t,s,n){const r=new Set(this.tilesWithModifier.map(o=>o.toSimple(e,t,s,n)));return c(s,new o.SimpleNeighbor(this.__source,r,this.debugFlag))}}t.ASTRuleBracketNeighbor=u;const f="NO";class $ extends n.BaseForLines{constructor(e,t,s,n){super(e),this.modifier=t,this.tile=s,this.debugFlag=n}toKey(){return`${this.modifier||""} ${this.tile?this.tile.getSprites().map(e=>e.getName()):"|||(notile)|||"}{debugging?${!!this.debugFlag}}`}clone(e,t,s){switch(this.modifier){case">":case"<":case"^":case"v":const n=d(e,this.modifier);return new $(this.__source,n,this.tile,this.debugFlag);case t:return new $(this.__source,s,this.tile,this.debugFlag);default:return this}}toSimple(e,t,s,n){let i;switch(this.modifier){case"UP":case"DOWN":case"LEFT":case"RIGHT":i=r.RULE_DIRECTION[this.modifier];break;case"STATIONARY":i=r.RULE_DIRECTION.STATIONARY;break;case"ACTION":i=r.RULE_DIRECTION.ACTION;break;case"RANDOMDIR":i=r.RULE_DIRECTION.RANDOMDIR;break;default:i=null}return c(n,new o.SimpleTileWithModifier(this.__source,this.isNo(),this.isRandom(),i,this.tile,this.debugFlag))}isNo(){return this.modifier===f}isRandom(){return this.modifier===i.RANDOM}}t.ASTTileWithModifier=$;t.ASTRuleBracketNeighborHack=class extends u{constructor(e,t,s){super(e,[],s),this.fields=t}};class b extends n.BaseForLines{}t.AbstractRuleish=b;t.ASTRuleLoop=class extends b{constructor(e,t,s){super(e),this.rules=t}simplify(e,t,s,n){return new o.SimpleRuleLoop(this.__source,!1,this.rules.map(o=>o.simplify(e,t,s,n)))}};function d(e,t){let s;switch(e){case r.RULE_DIRECTION.RIGHT:s=0;break;case r.RULE_DIRECTION.UP:s=1;break;case r.RULE_DIRECTION.LEFT:s=2;break;case r.RULE_DIRECTION.DOWN:s=3;break;default:throw new Error(`BUG! Invalid rule direction "${e}`)}switch(t){case">":s+=0;break;case"^":s+=1;break;case"<":s+=2;break;case"v":s+=3;break;default:throw new Error(`BUG! invalid relative direction "${t}"`)}switch(s%4){case 0:return r.RULE_DIRECTION.RIGHT;case 1:return r.RULE_DIRECTION.UP;case 2:return r.RULE_DIRECTION.LEFT;case 3:return r.RULE_DIRECTION.DOWN;default:throw new Error(`BUG! Incorrectly computed rule direction "${e}" "${t}"`)}}t.ASTRuleGroup=class extends n.BaseForLines{constructor(e,t,s,n){super(e),this.isRandom=t,this.rules=s}simplify(e,t,s,n){const r=this.rules.map(o=>o.simplify(e,t,s,n));return new o.SimpleRuleGroup(this.__source,this.isRandom,r)}},t.relativeDirectionToAbsolute=d},function(e,t,s){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=s(26),o=s(8),r=(s(28),s(1)),i=s(0),a=s(4),l=350,c=50;t.SIMPLE_DIRECTION_DIRECTIONS=[r.RULE_DIRECTION.RIGHT,r.RULE_DIRECTION.DOWN,r.RULE_DIRECTION.LEFT,r.RULE_DIRECTION.UP];class p{constructor(e,t){this.condition=e,this.action=t}}class h extends p{constructor(e,t,s){super(e,t),this.extra=s}}class m{constructor(e){this.cell=e}hasCell(){return!0}getCell(){return this.cell}getCommand(){throw new Error("BUG: check hasCommand first")}}class u{constructor(e){this.command=e}getCommand(){return this.command}hasCell(){return!1}getCell(){throw new Error("BUG: check hasCell first")}}class f extends i.BaseForLines{constructor(e,t,s){super(e),this.rules=s,this.isRandom=t}hasMatches(e){for(const t of this.rules)if(t.hasMatches(e))return!0;return!1}evaluate(t,s){let n;"debug"===e.env.LOG_LEVEL&&(n=Date.now());const o=[];let i;for(i=0;i<l;i++){if(i===l-1)throw new Error(`BUG: Iterated too many times in startloop or + (rule group)\n${this.toString()}`);if(this.isRandom){const e=this.rules.filter(e=>e.hasMatches(t));if(0===e.length)return[];if(1===e.length){return e[0].evaluate(t,!0)}return e[r.nextRandom(e.length)].evaluate(t,!0)}{let e=!1;for(const n of this.rules){const r=n.evaluate(t,s);if(r.length>0){if(r.filter(e=>e.hasCell()).length>0&&(e=!0),s)return r;o.push(r)}}if(!e)break}}return"debug"===e.env.LOG_LEVEL&&o.length>0&&(n&&Date.now()-n>30?console.error(`Rule ${this.__getSourceLineAndColumn().lineNum} applied. ${1===i?"":`(x${i})`} [[${Date.now()-n}ms]]`):console.error(`Rule ${this.__getSourceLineAndColumn().lineNum} applied. ${1===i?"":`(x${i})`}`)),r._flatten(o)}clearCaches(){for(const e of this.rules)e.clearCaches()}getChildRules(){return this.rules}isLate(){return this.rules[0].isLate()}hasRigid(){for(const e of this.rules)if(e.hasRigid())return!0;return!1}addCellsToEmptyRules(e){for(const t of this.rules)t.addCellsToEmptyRules(e)}toKey(){return this.rules.map(e=>e.toKey()).join("\n")}}t.SimpleRuleGroup=f;t.SimpleRuleLoop=class extends f{};t.SimpleRule=class extends i.BaseForLines{constructor(e,t,s,n,o,r,i,a){if(super(e),this.evaluationDirection=t,this.conditionBrackets=s,this.actionBrackets=n,this.commands=o,this._isLate=r,this.isRigid=i,this.debugFlag=a,this.isSubscribedToCellChanges=!1,n.length>0)for(let e=0;e<s.length;e++)s[e].prepareAction(n[e])}toKey(){const e=this.dependsOnDirection()?this.evaluationDirection:"",t=this.conditionBrackets.map(e=>e.toKey()),s=this.actionBrackets.map(e=>e.toKey()),n=this.commands.map(e=>e.toKey());return`{Late?${this._isLate}} {Rigid?${this.isRigid}}  ${e} ${t} -> ${s} ${n.join(" ")} {debugger?${this.debugFlag}}`}getChildRules(){return[]}subscribeToCellChanges(){if(!this.isSubscribedToCellChanges){for(const e of this.conditionBrackets)e.subscribeToNeighborChanges();this.isSubscribedToCellChanges=!0}}clearCaches(){for(const e of this.conditionBrackets)e.clearCaches()}getMatches(e){const t=[];for(let s=0;s<this.conditionBrackets.length;s++){const n=this.conditionBrackets[s],o=this.actionBrackets[s],r=n.getMatches(e,o);if(0===r.length)return[];t.push(r)}return t}evaluate(e,t){let s=[];const n=this.getMatches(e);if(0===n.length)return[];if(this.actionBrackets.length>0){const e=function(e){let t=[[]];for(const s of e){const e=[];for(const n of s)for(const s of t){const t=s.concat([n]);e.push(t)}t=e}return t}(n),o=[];for(const s of e){let e=!0;const n=new Map;for(const t of s){if(!t.doesStillMatch()){e=!1;break}t.populateMagicOrTiles(n)}if(e){for(const e of s)e.doesStillMatch()&&o.push(e.evaluate(n));if(t)break}}s=r._flatten(o)}for(const e of this.commands)s.push(new u(e));return s}hasMatches(e){for(let t=0;t<this.conditionBrackets.length;t++){const s=this.conditionBrackets[t],n=this.actionBrackets[t];if(!s.hasMatches(e,n))return!1}return!0}isLate(){return this._isLate}hasRigid(){return this.isRigid}canCollapseBecauseBracketsMatch(e){for(let t=0;t<this.conditionBrackets.length;t++){if(this.conditionBrackets[t]!==e.conditionBrackets[t])return!1;if(this.conditionBrackets[t]._getAllNeighbors().length>1)return!1}for(let t=0;t<this.actionBrackets.length;t++)if(this.actionBrackets[t]!==e.actionBrackets[t])return!1;return!0}addCellsToEmptyRules(e){for(const t of this.conditionBrackets)t.addCellsToEmptyRules(e)}dependsOnDirection(){return!(!this.conditionBrackets.find(e=>e.dependsOnDirection())&&!this.actionBrackets.find(e=>e.dependsOnDirection()))}};class $ extends i.BaseForLines{constructor(e,t,s,n,o,r){super(e),this._isNegated=t,this._isRandom=s,this._direction=n,this._tile=o,this.neighbors=new Set,this._debugFlag=r,this.trickleCells=new Set}toKey(e){const t=this._tile.getSprites().map(e=>e.getName()).sort();return e?`{-?${this._isNegated}} {#?${this._isRandom}} dir="${this._direction}" [${t.join(" ")}]`:`{-?${this._isNegated}} {#?${this._isRandom}} dir="${this._direction}" [${t.join(" ")}]{debugging?${!!this._debugFlag}}`}equals(e){return this._isNegated===e._isNegated&&this._tile.equals(e._tile)&&this._direction===e._direction&&this._isRandom===e._isRandom}clearCaches(){}isNo(){return this._isNegated}isRandom(){return this._isRandom}getCollisionLayers(){const e=new Set;for(const t of this._tile.getSprites())e.add(t.getCollisionLayer());return e}subscribeToCellChanges(e){this.neighbors.add(e),this._tile.subscribeToCellChanges(this)}addCells(e,t,s,n){let o=!0;if(o=this._direction&&n!==this._direction?this._tile.isOr()&&this.matchesFirstCell(s,n)?!this.isNo():this.isNo():!this.isNo()){for(const e of s)this.trickleCells.add(e);for(const e of this.neighbors)e.addCells(this,t,s,n)}else{for(const e of s)this.trickleCells.delete(e);for(const e of this.neighbors)e.removeCells(this,t,s)}}updateCells(e,t,s){if(this.matchesFirstCell(t,s)){for(const e of t)this.trickleCells.add(e);if(s)for(const n of this.neighbors)n.updateCells(this,e,t,s)}else{for(const e of t)this.trickleCells.delete(e);for(const s of this.neighbors)s.removeCells(this,e,t)}}removeCells(e,t,s){let n=!1;if(n=this._tile.isOr()?this.matchesFirstCell(s,null):this.isNo()){for(const e of s)this.trickleCells.add(e);for(const e of this.neighbors)e.addCells(this,t,s,r.RULE_DIRECTION.STATIONARY)}else{for(const e of s)this.trickleCells.delete(e);for(const e of this.neighbors)e.removeCells(this,t,s)}}hasCell(e){return this.trickleCells.has(e)}matchesCellWantsToMove(e,t){const s=this._tile.hasCell(e);if(this._isNegated!==(s&&(this._direction===t||null===this._direction)))return!0;if(this._direction){for(const t of this._tile.getSpritesThatMatch(e))if(this._direction===e.getWantsToMove(t))return!0;return!1}return!1}matchesFirstCell(e,t){return this.matchesCellWantsToMove(e[0],t)}}t.SimpleTileWithModifier=$;class b extends i.BaseForLines{constructor(e,t,s,n){super(e),this.direction=t,this.debugFlag=n,this.allNeighbors=s,this.firstCells=new Set}_getAllNeighbors(){return this.allNeighbors}hasMatches(e,t){return this.getMatches(e,t).length>0}}t.ISimpleBracket=b;class d{constructor(e){this.cellsAndNeighbors=e}firstCell(){for(const{cell:e}of this.cellsAndNeighbors)return e;throw new Error("BUG: ? No cells were included in the match")}lastCell(){let e;for(const{cell:t}of this.cellsAndNeighbors)e=t;if(e)return e;throw new Error("BUG: ? No cells were included in the match")}doesStillMatch(){for(const{cell:e,condition:t}of this.cellsAndNeighbors)if(!t.matchesCellSimple(e))return!1;return!0}populateMagicOrTiles(e){for(const{cell:t,condition:s}of this.cellsAndNeighbors)s.populateMagicOrTiles(t,e)}evaluate(e){const t=[];for(const{cell:s,condition:n,action:o}of this.cellsAndNeighbors){if(!o)throw new Error("BUG: Should not have tried to evaluate something when there is no action");const r=n.evaluate(o,s,e);r&&t.push(r)}return t}}class _ extends b{constructor(e,t,s,n){super(e,t,s,n),this.neighbors=s,this.ellipsisBracketListeners=new Map,this.spritesPresentInRowOrColumn=this.neighbors[0].spritesPresent.union(this.neighbors.map(e=>e.spritesPresent));const r=[];for(const e of this.neighbors)for(const t of e.anySpritesPresent)r.push(t);this.anySpritesPresentInRowOrColumn=(new o.SpriteBitSet).union(r)}toKey(e){const t=this.dependsOnDirection()?this.direction:"";return e?`{${t}[${this.neighbors.map(t=>t.toKey(e)).join("|")}]}`:`{${t}[${this.neighbors.map(t=>t.toKey(e)).join("|")}]{debugging?${!!this.debugFlag}}}`}dependsOnDirection(){return this.neighbors.length>1||!!this.neighbors.find(e=>e.dependsOnDirection())}subscribeToNeighborChanges(){this.shouldUseOnDemandMethod()||this.neighbors.forEach((e,t)=>{e.subscribeToTileChanges(this,t)})}addEllipsisBracket(e,t){this.ellipsisBracketListeners.set(e,t)}clearCaches(){this.firstCells.clear();for(const e of this.neighbors)e.clearCaches()}getNeighbors(){return this.neighbors}prepareAction(e){const t=e;this.actionDebugFlag=t.debugFlag;for(let e=0;e<this.neighbors.length;e++){const s=this.neighbors[e],n=t.neighbors[e];s.prepareAction(n)}}addCellsToEmptyRules(e){if(1===this.neighbors.length&&0===this.neighbors[0]._tilesWithModifier.size)for(const t of e)this._addFirstCell(t)}_addFirstCell(e){this.firstCells.add(e);for(const[t,s]of this.ellipsisBracketListeners)t.addFirstCell(this,e,s)}addCell(e,t,s,n,o,r){if(!this.matchesDownstream(o,e)){return void(this.getUpstream(o,e)&&this._removeFirstCell(o))}const i=this.matchesUpstream(o,e);if(i)this._addFirstCell(i);else{const t=this.getUpstream(o,e);t&&this._removeFirstCell(t)}}removeCell(e,t,s,n,o){const r=this.getFirstCellToRemove(o,e);r&&this.firstCells.has(r)&&this._removeFirstCell(r)}shouldUseOnDemandMethod(){return"ondemand"===e.env.PUZZLESCRIPT_METHOD}getMatchesByTrickling(e,t){const s=[];for(const e of this.firstCells)this.addToCellMatches(s,e,t);return s}getMatchesByLooping(e,t){const s=[],n=e.getCells(),o=n.length,i=n[0].length;switch(this.direction){case r.RULE_DIRECTION.UP:case r.RULE_DIRECTION.DOWN:for(let n=0;n<i;n++)if(e.colContainsSprites(n,this.spritesPresentInRowOrColumn,this.anySpritesPresentInRowOrColumn))for(let r=0;r<o;r++)this.addIfCellMatches(s,e.getCell(r,n),t);break;case r.RULE_DIRECTION.LEFT:case r.RULE_DIRECTION.RIGHT:for(let n=0;n<o;n++)if(e.rowContainsSprites(n,this.spritesPresentInRowOrColumn,this.anySpritesPresentInRowOrColumn))for(let o=0;o<i;o++)this.addIfCellMatches(s,e.getCell(n,o),t);break;default:throw new Error(`BUG: Unsupported Direction "${this.direction}"`)}return s}getMatches(t,s){let n;if(this.shouldUseOnDemandMethod())n=this.getMatchesByLooping(t,s);else if(n=this.getMatchesByTrickling(t,s),e.env.VERIFY_MATCHES){const e=this.getMatchesByLooping(t,s);if(n.length!==e.length)throw this.getMatchesByLooping(t,s),new Error(`Match lengths differ. Expected ${e.length} but found ${n.length}. \n${this.toString()}`)}return n}getFirstCells(){return this.firstCells}_removeFirstCell(e){if(this.firstCells.has(e)){0,this.firstCells.delete(e);for(const[t,s]of this.ellipsisBracketListeners)t.removeFirstCell(this,e,s)}}matchesDownstream(e,t){let s=!0,n=e;for(let e=t+1;e<this.neighbors.length;e++)if(!(n=n.getNeighbor(this.direction))||0!==this.neighbors[e]._tilesWithModifier.size&&!this.neighbors[e].matchesCellSimple(n)){s=!1;break}return s}getUpstream(e,t){let s=e;for(let e=t-1;e>=0;e--)if(!(s=s.getNeighbor(r.opposite(this.direction))))return null;return s}matchesUpstream(e,t){let s=!0,n=e;for(let e=t-1;e>=0;e--)if(!(n=n.getNeighbor(r.opposite(this.direction)))||0!==this.neighbors[e]._tilesWithModifier.size&&!this.neighbors[e].matchesCellSimple(n)){s=!1;break}return s?n:null}getFirstCellToRemove(e,t){let s=!0,n=e;for(let e=t-1;e>=0;e--)if(!(n=n.getNeighbor(r.opposite(this.direction)))){s=!1;break}return s?n:null}addToCellMatches(e,t,s){const n=[];let o=t,r=!0;for(let e=0;e<this.neighbors.length;e++){if(!o){r=!1;break}const t=this.neighbors[e];let i;s&&(i=s.neighbors[e]);const a={cell:o,condition:t,action:i};n.push(a),o=o.getNeighbor(this.direction)}r&&e.push(new d(n))}addIfCellMatches(e,t,s){this.neighbors[0].matchesCellSimple(t)&&this.matchesDownstream(t,0)&&this.addToCellMatches(e,t,s)}}var g;t.SimpleBracket=_,function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(g||(g={}));class y{constructor(){this.map=new Map}clear(){this.map.clear()}has(e,t){const s=this.map.get(e);return!!s&&s.has(t)}getB(e){return this.map.get(e)}add(e,t){let s=this.map.get(e);return s||(s=new Set,this.map.set(e,s)),!s.has(t)&&(s.add(t),!0)}deleteAllA(e){this.map.delete(e)}deleteAllB(e){const t=new Set;for(const[s,n]of this.map)n.has(e)&&(n.delete(e),0===n.size&&(this.map.delete(s),t.add(s)));return t}delete(e,t){const s=this.map.get(e);if(s){if(!s.has(t))throw new Error("BUG: Invariant error. Link did not exist so nothing to remove");s.delete(t)}}sizeA(){return this.map.size}hasA(e){return this.map.has(e)}hasB(e){return!!this.getA(e)}getA(e){const t=new Set;for(const[s,n]of this.map)n.has(e)&&t.add(s);if(t.size>0)return t}size(){let e=0;for(const t of this.map.values())e+=t.size;return e}}t.SimpleEllipsisBracket=class extends b{constructor(e,t,s,n,o){super(e,t,[...s,...n],o),this.beforeEllipsisBracket=new _(e,t,s,o),this.afterEllipsisBracket=new _(e,t,n,o),this.linkages=new y}subscribeToNeighborChanges(){this.beforeEllipsisBracket.subscribeToNeighborChanges(),this.afterEllipsisBracket.subscribeToNeighborChanges(),this.beforeEllipsisBracket.addEllipsisBracket(this,g.BEFORE),this.afterEllipsisBracket.addEllipsisBracket(this,g.AFTER)}toKey(e){return`[${this.direction} ${this.beforeEllipsisBracket.toKey(e)} ... ${this.afterEllipsisBracket.toKey(e)}]}`}dependsOnDirection(){return!0}getNeighbors(){return[]}clearCaches(){this.firstCells.clear(),this.linkages.clear(),this.beforeEllipsisBracket.clearCaches(),this.afterEllipsisBracket.clearCaches()}prepareAction(e){const t=e;this.beforeEllipsisBracket.prepareAction(t.beforeEllipsisBracket),this.afterEllipsisBracket.prepareAction(t.afterEllipsisBracket)}addCellsToEmptyRules(e){this.beforeEllipsisBracket.addCellsToEmptyRules(e),this.afterEllipsisBracket.addCellsToEmptyRules(e)}addCell(e,t,s,n,o,r){throw new Error("BUG: We should not be subscribed to these events")}removeCell(e,t,s,n,o){throw new Error("BUG: We should not be subscribed to these events")}addFirstCell(e,t,s){}removeFirstCell(e,t,s){if(this.checkInvariants(),e===this.beforeEllipsisBracket)this.linkages.deleteAllA(t),this.firstCells.has(t)&&this.firstCells.delete(t);else{if(e!==this.afterEllipsisBracket)throw new Error("BUG: Bracket should only ever be the before-ellipsis or after-ellipsis one");{const e=this.linkages.deleteAllB(t);for(const t of e)this.firstCells.delete(t)}}this.checkInvariants()}getMatches(e,t){const s=[];let n,o;t?(n=this.beforeEllipsisBracket.getMatches(e,t.beforeEllipsisBracket),o=this.afterEllipsisBracket.getMatches(e,t.afterEllipsisBracket)):(n=this.beforeEllipsisBracket.getMatches(e,null),o=this.afterEllipsisBracket.getMatches(e,null));const i=new y;if(0===n.length||0===o.length)return[];switch(this.direction){case r.RULE_DIRECTION.UP:case r.RULE_DIRECTION.DOWN:for(const e of n)i.add(e.lastCell().colIndex,e);for(const e of o){const{colIndex:t,rowIndex:n}=e.firstCell();for(const o of i.getB(t)||[]){const{rowIndex:t}=o.lastCell();(this.direction===r.RULE_DIRECTION.DOWN?t<n:n<t)&&s.push(new d([...o.cellsAndNeighbors].concat([...e.cellsAndNeighbors])))}}break;case r.RULE_DIRECTION.LEFT:case r.RULE_DIRECTION.RIGHT:for(const e of n)i.add(e.lastCell().rowIndex,e);for(const e of o){const{rowIndex:t,colIndex:n}=e.firstCell();for(const o of i.getB(t)||[]){const{colIndex:t}=o.lastCell();(this.direction===r.RULE_DIRECTION.RIGHT?t<n:n<t)&&s.push(new d([...o.cellsAndNeighbors].concat([...e.cellsAndNeighbors])))}}break;default:throw new Error(`BUG: Invalid direction ${this.direction}`)}return s}checkInvariants(){if(this.firstCells.size!==this.linkages.sizeA())throw new Error("BUG: Invariant violation")}};class E{constructor(e,t,s,n,o){if(!e)throw new Error("BUG: collisionLayer is not set");this.collisionLayer=e,this.actionTileWithModifier=t,this.mightNotFindConditionButThatIsOk=s,this.conditionSpritesToRemove=n,this.newDirection=o}replace(e,t,s){let n=!1;if(this.actionTileWithModifier){let s;if(this.actionTileWithModifier.isRandom()){const e=this.actionTileWithModifier._tile.getSprites();s=[e[r.nextRandom(e.length)]]}else if(this.actionTileWithModifier._tile.isOr()){const e=t.get(this.actionTileWithModifier._tile);if(!e)throw new Error(`BUG: Magic OR tile not found\n${this.actionTileWithModifier.toString()}`);s=e}else s=this.actionTileWithModifier._tile.getSprites();for(const t of s){const s=t.getCollisionLayer(),o=this.newDirection||e.getCollisionLayerWantsToMove(s);let r;if(e.hasSprite(t)){if(!o)throw new Error("BUG: Invariant violation. if the sprite exists then wantsToMove must also exist (at least it would be STATIONARY)");r=e.updateSprite(t,o)}else r=e.addSprite(t,o);n=n||r}}else{const t=e.getSpriteByCollisionLayer(this.collisionLayer);if(!t&&this.mightNotFindConditionButThatIsOk)return{actuallyDidChange:!1};if(!t)throw new Error("BUG: No tile found");if(!this.conditionSpritesToRemove)throw new Error("BUG: Not implemented (just commented out)");if(this.conditionSpritesToRemove._tile.isOr()){if(!s.has(this.conditionSpritesToRemove._tile)){const o=t.getSprites();for(const t of this.conditionSpritesToRemove._tile.getSprites())if(o.indexOf(t)>=0){const o=e.removeSprite(t);n=n||o,o&&s.add(this.conditionSpritesToRemove._tile);break}}}else{const s=new Set(this.conditionSpritesToRemove._tile.getSprites());for(const o of t.getSprites())if(s.has(o)){const t=e.removeSprite(o);n=n||t}}}return{didActuallyChange:n}}}class R{constructor(e,t,s){if(!e)throw new Error("BUG: collisionLayer is not set");this.collisionLayer=e,this.direction=t,this.mightNotFindConditionButThatIsOk=s}replace(e){let t=this.direction;if(this.mightNotFindConditionButThatIsOk&&!e.getSpriteByCollisionLayer(this.collisionLayer))return!1;if(this.direction===r.RULE_DIRECTION.RANDOMDIR){if(e.getCollisionLayerWantsToMove(this.collisionLayer)!==r.RULE_DIRECTION.STATIONARY)return!1;switch(r.nextRandom(4)){case 0:t=r.RULE_DIRECTION.UP;break;case 1:t=r.RULE_DIRECTION.DOWN;break;case 2:t=r.RULE_DIRECTION.LEFT;break;case 3:t=r.RULE_DIRECTION.RIGHT;break;default:throw new Error("BUG: invalid random number chosen")}}return e.setWantsToMoveCollisionLayer(this.collisionLayer,t)}}t.SimpleNeighbor=class extends i.BaseForLines{constructor(e,t,s){super(e),this._tilesWithModifier=t,this.brackets=new Map,this.debugFlag=s,this.staticCache=new Map,this.spritesPresent=new o.SpriteBitSet,this.spritesMissing=new o.SpriteBitSet,this.anySpritesPresent=new Set,this.spriteMovementsPresent=new Map,this.orTileMovementsPresent=new Map,this.trickleCells=new Set,this.lruCache=new n.default(c),this.cacheYesBitSets=new Map,this.cacheNoBitSets=new Map,this.cacheDirections=new Map,this.cacheMultiCollisionLayerTiles=new Set;const r=[...t],i=r.filter(e=>e.isNo()),l=r.filter(e=>!e.isNo());for(const e of l){if(e._tile.hasSingleCollisionLayer())for(const t of e._tile.getSprites()){const s=t.getCollisionLayer();e._direction&&this.cacheDirections.set(s,e._direction);let n=this.cacheYesBitSets.get(s);n||(n=new a,this.cacheYesBitSets.set(s,n)),n.set(s.getBitSetIndexOf(t))}else this.cacheMultiCollisionLayerTiles.add(e);if(e._tile.isOr())this.anySpritesPresent.add(new o.SpriteBitSet(e._tile.getSprites())),e._direction&&this.orTileMovementsPresent.set(e._tile,e._direction);else{this.spritesPresent.addAll(e._tile.getSprites());for(const t of e._tile.getSprites())if(e._direction){const s=this.spriteMovementsPresent.get(t.getCollisionLayer());if(s&&s!==e._direction)throw new Error(`BUG??? prev=${s} ${e._direction}`);this.spriteMovementsPresent.set(t.getCollisionLayer(),e._direction)}}}for(const e of i){if(e._tile.hasSingleCollisionLayer())for(const t of e._tile.getSprites()){const s=t.getCollisionLayer();e._direction&&this.cacheDirections.set(s,e._direction);let n=this.cacheNoBitSets.get(s);n||(n=new a,this.cacheNoBitSets.set(s,n)),n.set(s.getBitSetIndexOf(t))}else this.cacheMultiCollisionLayerTiles.add(e);e._tile.isOr(),this.spritesMissing.addAll(e._tile.getSprites())}}toKey(e){return e?`{${[...this._tilesWithModifier].map(t=>t.toKey(e)).sort().join(" ")}}`:`{${[...this._tilesWithModifier].map(t=>t.toKey(e)).sort().join(" ")} debugging?${!!this.debugFlag}}`}dependsOnDirection(){return!![...this._tilesWithModifier].find(e=>!!e._direction)}prepareAction(e){if(this.staticCache.has(e))return;const t=new Map,s=new Map;for(const e of this._tilesWithModifier)if(e._tile.isOr()&&!e._tile.hasSingleCollisionLayer())e.isNo()||s.set(e._tile,e);else if(e._tile.hasSingleCollisionLayer()){const s=e._tile.getCollisionLayer();if(!s)throw new Error(`BUG: Tile is not assigned to a collision layer\n${e._tile.toString()}`);t.has(s)||t.set(s,new h(e,null,!1))}else for(const s of e._tile.getSprites()){const n=s.getCollisionLayer();t.has(n)||t.set(n,new h(e,null,!1))}const n=new Map(s.entries());for(const o of e._tilesWithModifier)if(o._tile.isOr()&&!o._tile.hasSingleCollisionLayer()){const e=s.get(o._tile);if(e){n.delete(o._tile);const s=e;if(s._direction!==o._direction)for(const e of o._tile.getSprites()){const n=e.getCollisionLayer();t.has(n)||t.set(n,new h(new $(s.__source,s._isNegated,s._isRandom,s._direction,e,s._debugFlag),new $(o.__source,o._isNegated,o._isRandom,o._direction,e,o._debugFlag),!0))}}else if(o.isNo())for(const e of o._tile.getSprites()){const s=e.getCollisionLayer();if(!t.has(s)){const e=new $(o.__source,!1,o._isRandom,o._direction,o._tile,o._debugFlag);t.set(s,new h(e,null,!0))}}else for(const e of o._tile.getSprites()){const s=e.getCollisionLayer();if(!t.has(s)){const e=new $(o.__source,!1,o._isRandom,o._direction,o._tile,o._debugFlag);t.set(s,new h(null,e,!0))}}}else for(const e of o.getCollisionLayers()){if(!e)throw new Error(`BUG: Tile is not assigned to a collision layer.\n${o._tile.toString()}`);const s=t.get(e),n=s&&s.condition||null;if(n&&n.equals(o))t.delete(e);else if(o.isNo())if(s)s.condition===o&&t.delete(e);else{const s=new $(o.__source,!1,!1,o._direction,o._tile,o._debugFlag);t.set(e,new h(s,null,!0))}else s?s.action=o:t.set(e,new h(null,o,!1))}if(n.size>0)for(const e of n.values())for(const s of e._tile.getSprites()){const n=s.getCollisionLayer();if(!t.has(n)){const s=new $(e.__source,!1,!1,e._direction,e._tile,e._debugFlag);t.set(n,new h(s,null,!0))}}const o=new Set,i=new Set;for(const[e,{condition:s,action:n,extra:a}]of t.entries())if(s&&n){if(s!==n){let t=null;(s._direction!==n._direction||s.isNo())&&(t=n._direction||r.RULE_DIRECTION.STATIONARY),!s._tile.equals(n._tile)||s.isNo()?o.add(new E(e,n,a,null,t)):t&&i.add(new R(e,t,a))}}else s?s.isNo()||o.add(new E(e,null,a,s,null)):n&&(n.isNo()||o.add(new E(e,n,a,null,n._direction||r.RULE_DIRECTION.STATIONARY)));this.staticCache.set(e,{replaceTiles:o,replaceDirections:i})}evaluate(e,t,s){let n=this.staticCache.get(e);if(n||(this.prepareAction(e),n=this.staticCache.get(e)),!n)throw new Error("BUG: Missing actionNeighbor. Should have been prepared before");const{replaceTiles:o,replaceDirections:r}=n;let i=!1,a=!1;const l=new Set;for(const e of o){const{didActuallyChange:n}=e.replace(t,s,l);i=i||n||!1}for(const e of r){const s=e.replace(t);a=a||s}return i||a?new m(t):null}clearCaches(){for(const e of this._tilesWithModifier)e.clearCaches()}populateMagicOrTiles(e,t){for(const s of this._tilesWithModifier)if(!s.isNo()&&s._tile.isOr()){const n=r.setIntersection(new Set(s._tile.getSprites()),e.getSpritesAsSet());t.set(s._tile,n)}}subscribeToTileChanges(e,t){let s=this.brackets.get(e);s||(s=new Set,this.brackets.set(e,s)),s.add(t),this._tilesWithModifier.forEach(e=>{e.subscribeToCellChanges(this)})}matchesCellSimple(e){return this.matchesCell(e,null,null)}addCells(e,t,s,n){for(const o of s)if(this.matchesTiles(o)){this.trickleCells.add(o);for(const[s,r]of this.brackets.entries())for(const i of r)s.addCell(i,this,e,t,o,n)}else if(this.trickleCells.has(o)){this.trickleCells.delete(o);for(const[s,n]of this.brackets.entries())for(const r of n)s.removeCell(r,this,e,t,o)}}updateCells(e,t,s,n){this.addCells(e,t,s,n)}removeCells(e,t,s){for(const n of s)if(!this.matchesTiles(n)){this.trickleCells.delete(n);for(const[s,o]of this.brackets.entries())for(const r of o)s.removeCell(r,this,e,t,n)}}matchesCell(e,t,s){return this.lruCache.get(`[${e.toKey()}]`,()=>{let t=e.spriteBitSet.containsAll(this.spritesPresent)&&e.spriteBitSet.containsNone(this.spritesMissing);if(t)for(const s of this.anySpritesPresent)t=t&&e.spriteBitSet.containsAny(s);if(t)for(const[s,n]of this.spriteMovementsPresent)n!==e.getCollisionLayerWantsToMove(s)&&(t=!1);if(t)for(const[s,n]of this.orTileMovementsPresent)if(s.hasSingleCollisionLayer())n!==e.getCollisionLayerWantsToMove(s.getCollisionLayer())&&(t=!1);else{let o=!1,r=!1;for(const t of s.getSprites())e.spriteBitSet.has(t)&&(o=!0,n===e.getCollisionLayerWantsToMove(t.getCollisionLayer())&&(r=!0));if(t=t&&r,!o)throw new Error("BUG: Could not find sprite. One should have already been matched before")}return t})}matchesTiles(e){for(const t of this._tilesWithModifier)if(!t.hasCell(e))return!1;return!0}}}).call(this,s(3))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(27);t.default=class{constructor(e){this.lru=new n({maxSize:e})}get(e,t){const s=this.lru.get(e);if(void 0!==s)return s;const n=t();return this.lru.set(e,n),n}}},function(e,t,s){"use strict";e.exports=class{constructor(e){if(!((e=Object.assign({},e)).maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=e.maxSize,this.cache=new Map,this.oldCache=new Map,this._size=0}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this.oldCache=this.cache,this.cache=new Map)}get(e){if(this.cache.has(e))return this.cache.get(e);if(this.oldCache.has(e)){const t=this.oldCache.get(e);return this._set(e,t),t}}set(e,t){return this.cache.has(e)?this.cache.set(e,t):this._set(e,t),this}has(e){return this.cache.has(e)||this.oldCache.has(e)}peek(e){return this.cache.has(e)?this.cache.get(e):this.oldCache.has(e)?this.oldCache.get(e):void 0}delete(e){this.cache.delete(e)&&this._size--,this.oldCache.delete(e)}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}*keys(){for(const e of this)yield e[0]}*values(){for(const e of this)yield e[1]}*[Symbol.iterator](){for(const e of this.cache)yield e;for(const e of this.oldCache)this.cache.has(e[0])||(yield e)}get size(){let e=0;for(const t of this.oldCache)this.cache.has(t[0])||e++;return this._size+e}}},function(e,t){},function(e,t,s){"use strict";function n(e){return e[0]}Object.defineProperty(t,"__esModule",{value:!0});const o=new Set([]),r=new Set([]),i=(e,t)=>r.has(e)?o.has(e)?null:t||function(t){return{type:e,args:t}}:null,a=e=>null,l=([e])=>e.join(""),c=e=>e.map(e=>{if(1!==e.length)throw new Error("BUG: Expected items to only have one element (usually used in listOf[...])");return e[0]}),p=e=>e.map(e=>{if(e.length<2)throw new Error("BUG: Expected items to have at least 2 elements (usually used in listOf[...])");return e[1]});function h([e,t]){return[e].concat(t.map(([e,t])=>t))}const m=([e])=>e.toUpperCase(),u=new Set(["...","AGAIN","DEBUGGER","NO","LEFT","RIGHT","UP","DOWN","RANDOMDIR","RANDOM","STATIONARY","MOVING","ACTION","VERTICAL","HORIZONTAL","PERPENDICULAR","PARALLEL","ORTHOGONAL","^","<",">","V"]);t.Lexer=void 0,t.ParserRules=[{name:"main$ebnf$1",symbols:[]},{name:"main$ebnf$1",symbols:["main$ebnf$1","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$2",symbols:["lineTerminator"]},{name:"main$ebnf$2",symbols:["main$ebnf$2","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$3$macrocall$2",symbols:["t_OBJECTS"]},{name:"main$ebnf$3$macrocall$3",symbols:["Sprite"]},{name:"main$ebnf$3$macrocall$1$ebnf$1",symbols:[{literal:"="}]},{name:"main$ebnf$3$macrocall$1$ebnf$1",symbols:["main$ebnf$3$macrocall$1$ebnf$1",{literal:"="}],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$3$macrocall$1$ebnf$2",symbols:[{literal:"="}]},{name:"main$ebnf$3$macrocall$1$ebnf$2",symbols:["main$ebnf$3$macrocall$1$ebnf$2",{literal:"="}],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$3$macrocall$1$ebnf$3",symbols:["lineTerminator"]},{name:"main$ebnf$3$macrocall$1$ebnf$3",symbols:["main$ebnf$3$macrocall$1$ebnf$3","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$3$macrocall$1$ebnf$4",symbols:[]},{name:"main$ebnf$3$macrocall$1$ebnf$4$subexpression$1",symbols:["main$ebnf$3$macrocall$3"]},{name:"main$ebnf$3$macrocall$1$ebnf$4",symbols:["main$ebnf$3$macrocall$1$ebnf$4","main$ebnf$3$macrocall$1$ebnf$4$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$3$macrocall$1",symbols:["_","main$ebnf$3$macrocall$1$ebnf$1","lineTerminator","_","main$ebnf$3$macrocall$2","lineTerminator","_","main$ebnf$3$macrocall$1$ebnf$2","main$ebnf$3$macrocall$1$ebnf$3","main$ebnf$3$macrocall$1$ebnf$4"],postprocess:i("Section",function([e,t,s,n,o,r,i,a,l,p]){return{type:"SECTION",name:o,items:c(c(p))}})||function([e,t,s,n,o,r,i,a,l,p]){return c(c(p))}},{name:"main$ebnf$3",symbols:["main$ebnf$3$macrocall$1"],postprocess:n},{name:"main$ebnf$3",symbols:[],postprocess:()=>null},{name:"main$ebnf$4$macrocall$2",symbols:["t_LEGEND"]},{name:"main$ebnf$4$macrocall$3",symbols:["LegendTile"]},{name:"main$ebnf$4$macrocall$1$ebnf$1",symbols:[{literal:"="}]},{name:"main$ebnf$4$macrocall$1$ebnf$1",symbols:["main$ebnf$4$macrocall$1$ebnf$1",{literal:"="}],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$4$macrocall$1$ebnf$2",symbols:[{literal:"="}]},{name:"main$ebnf$4$macrocall$1$ebnf$2",symbols:["main$ebnf$4$macrocall$1$ebnf$2",{literal:"="}],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$4$macrocall$1$ebnf$3",symbols:["lineTerminator"]},{name:"main$ebnf$4$macrocall$1$ebnf$3",symbols:["main$ebnf$4$macrocall$1$ebnf$3","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$4$macrocall$1$ebnf$4",symbols:[]},{name:"main$ebnf$4$macrocall$1$ebnf$4$subexpression$1",symbols:["main$ebnf$4$macrocall$3"]},{name:"main$ebnf$4$macrocall$1$ebnf$4",symbols:["main$ebnf$4$macrocall$1$ebnf$4","main$ebnf$4$macrocall$1$ebnf$4$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$4$macrocall$1",symbols:["_","main$ebnf$4$macrocall$1$ebnf$1","lineTerminator","_","main$ebnf$4$macrocall$2","lineTerminator","_","main$ebnf$4$macrocall$1$ebnf$2","main$ebnf$4$macrocall$1$ebnf$3","main$ebnf$4$macrocall$1$ebnf$4"],postprocess:i("Section",function([e,t,s,n,o,r,i,a,l,p]){return{type:"SECTION",name:o,items:c(c(p))}})||function([e,t,s,n,o,r,i,a,l,p]){return c(c(p))}},{name:"main$ebnf$4",symbols:["main$ebnf$4$macrocall$1"],postprocess:n},{name:"main$ebnf$4",symbols:[],postprocess:()=>null},{name:"main$ebnf$5$macrocall$2",symbols:["t_SOUNDS"]},{name:"main$ebnf$5$macrocall$3",symbols:["SoundItem"]},{name:"main$ebnf$5$macrocall$1$ebnf$1",symbols:[{literal:"="}]},{name:"main$ebnf$5$macrocall$1$ebnf$1",symbols:["main$ebnf$5$macrocall$1$ebnf$1",{literal:"="}],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$5$macrocall$1$ebnf$2",symbols:[{literal:"="}]},{name:"main$ebnf$5$macrocall$1$ebnf$2",symbols:["main$ebnf$5$macrocall$1$ebnf$2",{literal:"="}],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$5$macrocall$1$ebnf$3",symbols:["lineTerminator"]},{name:"main$ebnf$5$macrocall$1$ebnf$3",symbols:["main$ebnf$5$macrocall$1$ebnf$3","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$5$macrocall$1$ebnf$4",symbols:[]},{name:"main$ebnf$5$macrocall$1$ebnf$4$subexpression$1",symbols:["main$ebnf$5$macrocall$3"]},{name:"main$ebnf$5$macrocall$1$ebnf$4",symbols:["main$ebnf$5$macrocall$1$ebnf$4","main$ebnf$5$macrocall$1$ebnf$4$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$5$macrocall$1",symbols:["_","main$ebnf$5$macrocall$1$ebnf$1","lineTerminator","_","main$ebnf$5$macrocall$2","lineTerminator","_","main$ebnf$5$macrocall$1$ebnf$2","main$ebnf$5$macrocall$1$ebnf$3","main$ebnf$5$macrocall$1$ebnf$4"],postprocess:i("Section",function([e,t,s,n,o,r,i,a,l,p]){return{type:"SECTION",name:o,items:c(c(p))}})||function([e,t,s,n,o,r,i,a,l,p]){return c(c(p))}},{name:"main$ebnf$5",symbols:["main$ebnf$5$macrocall$1"],postprocess:n},{name:"main$ebnf$5",symbols:[],postprocess:()=>null},{name:"main$ebnf$6$macrocall$2",symbols:["t_COLLISIONLAYERS"]},{name:"main$ebnf$6$macrocall$3",symbols:["CollisionLayerItem"]},{name:"main$ebnf$6$macrocall$1$ebnf$1",symbols:[{literal:"="}]},{name:"main$ebnf$6$macrocall$1$ebnf$1",symbols:["main$ebnf$6$macrocall$1$ebnf$1",{literal:"="}],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$6$macrocall$1$ebnf$2",symbols:[{literal:"="}]},{name:"main$ebnf$6$macrocall$1$ebnf$2",symbols:["main$ebnf$6$macrocall$1$ebnf$2",{literal:"="}],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$6$macrocall$1$ebnf$3",symbols:["lineTerminator"]},{name:"main$ebnf$6$macrocall$1$ebnf$3",symbols:["main$ebnf$6$macrocall$1$ebnf$3","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$6$macrocall$1$ebnf$4",symbols:[]},{name:"main$ebnf$6$macrocall$1$ebnf$4$subexpression$1",symbols:["main$ebnf$6$macrocall$3"]},{name:"main$ebnf$6$macrocall$1$ebnf$4",symbols:["main$ebnf$6$macrocall$1$ebnf$4","main$ebnf$6$macrocall$1$ebnf$4$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$6$macrocall$1",symbols:["_","main$ebnf$6$macrocall$1$ebnf$1","lineTerminator","_","main$ebnf$6$macrocall$2","lineTerminator","_","main$ebnf$6$macrocall$1$ebnf$2","main$ebnf$6$macrocall$1$ebnf$3","main$ebnf$6$macrocall$1$ebnf$4"],postprocess:i("Section",function([e,t,s,n,o,r,i,a,l,p]){return{type:"SECTION",name:o,items:c(c(p))}})||function([e,t,s,n,o,r,i,a,l,p]){return c(c(p))}},{name:"main$ebnf$6",symbols:["main$ebnf$6$macrocall$1"],postprocess:n},{name:"main$ebnf$6",symbols:[],postprocess:()=>null},{name:"main$ebnf$7$macrocall$2",symbols:["t_RULES"]},{name:"main$ebnf$7$macrocall$3",symbols:["RuleItem"]},{name:"main$ebnf$7$macrocall$1$ebnf$1",symbols:[{literal:"="}]},{name:"main$ebnf$7$macrocall$1$ebnf$1",symbols:["main$ebnf$7$macrocall$1$ebnf$1",{literal:"="}],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$7$macrocall$1$ebnf$2",symbols:[{literal:"="}]},{name:"main$ebnf$7$macrocall$1$ebnf$2",symbols:["main$ebnf$7$macrocall$1$ebnf$2",{literal:"="}],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$7$macrocall$1$ebnf$3",symbols:["lineTerminator"]},{name:"main$ebnf$7$macrocall$1$ebnf$3",symbols:["main$ebnf$7$macrocall$1$ebnf$3","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$7$macrocall$1$ebnf$4",symbols:[]},{name:"main$ebnf$7$macrocall$1$ebnf$4$subexpression$1",symbols:["main$ebnf$7$macrocall$3"]},{name:"main$ebnf$7$macrocall$1$ebnf$4",symbols:["main$ebnf$7$macrocall$1$ebnf$4","main$ebnf$7$macrocall$1$ebnf$4$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$7$macrocall$1",symbols:["_","main$ebnf$7$macrocall$1$ebnf$1","lineTerminator","_","main$ebnf$7$macrocall$2","lineTerminator","_","main$ebnf$7$macrocall$1$ebnf$2","main$ebnf$7$macrocall$1$ebnf$3","main$ebnf$7$macrocall$1$ebnf$4"],postprocess:i("Section",function([e,t,s,n,o,r,i,a,l,p]){return{type:"SECTION",name:o,items:c(c(p))}})||function([e,t,s,n,o,r,i,a,l,p]){return c(c(p))}},{name:"main$ebnf$7",symbols:["main$ebnf$7$macrocall$1"],postprocess:n},{name:"main$ebnf$7",symbols:[],postprocess:()=>null},{name:"main$ebnf$8$macrocall$2",symbols:["t_WINCONDITIONS"]},{name:"main$ebnf$8$macrocall$3",symbols:["WinConditionItem"]},{name:"main$ebnf$8$macrocall$1$ebnf$1",symbols:[{literal:"="}]},{name:"main$ebnf$8$macrocall$1$ebnf$1",symbols:["main$ebnf$8$macrocall$1$ebnf$1",{literal:"="}],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$8$macrocall$1$ebnf$2",symbols:[{literal:"="}]},{name:"main$ebnf$8$macrocall$1$ebnf$2",symbols:["main$ebnf$8$macrocall$1$ebnf$2",{literal:"="}],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$8$macrocall$1$ebnf$3",symbols:["lineTerminator"]},{name:"main$ebnf$8$macrocall$1$ebnf$3",symbols:["main$ebnf$8$macrocall$1$ebnf$3","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$8$macrocall$1$ebnf$4",symbols:[]},{name:"main$ebnf$8$macrocall$1$ebnf$4$subexpression$1",symbols:["main$ebnf$8$macrocall$3"]},{name:"main$ebnf$8$macrocall$1$ebnf$4",symbols:["main$ebnf$8$macrocall$1$ebnf$4","main$ebnf$8$macrocall$1$ebnf$4$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$8$macrocall$1",symbols:["_","main$ebnf$8$macrocall$1$ebnf$1","lineTerminator","_","main$ebnf$8$macrocall$2","lineTerminator","_","main$ebnf$8$macrocall$1$ebnf$2","main$ebnf$8$macrocall$1$ebnf$3","main$ebnf$8$macrocall$1$ebnf$4"],postprocess:i("Section",function([e,t,s,n,o,r,i,a,l,p]){return{type:"SECTION",name:o,items:c(c(p))}})||function([e,t,s,n,o,r,i,a,l,p]){return c(c(p))}},{name:"main$ebnf$8",symbols:["main$ebnf$8$macrocall$1"],postprocess:n},{name:"main$ebnf$8",symbols:[],postprocess:()=>null},{name:"main$ebnf$9$macrocall$2",symbols:["t_LEVELS"]},{name:"main$ebnf$9$macrocall$3",symbols:["LevelItem"]},{name:"main$ebnf$9$macrocall$1$ebnf$1",symbols:[{literal:"="}]},{name:"main$ebnf$9$macrocall$1$ebnf$1",symbols:["main$ebnf$9$macrocall$1$ebnf$1",{literal:"="}],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$9$macrocall$1$ebnf$2",symbols:[{literal:"="}]},{name:"main$ebnf$9$macrocall$1$ebnf$2",symbols:["main$ebnf$9$macrocall$1$ebnf$2",{literal:"="}],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$9$macrocall$1$ebnf$3",symbols:[]},{name:"main$ebnf$9$macrocall$1$ebnf$3$subexpression$1",symbols:["main$ebnf$9$macrocall$3"]},{name:"main$ebnf$9$macrocall$1$ebnf$3",symbols:["main$ebnf$9$macrocall$1$ebnf$3","main$ebnf$9$macrocall$1$ebnf$3$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"main$ebnf$9$macrocall$1",symbols:["_","main$ebnf$9$macrocall$1$ebnf$1","lineTerminator","_","main$ebnf$9$macrocall$2","lineTerminator","_","main$ebnf$9$macrocall$1$ebnf$2","lineTerminator","main$ebnf$9$macrocall$1$ebnf$3"],postprocess:i("Section",function([e,t,s,n,o,r,i,a,l,p]){return{type:"SECTION",name:o,items:c(c(p))}})||function([e,t,s,n,o,r,i,a,l,p]){return c(c(p))}},{name:"main$ebnf$9",symbols:["main$ebnf$9$macrocall$1"],postprocess:n},{name:"main$ebnf$9",symbols:[],postprocess:()=>null},{name:"main",symbols:["main$ebnf$1","_","Title","main$ebnf$2","OptionalMetaData","main$ebnf$3","main$ebnf$4","main$ebnf$5","main$ebnf$6","main$ebnf$7","main$ebnf$8","main$ebnf$9"],postprocess:i("Section")||function([e,t,s,n,o,r,i,a,l,c,p,h]){const m=[];let u=null;for(const e of h||[])switch(e.type){case"LEVEL_ROW":u?u.push(e):u=[e];break;case"LEVEL_MESSAGE":u&&(m.push({type:"LEVEL_MAP",rowData:u.map(e=>e.rowData),sourceOffset:u[0].sourceOffset}),u=null),m.push(e);break;case"LEVEL_SEPARATOR":u&&(m.push({type:"LEVEL_MAP",rowData:u.map(e=>e.rowData),sourceOffset:u[0].sourceOffset}),u=null);break;default:throw new Error(`BUG: Unsupported level row type "${e.type}"`)}return u&&(m.push({type:"LEVEL_MAP",rowData:u.map(e=>e.rowData),sourceOffset:u[0].sourceOffset}),u=null),{title:s.value,metadata:o.value,sprites:r||[],legendItems:i||[],sounds:a||[],collisionLayers:l||[],rules:c||[],winConditions:p||[],levels:m}}},{name:"_$ebnf$1",symbols:[]},{name:"_$ebnf$1$subexpression$1",symbols:["whitespaceChar"]},{name:"_$ebnf$1$subexpression$1",symbols:["multiLineComment"]},{name:"_$ebnf$1",symbols:["_$ebnf$1","_$ebnf$1$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"_",symbols:["_$ebnf$1"],postprocess:i("whitespace")||a},{name:"__$ebnf$1$subexpression$1",symbols:["whitespaceChar"]},{name:"__$ebnf$1$subexpression$1",symbols:["multiLineComment"]},{name:"__$ebnf$1",symbols:["__$ebnf$1$subexpression$1"]},{name:"__$ebnf$1$subexpression$2",symbols:["whitespaceChar"]},{name:"__$ebnf$1$subexpression$2",symbols:["multiLineComment"]},{name:"__$ebnf$1",symbols:["__$ebnf$1","__$ebnf$1$subexpression$2"],postprocess:e=>e[0].concat([e[1]])},{name:"__",symbols:["__$ebnf$1"],postprocess:i("whitespace")||a},{name:"multiLineComment$ebnf$1",symbols:[]},{name:"multiLineComment$ebnf$1",symbols:["multiLineComment$ebnf$1","textOrComment"],postprocess:e=>e[0].concat([e[1]])},{name:"multiLineComment",symbols:[{literal:"("},"multiLineComment$ebnf$1",{literal:")"}],postprocess:i("multiLineComment")||a},{name:"textOrComment",symbols:["multiLineComment"],postprocess:a},{name:"textOrComment",symbols:[/[^\(\)]/],postprocess:a},{name:"whitespaceChar",symbols:[{literal:" "}]},{name:"whitespaceChar",symbols:[{literal:"\t"}]},{name:"newline",symbols:[{literal:"\n"}]},{name:"digit",symbols:[/[0-9]/],postprocess:n},{name:"hexDigit",symbols:[/[0-9a-fA-F]/],postprocess:n},{name:"letter",symbols:[/[^\n \(\)]/],postprocess:n},{name:"integer$ebnf$1",symbols:["digit"]},{name:"integer$ebnf$1",symbols:["integer$ebnf$1","digit"],postprocess:e=>e[0].concat([e[1]])},{name:"integer",symbols:["integer$ebnf$1"],postprocess:([e])=>parseInt(e.join(""),10)},{name:"word$ebnf$1",symbols:[/[^\n \(]/]},{name:"word$ebnf$1",symbols:["word$ebnf$1",/[^\n \(]/],postprocess:e=>e[0].concat([e[1]])},{name:"word",symbols:["word$ebnf$1"],postprocess:i("WORD")||l},{name:"words$macrocall$2",symbols:["word"]},{name:"words$macrocall$3$ebnf$1",symbols:["whitespaceChar"]},{name:"words$macrocall$3$ebnf$1",symbols:["words$macrocall$3$ebnf$1","whitespaceChar"],postprocess:e=>e[0].concat([e[1]])},{name:"words$macrocall$3",symbols:["words$macrocall$3$ebnf$1"]},{name:"words$macrocall$1$ebnf$1",symbols:[]},{name:"words$macrocall$1$ebnf$1$subexpression$1",symbols:["words$macrocall$3","words$macrocall$2"]},{name:"words$macrocall$1$ebnf$1",symbols:["words$macrocall$1$ebnf$1","words$macrocall$1$ebnf$1$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"words$macrocall$1",symbols:["words$macrocall$2","words$macrocall$1$ebnf$1"],postprocess:i("nonemptyListOf")||h},{name:"words",symbols:["words$macrocall$1"],postprocess:i("WORDS")||function([e]){return c(e).join(" ")}},{name:"lineTerminator",symbols:["_","newline"],postprocess:i("lineTerminator")||a},{name:"sourceCharacter",symbols:[/[^\n ]/]},{name:"nonVarChar",symbols:["whitespaceChar"]},{name:"nonVarChar",symbols:["newline"]},{name:"nonVarChar",symbols:[{literal:"["}]},{name:"nonVarChar",symbols:[{literal:"]"}]},{name:"nonVarChar",symbols:[{literal:"("}]},{name:"nonVarChar",symbols:[{literal:")"}]},{name:"nonVarChar",symbols:[{literal:"|"}]},{name:"nonVarChar",symbols:[{literal:"."}]},{name:"decimal",symbols:["decimalWithLeadingNumber"]},{name:"decimal",symbols:["decimalWithLeadingPeriod"]},{name:"decimalWithLeadingNumber$ebnf$1",symbols:["digit"]},{name:"decimalWithLeadingNumber$ebnf$1",symbols:["decimalWithLeadingNumber$ebnf$1","digit"],postprocess:e=>e[0].concat([e[1]])},{name:"decimalWithLeadingNumber$ebnf$2$subexpression$1$ebnf$1",symbols:["digit"]},{name:"decimalWithLeadingNumber$ebnf$2$subexpression$1$ebnf$1",symbols:["decimalWithLeadingNumber$ebnf$2$subexpression$1$ebnf$1","digit"],postprocess:e=>e[0].concat([e[1]])},{name:"decimalWithLeadingNumber$ebnf$2$subexpression$1",symbols:[{literal:"."},"decimalWithLeadingNumber$ebnf$2$subexpression$1$ebnf$1"]},{name:"decimalWithLeadingNumber$ebnf$2",symbols:["decimalWithLeadingNumber$ebnf$2$subexpression$1"],postprocess:n},{name:"decimalWithLeadingNumber$ebnf$2",symbols:[],postprocess:()=>null},{name:"decimalWithLeadingNumber",symbols:["decimalWithLeadingNumber$ebnf$1","decimalWithLeadingNumber$ebnf$2"]},{name:"decimalWithLeadingPeriod$ebnf$1",symbols:["digit"]},{name:"decimalWithLeadingPeriod$ebnf$1",symbols:["decimalWithLeadingPeriod$ebnf$1","digit"],postprocess:e=>e[0].concat([e[1]])},{name:"decimalWithLeadingPeriod",symbols:[{literal:"."},"decimalWithLeadingPeriod$ebnf$1"]},{name:"colorHex6",symbols:[{literal:"#"},"hexDigit","hexDigit","hexDigit","hexDigit","hexDigit","hexDigit"],postprocess:(e,t)=>({type:"COLOR_HEX6",value:e.join(""),sourceOffset:t})},{name:"colorHex3",symbols:[{literal:"#"},"hexDigit","hexDigit","hexDigit"],postprocess:(e,t)=>({type:"COLOR_HEX3",value:e.join(""),sourceOffset:t})},{name:"colorNameOrHex",symbols:["colorHex6"],postprocess:n},{name:"colorNameOrHex",symbols:["colorHex3"],postprocess:n},{name:"colorNameOrHex",symbols:["colorName"],postprocess:n},{name:"colorName",symbols:[/[^\n #\(0-9\.]/,"word"],postprocess:i("COLOR_NAME")||function([e,t],s){return{type:"COLOR_NAME",value:[e].concat(t).join(""),sourceOffset:s}}},{name:"legendVariableChar",symbols:[/[^\n\ \=]/]},{name:"ruleVariableChar",symbols:[/[^(?=\.\.\.)\n \=\[\]\|]/]},{name:"ruleVariableName$ebnf$1",symbols:["ruleVariableChar"]},{name:"ruleVariableName$ebnf$1",symbols:["ruleVariableName$ebnf$1","ruleVariableChar"],postprocess:e=>e[0].concat([e[1]])},{name:"ruleVariableName",symbols:["ruleVariableName$ebnf$1"],postprocess:l},{name:"lookupRuleVariableName$ebnf$1",symbols:[/[^\n \=\[\]\|]/]},{name:"lookupRuleVariableName$ebnf$1",symbols:["lookupRuleVariableName$ebnf$1",/[^\n \=\[\]\|]/],postprocess:e=>e[0].concat([e[1]])},{name:"lookupRuleVariableName",symbols:["lookupRuleVariableName$ebnf$1"],postprocess:([e],t,s)=>{const n=e.join("");return u.has(n.toUpperCase())?s:n}},{name:"collisionVariableChar",symbols:[/[^(?=\.\.\.)\ \n\=\[\]\|\,]/]},{name:"collisionVariableName$ebnf$1",symbols:["collisionVariableChar"]},{name:"collisionVariableName$ebnf$1",symbols:["collisionVariableName$ebnf$1","collisionVariableChar"],postprocess:e=>e[0].concat([e[1]])},{name:"collisionVariableName",symbols:["collisionVariableName$ebnf$1"],postprocess:l},{name:"lookupCollisionVariableName",symbols:["collisionVariableName"],postprocess:n},{name:"t_DEBUGGER",symbols:["t_DEBUGGER_ADD"],postprocess:n},{name:"t_DEBUGGER",symbols:["t_DEBUGGER_REMOVE"],postprocess:n},{name:"t_DEBUGGER",symbols:["t_DEBUGGER_DEFAULT"],postprocess:n},{name:"t_DEBUGGER_DEFAULT$subexpression$1",symbols:[/[dD]/,/[eE]/,/[bB]/,/[uU]/,/[gG]/,/[gG]/,/[eE]/,/[rR]/],postprocess:function(e){return e.join("")}},{name:"t_DEBUGGER_DEFAULT",symbols:["t_DEBUGGER_DEFAULT$subexpression$1"],postprocess:m},{name:"t_DEBUGGER_ADD$subexpression$1",symbols:[/[dD]/,/[eE]/,/[bB]/,/[uU]/,/[gG]/,/[gG]/,/[eE]/,/[rR]/,{literal:"_"},/[aA]/,/[dD]/,/[dD]/],postprocess:function(e){return e.join("")}},{name:"t_DEBUGGER_ADD",symbols:["t_DEBUGGER_ADD$subexpression$1"],postprocess:m},{name:"t_DEBUGGER_REMOVE$subexpression$1",symbols:[/[dD]/,/[eE]/,/[bB]/,/[uU]/,/[gG]/,/[gG]/,/[eE]/,/[rR]/,{literal:"_"},/[rR]/,/[eE]/,/[mM]/,/[oO]/,/[vV]/,/[eE]/],postprocess:function(e){return e.join("")}},{name:"t_DEBUGGER_REMOVE",symbols:["t_DEBUGGER_REMOVE$subexpression$1"],postprocess:m},{name:"t_OBJECTS$subexpression$1",symbols:[/[oO]/,/[bB]/,/[jJ]/,/[eE]/,/[cC]/,/[tT]/,/[sS]/],postprocess:function(e){return e.join("")}},{name:"t_OBJECTS",symbols:["t_OBJECTS$subexpression$1"],postprocess:m},{name:"t_LEGEND$subexpression$1",symbols:[/[lL]/,/[eE]/,/[gG]/,/[eE]/,/[nN]/,/[dD]/],postprocess:function(e){return e.join("")}},{name:"t_LEGEND",symbols:["t_LEGEND$subexpression$1"],postprocess:m},{name:"t_SOUNDS$subexpression$1",symbols:[/[sS]/,/[oO]/,/[uU]/,/[nN]/,/[dD]/,/[sS]/],postprocess:function(e){return e.join("")}},{name:"t_SOUNDS",symbols:["t_SOUNDS$subexpression$1"],postprocess:m},{name:"t_COLLISIONLAYERS$subexpression$1",symbols:[/[cC]/,/[oO]/,/[lL]/,/[lL]/,/[iI]/,/[sS]/,/[iI]/,/[oO]/,/[nN]/,/[lL]/,/[aA]/,/[yY]/,/[eE]/,/[rR]/,/[sS]/],postprocess:function(e){return e.join("")}},{name:"t_COLLISIONLAYERS",symbols:["t_COLLISIONLAYERS$subexpression$1"],postprocess:m},{name:"t_RULES$subexpression$1",symbols:[/[rR]/,/[uU]/,/[lL]/,/[eE]/,/[sS]/],postprocess:function(e){return e.join("")}},{name:"t_RULES",symbols:["t_RULES$subexpression$1"],postprocess:m},{name:"t_WINCONDITIONS$subexpression$1",symbols:[/[wW]/,/[iI]/,/[nN]/,/[cC]/,/[oO]/,/[nN]/,/[dD]/,/[iI]/,/[tT]/,/[iI]/,/[oO]/,/[nN]/,/[sS]/],postprocess:function(e){return e.join("")}},{name:"t_WINCONDITIONS",symbols:["t_WINCONDITIONS$subexpression$1"],postprocess:m},{name:"t_LEVELS$subexpression$1",symbols:[/[lL]/,/[eE]/,/[vV]/,/[eE]/,/[lL]/,/[sS]/],postprocess:function(e){return e.join("")}},{name:"t_LEVELS",symbols:["t_LEVELS$subexpression$1"],postprocess:m},{name:"t_RIGID$subexpression$1",symbols:[/[rR]/,/[iI]/,/[gG]/,/[iI]/,/[dD]/],postprocess:function(e){return e.join("")}},{name:"t_RIGID",symbols:["t_RIGID$subexpression$1"],postprocess:m},{name:"t_LATE$subexpression$1",symbols:[/[lL]/,/[aA]/,/[tT]/,/[eE]/],postprocess:function(e){return e.join("")}},{name:"t_LATE",symbols:["t_LATE$subexpression$1"],postprocess:m},{name:"t_RANDOM$subexpression$1",symbols:[/[rR]/,/[aA]/,/[nN]/,/[dD]/,/[oO]/,/[mM]/],postprocess:function(e){return e.join("")}},{name:"t_RANDOM",symbols:["t_RANDOM$subexpression$1"],postprocess:m},{name:"t_RANDOMDIR$subexpression$1",symbols:[/[rR]/,/[aA]/,/[nN]/,/[dD]/,/[oO]/,/[mM]/,/[dD]/,/[iI]/,/[rR]/],postprocess:function(e){return e.join("")}},{name:"t_RANDOMDIR",symbols:["t_RANDOMDIR$subexpression$1"],postprocess:m},{name:"t_ACTION$subexpression$1",symbols:[/[aA]/,/[cC]/,/[tT]/,/[iI]/,/[oO]/,/[nN]/],postprocess:function(e){return e.join("")}},{name:"t_ACTION",symbols:["t_ACTION$subexpression$1"],postprocess:m},{name:"t_STARTLOOP$subexpression$1",symbols:[/[sS]/,/[tT]/,/[aA]/,/[rR]/,/[tT]/,/[lL]/,/[oO]/,/[oO]/,/[pP]/],postprocess:function(e){return e.join("")}},{name:"t_STARTLOOP",symbols:["t_STARTLOOP$subexpression$1"],postprocess:m},{name:"t_ENDLOOP$subexpression$1",symbols:[/[eE]/,/[nN]/,/[dD]/,/[lL]/,/[oO]/,/[oO]/,/[pP]/],postprocess:function(e){return e.join("")}},{name:"t_ENDLOOP",symbols:["t_ENDLOOP$subexpression$1"],postprocess:m},{name:"t_UP$subexpression$1",symbols:[/[uU]/,/[pP]/],postprocess:function(e){return e.join("")}},{name:"t_UP",symbols:["t_UP$subexpression$1"],postprocess:m},{name:"t_DOWN$subexpression$1",symbols:[/[dD]/,/[oO]/,/[wW]/,/[nN]/],postprocess:function(e){return e.join("")}},{name:"t_DOWN",symbols:["t_DOWN$subexpression$1"],postprocess:m},{name:"t_LEFT$subexpression$1",symbols:[/[lL]/,/[eE]/,/[fF]/,/[tT]/],postprocess:function(e){return e.join("")}},{name:"t_LEFT",symbols:["t_LEFT$subexpression$1"],postprocess:m},{name:"t_RIGHT$subexpression$1",symbols:[/[rR]/,/[iI]/,/[gG]/,/[hH]/,/[tT]/],postprocess:function(e){return e.join("")}},{name:"t_RIGHT",symbols:["t_RIGHT$subexpression$1"],postprocess:m},{name:"t_ARROW_UP$subexpression$1",symbols:[{literal:"^"}],postprocess:function(e){return e.join("")}},{name:"t_ARROW_UP",symbols:["t_ARROW_UP$subexpression$1"],postprocess:m},{name:"t_ARROW_DOWN$subexpression$1",symbols:[/[vV]/],postprocess:function(e){return e.join("")}},{name:"t_ARROW_DOWN",symbols:["t_ARROW_DOWN$subexpression$1"],postprocess:m},{name:"t_ARROW_LEFT$subexpression$1",symbols:[{literal:"<"}],postprocess:function(e){return e.join("")}},{name:"t_ARROW_LEFT",symbols:["t_ARROW_LEFT$subexpression$1"],postprocess:m},{name:"t_ARROW_RIGHT$subexpression$1",symbols:[{literal:">"}],postprocess:function(e){return e.join("")}},{name:"t_ARROW_RIGHT",symbols:["t_ARROW_RIGHT$subexpression$1"],postprocess:m},{name:"t_MOVING$subexpression$1",symbols:[/[mM]/,/[oO]/,/[vV]/,/[iI]/,/[nN]/,/[gG]/],postprocess:function(e){return e.join("")}},{name:"t_MOVING",symbols:["t_MOVING$subexpression$1"],postprocess:m},{name:"t_ORTHOGONAL$subexpression$1",symbols:[/[oO]/,/[rR]/,/[tT]/,/[hH]/,/[oO]/,/[gG]/,/[oO]/,/[nN]/,/[aA]/,/[lL]/],postprocess:function(e){return e.join("")}},{name:"t_ORTHOGONAL",symbols:["t_ORTHOGONAL$subexpression$1"],postprocess:m},{name:"t_PERPENDICULAR$subexpression$1",symbols:[/[pP]/,/[eE]/,/[rR]/,/[pP]/,/[eE]/,/[nN]/,/[dD]/,/[iI]/,/[cC]/,/[uU]/,/[lL]/,/[aA]/,/[rR]/],postprocess:function(e){return e.join("")}},{name:"t_PERPENDICULAR",symbols:["t_PERPENDICULAR$subexpression$1"],postprocess:m},{name:"t_PARALLEL$subexpression$1",symbols:[/[pP]/,/[aA]/,/[rR]/,/[aA]/,/[lL]/,/[lL]/,/[eE]/,/[lL]/],postprocess:function(e){return e.join("")}},{name:"t_PARALLEL",symbols:["t_PARALLEL$subexpression$1"],postprocess:m},{name:"t_STATIONARY$subexpression$1",symbols:[/[sS]/,/[tT]/,/[aA]/,/[tT]/,/[iI]/,/[oO]/,/[nN]/,/[aA]/,/[rR]/,/[yY]/],postprocess:function(e){return e.join("")}},{name:"t_STATIONARY",symbols:["t_STATIONARY$subexpression$1"],postprocess:m},{name:"t_HORIZONTAL$subexpression$1",symbols:[/[hH]/,/[oO]/,/[rR]/,/[iI]/,/[zZ]/,/[oO]/,/[nN]/,/[tT]/,/[aA]/,/[lL]/],postprocess:function(e){return e.join("")}},{name:"t_HORIZONTAL",symbols:["t_HORIZONTAL$subexpression$1"],postprocess:m},{name:"t_VERTICAL$subexpression$1",symbols:[/[vV]/,/[eE]/,/[rR]/,/[tT]/,/[iI]/,/[cC]/,/[aA]/,/[lL]/],postprocess:function(e){return e.join("")}},{name:"t_VERTICAL",symbols:["t_VERTICAL$subexpression$1"],postprocess:m},{name:"t_ARROW_ANY",symbols:["t_ARROW_UP"],postprocess:m},{name:"t_ARROW_ANY",symbols:["t_ARROW_DOWN"],postprocess:m},{name:"t_ARROW_ANY",symbols:["t_ARROW_LEFT"],postprocess:m},{name:"t_ARROW_ANY",symbols:["t_ARROW_RIGHT"],postprocess:m},{name:"t_AGAIN$subexpression$1",symbols:[/[aA]/,/[gG]/,/[aA]/,/[iI]/,/[nN]/],postprocess:function(e){return e.join("")}},{name:"t_AGAIN",symbols:["t_AGAIN$subexpression$1"],postprocess:m},{name:"t_CANCEL$subexpression$1",symbols:[/[cC]/,/[aA]/,/[nN]/,/[cC]/,/[eE]/,/[lL]/],postprocess:function(e){return e.join("")}},{name:"t_CANCEL",symbols:["t_CANCEL$subexpression$1"],postprocess:m},{name:"t_CHECKPOINT$subexpression$1",symbols:[/[cC]/,/[hH]/,/[eE]/,/[cC]/,/[kK]/,/[pP]/,/[oO]/,/[iI]/,/[nN]/,/[tT]/],postprocess:function(e){return e.join("")}},{name:"t_CHECKPOINT",symbols:["t_CHECKPOINT$subexpression$1"],postprocess:m},{name:"t_RESTART$subexpression$1",symbols:[/[rR]/,/[eE]/,/[sS]/,/[tT]/,/[aA]/,/[rR]/,/[tT]/],postprocess:function(e){return e.join("")}},{name:"t_RESTART",symbols:["t_RESTART$subexpression$1"],postprocess:m},{name:"t_UNDO$subexpression$1",symbols:[/[uU]/,/[nN]/,/[dD]/,/[oO]/],postprocess:function(e){return e.join("")}},{name:"t_UNDO",symbols:["t_UNDO$subexpression$1"],postprocess:m},{name:"t_WIN$subexpression$1",symbols:[/[wW]/,/[iI]/,/[nN]/],postprocess:function(e){return e.join("")}},{name:"t_WIN",symbols:["t_WIN$subexpression$1"],postprocess:m},{name:"t_MESSAGE$subexpression$1",symbols:[/[mM]/,/[eE]/,/[sS]/,/[sS]/,/[aA]/,/[gG]/,/[eE]/],postprocess:function(e){return e.join("")}},{name:"t_MESSAGE",symbols:["t_MESSAGE$subexpression$1"],postprocess:m},{name:"t_ELLIPSIS$subexpression$1",symbols:[{literal:"."},{literal:"."},{literal:"."}],postprocess:function(e){return e.join("")}},{name:"t_ELLIPSIS",symbols:["t_ELLIPSIS$subexpression$1"],postprocess:m},{name:"t_AND$subexpression$1",symbols:[/[aA]/,/[nN]/,/[dD]/],postprocess:function(e){return e.join("")}},{name:"t_AND",symbols:["t_AND$subexpression$1"],postprocess:m},{name:"t_OR$subexpression$1",symbols:[/[oO]/,/[rR]/],postprocess:function(e){return e.join("")}},{name:"t_OR",symbols:["t_OR$subexpression$1"],postprocess:m},{name:"t_SFX0$subexpression$1",symbols:[/[sS]/,/[fF]/,/[xX]/,{literal:"0"}],postprocess:function(e){return e.join("")}},{name:"t_SFX0",symbols:["t_SFX0$subexpression$1"],postprocess:m},{name:"t_SFX1$subexpression$1",symbols:[/[sS]/,/[fF]/,/[xX]/,{literal:"1"}],postprocess:function(e){return e.join("")}},{name:"t_SFX1",symbols:["t_SFX1$subexpression$1"],postprocess:m},{name:"t_SFX2$subexpression$1",symbols:[/[sS]/,/[fF]/,/[xX]/,{literal:"2"}],postprocess:function(e){return e.join("")}},{name:"t_SFX2",symbols:["t_SFX2$subexpression$1"],postprocess:m},{name:"t_SFX3$subexpression$1",symbols:[/[sS]/,/[fF]/,/[xX]/,{literal:"3"}],postprocess:function(e){return e.join("")}},{name:"t_SFX3",symbols:["t_SFX3$subexpression$1"],postprocess:m},{name:"t_SFX4$subexpression$1",symbols:[/[sS]/,/[fF]/,/[xX]/,{literal:"4"}],postprocess:function(e){return e.join("")}},{name:"t_SFX4",symbols:["t_SFX4$subexpression$1"],postprocess:m},{name:"t_SFX5$subexpression$1",symbols:[/[sS]/,/[fF]/,/[xX]/,{literal:"5"}],postprocess:function(e){return e.join("")}},{name:"t_SFX5",symbols:["t_SFX5$subexpression$1"],postprocess:m},{name:"t_SFX6$subexpression$1",symbols:[/[sS]/,/[fF]/,/[xX]/,{literal:"6"}],postprocess:function(e){return e.join("")}},{name:"t_SFX6",symbols:["t_SFX6$subexpression$1"],postprocess:m},{name:"t_SFX7$subexpression$1",symbols:[/[sS]/,/[fF]/,/[xX]/,{literal:"7"}],postprocess:function(e){return e.join("")}},{name:"t_SFX7",symbols:["t_SFX7$subexpression$1"],postprocess:m},{name:"t_SFX8$subexpression$1",symbols:[/[sS]/,/[fF]/,/[xX]/,{literal:"8"}],postprocess:function(e){return e.join("")}},{name:"t_SFX8",symbols:["t_SFX8$subexpression$1"],postprocess:m},{name:"t_SFX9$subexpression$1",symbols:[/[sS]/,/[fF]/,/[xX]/,{literal:"9"}],postprocess:function(e){return e.join("")}},{name:"t_SFX9",symbols:["t_SFX9$subexpression$1"],postprocess:m},{name:"t_SFX10$subexpression$1",symbols:[/[sS]/,/[fF]/,/[xX]/,{literal:"1"},{literal:"0"}],postprocess:function(e){return e.join("")}},{name:"t_SFX10",symbols:["t_SFX10$subexpression$1"],postprocess:m},{name:"t_SFX",symbols:["t_SFX10"],postprocess:m},{name:"t_SFX",symbols:["t_SFX0"],postprocess:m},{name:"t_SFX",symbols:["t_SFX1"],postprocess:m},{name:"t_SFX",symbols:["t_SFX2"],postprocess:m},{name:"t_SFX",symbols:["t_SFX3"],postprocess:m},{name:"t_SFX",symbols:["t_SFX4"],postprocess:m},{name:"t_SFX",symbols:["t_SFX5"],postprocess:m},{name:"t_SFX",symbols:["t_SFX6"],postprocess:m},{name:"t_SFX",symbols:["t_SFX7"],postprocess:m},{name:"t_SFX",symbols:["t_SFX8"],postprocess:m},{name:"t_SFX",symbols:["t_SFX9"],postprocess:m},{name:"t_TITLE$subexpression$1",symbols:[/[tT]/,/[iI]/,/[tT]/,/[lL]/,/[eE]/],postprocess:function(e){return e.join("")}},{name:"t_TITLE",symbols:["t_TITLE$subexpression$1"],postprocess:m},{name:"t_AUTHOR$subexpression$1",symbols:[/[aA]/,/[uU]/,/[tT]/,/[hH]/,/[oO]/,/[rR]/],postprocess:function(e){return e.join("")}},{name:"t_AUTHOR",symbols:["t_AUTHOR$subexpression$1"],postprocess:m},{name:"t_HOMEPAGE$subexpression$1",symbols:[/[hH]/,/[oO]/,/[mM]/,/[eE]/,/[pP]/,/[aA]/,/[gG]/,/[eE]/],postprocess:function(e){return e.join("")}},{name:"t_HOMEPAGE",symbols:["t_HOMEPAGE$subexpression$1"],postprocess:m},{name:"t_YOUTUBE$subexpression$1",symbols:[/[yY]/,/[oO]/,/[uU]/,/[tT]/,/[uU]/,/[bB]/,/[eE]/],postprocess:function(e){return e.join("")}},{name:"t_YOUTUBE",symbols:["t_YOUTUBE$subexpression$1"],postprocess:m},{name:"t_ZOOMSCREEN$subexpression$1",symbols:[/[zZ]/,/[oO]/,/[oO]/,/[mM]/,/[sS]/,/[cC]/,/[rR]/,/[eE]/,/[eE]/,/[nN]/],postprocess:function(e){return e.join("")}},{name:"t_ZOOMSCREEN",symbols:["t_ZOOMSCREEN$subexpression$1"],postprocess:m},{name:"t_FLICKSCREEN$subexpression$1",symbols:[/[fF]/,/[lL]/,/[iI]/,/[cC]/,/[kK]/,/[sS]/,/[cC]/,/[rR]/,/[eE]/,/[eE]/,/[nN]/],postprocess:function(e){return e.join("")}},{name:"t_FLICKSCREEN",symbols:["t_FLICKSCREEN$subexpression$1"],postprocess:m},{name:"t_REQUIRE_PLAYER_MOVEMENT$subexpression$1",symbols:[/[rR]/,/[eE]/,/[qQ]/,/[uU]/,/[iI]/,/[rR]/,/[eE]/,{literal:"_"},/[pP]/,/[lL]/,/[aA]/,/[yY]/,/[eE]/,/[rR]/,{literal:"_"},/[mM]/,/[oO]/,/[vV]/,/[eE]/,/[mM]/,/[eE]/,/[nN]/,/[tT]/],postprocess:function(e){return e.join("")}},{name:"t_REQUIRE_PLAYER_MOVEMENT",symbols:["t_REQUIRE_PLAYER_MOVEMENT$subexpression$1"],postprocess:m},{name:"t_RUN_RULES_ON_LEVEL_START$subexpression$1",symbols:[/[rR]/,/[uU]/,/[nN]/,{literal:"_"},/[rR]/,/[uU]/,/[lL]/,/[eE]/,/[sS]/,{literal:"_"},/[oO]/,/[nN]/,{literal:"_"},/[lL]/,/[eE]/,/[vV]/,/[eE]/,/[lL]/,{literal:"_"},/[sS]/,/[tT]/,/[aA]/,/[rR]/,/[tT]/],postprocess:function(e){return e.join("")}},{name:"t_RUN_RULES_ON_LEVEL_START",symbols:["t_RUN_RULES_ON_LEVEL_START$subexpression$1"],postprocess:m},{name:"t_COLOR_PALETTE$subexpression$1",symbols:[/[cC]/,/[oO]/,/[lL]/,/[oO]/,/[rR]/,{literal:"_"},/[pP]/,/[aA]/,/[lL]/,/[eE]/,/[tT]/,/[tT]/,/[eE]/],postprocess:function(e){return e.join("")}},{name:"t_COLOR_PALETTE",symbols:["t_COLOR_PALETTE$subexpression$1"],postprocess:m},{name:"t_BACKGROUND_COLOR$subexpression$1",symbols:[/[bB]/,/[aA]/,/[cC]/,/[kK]/,/[gG]/,/[rR]/,/[oO]/,/[uU]/,/[nN]/,/[dD]/,{literal:"_"},/[cC]/,/[oO]/,/[lL]/,/[oO]/,/[rR]/],postprocess:function(e){return e.join("")}},{name:"t_BACKGROUND_COLOR",symbols:["t_BACKGROUND_COLOR$subexpression$1"],postprocess:m},{name:"t_TEXT_COLOR$subexpression$1",symbols:[/[tT]/,/[eE]/,/[xX]/,/[tT]/,{literal:"_"},/[cC]/,/[oO]/,/[lL]/,/[oO]/,/[rR]/],postprocess:function(e){return e.join("")}},{name:"t_TEXT_COLOR",symbols:["t_TEXT_COLOR$subexpression$1"],postprocess:m},{name:"t_REALTIME_INTERVAL$subexpression$1",symbols:[/[rR]/,/[eE]/,/[aA]/,/[lL]/,/[tT]/,/[iI]/,/[mM]/,/[eE]/,{literal:"_"},/[iI]/,/[nN]/,/[tT]/,/[eE]/,/[rR]/,/[vV]/,/[aA]/,/[lL]/],postprocess:function(e){return e.join("")}},{name:"t_REALTIME_INTERVAL",symbols:["t_REALTIME_INTERVAL$subexpression$1"],postprocess:m},{name:"t_KEY_REPEAT_INTERVAL$subexpression$1",symbols:[/[kK]/,/[eE]/,/[yY]/,{literal:"_"},/[rR]/,/[eE]/,/[pP]/,/[eE]/,/[aA]/,/[tT]/,{literal:"_"},/[iI]/,/[nN]/,/[tT]/,/[eE]/,/[rR]/,/[vV]/,/[aA]/,/[lL]/],postprocess:function(e){return e.join("")}},{name:"t_KEY_REPEAT_INTERVAL",symbols:["t_KEY_REPEAT_INTERVAL$subexpression$1"],postprocess:m},{name:"t_AGAIN_INTERVAL$subexpression$1",symbols:[/[aA]/,/[gG]/,/[aA]/,/[iI]/,/[nN]/,{literal:"_"},/[iI]/,/[nN]/,/[tT]/,/[eE]/,/[rR]/,/[vV]/,/[aA]/,/[lL]/],postprocess:function(e){return e.join("")}},{name:"t_AGAIN_INTERVAL",symbols:["t_AGAIN_INTERVAL$subexpression$1"],postprocess:m},{name:"t_NOACTION$subexpression$1",symbols:[/[nN]/,/[oO]/,/[aA]/,/[cC]/,/[tT]/,/[iI]/,/[oO]/,/[nN]/],postprocess:function(e){return e.join("")}},{name:"t_NOACTION",symbols:["t_NOACTION$subexpression$1"],postprocess:m},{name:"t_NOUNDO$subexpression$1",symbols:[/[nN]/,/[oO]/,/[uU]/,/[nN]/,/[dD]/,/[oO]/],postprocess:function(e){return e.join("")}},{name:"t_NOUNDO",symbols:["t_NOUNDO$subexpression$1"],postprocess:m},{name:"t_NORESTART$subexpression$1",symbols:[/[nN]/,/[oO]/,/[rR]/,/[eE]/,/[sS]/,/[tT]/,/[aA]/,/[rR]/,/[tT]/],postprocess:function(e){return e.join("")}},{name:"t_NORESTART",symbols:["t_NORESTART$subexpression$1"],postprocess:m},{name:"t_THROTTLE_MOVEMENT$subexpression$1",symbols:[/[tT]/,/[hH]/,/[rR]/,/[oO]/,/[tT]/,/[tT]/,/[lL]/,/[eE]/,{literal:"_"},/[mM]/,/[oO]/,/[vV]/,/[eE]/,/[mM]/,/[eE]/,/[nN]/,/[tT]/],postprocess:function(e){return e.join("")}},{name:"t_THROTTLE_MOVEMENT",symbols:["t_THROTTLE_MOVEMENT$subexpression$1"],postprocess:m},{name:"t_NOREPEAT_ACTION$subexpression$1",symbols:[/[nN]/,/[oO]/,/[rR]/,/[eE]/,/[pP]/,/[eE]/,/[aA]/,/[tT]/,{literal:"_"},/[aA]/,/[cC]/,/[tT]/,/[iI]/,/[oO]/,/[nN]/],postprocess:function(e){return e.join("")}},{name:"t_NOREPEAT_ACTION",symbols:["t_NOREPEAT_ACTION$subexpression$1"],postprocess:m},{name:"t_VERBOSE_LOGGING$subexpression$1",symbols:[/[vV]/,/[eE]/,/[rR]/,/[bB]/,/[oO]/,/[sS]/,/[eE]/,{literal:"_"},/[lL]/,/[oO]/,/[gG]/,/[gG]/,/[iI]/,/[nN]/,/[gG]/],postprocess:function(e){return e.join("")}},{name:"t_VERBOSE_LOGGING",symbols:["t_VERBOSE_LOGGING$subexpression$1"],postprocess:m},{name:"t_TRANSPARENT$subexpression$1",symbols:[/[tT]/,/[rR]/,/[aA]/,/[nN]/,/[sS]/,/[pP]/,/[aA]/,/[rR]/,/[eE]/,/[nN]/,/[tT]/],postprocess:function(e){return e.join("")}},{name:"t_TRANSPARENT",symbols:["t_TRANSPARENT$subexpression$1"],postprocess:m},{name:"t_MOVE$subexpression$1",symbols:[/[mM]/,/[oO]/,/[vV]/,/[eE]/],postprocess:function(e){return e.join("")}},{name:"t_MOVE",symbols:["t_MOVE$subexpression$1"],postprocess:m},{name:"t_DESTROY$subexpression$1",symbols:[/[dD]/,/[eE]/,/[sS]/,/[tT]/,/[rR]/,/[oO]/,/[yY]/],postprocess:function(e){return e.join("")}},{name:"t_DESTROY",symbols:["t_DESTROY$subexpression$1"],postprocess:m},{name:"t_CREATE$subexpression$1",symbols:[/[cC]/,/[rR]/,/[eE]/,/[aA]/,/[tT]/,/[eE]/],postprocess:function(e){return e.join("")}},{name:"t_CREATE",symbols:["t_CREATE$subexpression$1"],postprocess:m},{name:"t_CANTMOVE$subexpression$1",symbols:[/[cC]/,/[aA]/,/[nN]/,/[tT]/,/[mM]/,/[oO]/,/[vV]/,/[eE]/],postprocess:function(e){return e.join("")}},{name:"t_CANTMOVE",symbols:["t_CANTMOVE$subexpression$1"],postprocess:m},{name:"t_TITLESCREEN$subexpression$1",symbols:[/[tT]/,/[iI]/,/[tT]/,/[lL]/,/[eE]/,/[sS]/,/[cC]/,/[rR]/,/[eE]/,/[eE]/,/[nN]/],postprocess:function(e){return e.join("")}},{name:"t_TITLESCREEN",symbols:["t_TITLESCREEN$subexpression$1"],postprocess:m},{name:"t_STARTGAME$subexpression$1",symbols:[/[sS]/,/[tT]/,/[aA]/,/[rR]/,/[tT]/,/[gG]/,/[aA]/,/[mM]/,/[eE]/],postprocess:function(e){return e.join("")}},{name:"t_STARTGAME",symbols:["t_STARTGAME$subexpression$1"],postprocess:m},{name:"t_STARTLEVEL$subexpression$1",symbols:[/[sS]/,/[tT]/,/[aA]/,/[rR]/,/[tT]/,/[lL]/,/[eE]/,/[vV]/,/[eE]/,/[lL]/],postprocess:function(e){return e.join("")}},{name:"t_STARTLEVEL",symbols:["t_STARTLEVEL$subexpression$1"],postprocess:m},{name:"t_ENDLEVEL$subexpression$1",symbols:[/[eE]/,/[nN]/,/[dD]/,/[lL]/,/[eE]/,/[vV]/,/[eE]/,/[lL]/],postprocess:function(e){return e.join("")}},{name:"t_ENDLEVEL",symbols:["t_ENDLEVEL$subexpression$1"],postprocess:m},{name:"t_ENDGAME$subexpression$1",symbols:[/[eE]/,/[nN]/,/[dD]/,/[gG]/,/[aA]/,/[mM]/,/[eE]/],postprocess:function(e){return e.join("")}},{name:"t_ENDGAME",symbols:["t_ENDGAME$subexpression$1"],postprocess:m},{name:"t_SHOWMESSAGE$subexpression$1",symbols:[/[sS]/,/[hH]/,/[oO]/,/[wW]/,/[mM]/,/[eE]/,/[sS]/,/[sS]/,/[aA]/,/[gG]/,/[eE]/],postprocess:function(e){return e.join("")}},{name:"t_SHOWMESSAGE",symbols:["t_SHOWMESSAGE$subexpression$1"],postprocess:m},{name:"t_CLOSEMESSAGE$subexpression$1",symbols:[/[cC]/,/[lL]/,/[oO]/,/[sS]/,/[eE]/,/[mM]/,/[eE]/,/[sS]/,/[sS]/,/[aA]/,/[gG]/,/[eE]/],postprocess:function(e){return e.join("")}},{name:"t_CLOSEMESSAGE",symbols:["t_CLOSEMESSAGE$subexpression$1"],postprocess:m},{name:"t_GROUP_RULE_PLUS$subexpression$1",symbols:[{literal:"+"}],postprocess:function(e){return e.join("")}},{name:"t_GROUP_RULE_PLUS",symbols:["t_GROUP_RULE_PLUS$subexpression$1"],postprocess:m},{name:"t_ON$subexpression$1",symbols:[/[oO]/,/[nN]/],postprocess:function(e){return e.join("")}},{name:"t_ON",symbols:["t_ON$subexpression$1"],postprocess:m},{name:"t_NO$subexpression$1",symbols:[/[nN]/,/[oO]/],postprocess:function(e){return e.join("")}},{name:"t_NO",symbols:["t_NO$subexpression$1"],postprocess:m},{name:"t_ALL$subexpression$1",symbols:[/[aA]/,/[lL]/,/[lL]/],postprocess:function(e){return e.join("")}},{name:"t_ALL",symbols:["t_ALL$subexpression$1"],postprocess:m},{name:"t_ANY$subexpression$1",symbols:[/[aA]/,/[nN]/,/[yY]/],postprocess:function(e){return e.join("")}},{name:"t_ANY",symbols:["t_ANY$subexpression$1"],postprocess:m},{name:"t_SOME$subexpression$1",symbols:[/[sS]/,/[oO]/,/[mM]/,/[eE]/],postprocess:function(e){return e.join("")}},{name:"t_SOME",symbols:["t_SOME$subexpression$1"],postprocess:m},{name:"Title",symbols:["t_TITLE","__","words"],postprocess:([e,t,s],n)=>({type:"TITLE",value:s,sourceOffset:n})},{name:"OptionalMetaData$ebnf$1",symbols:[]},{name:"OptionalMetaData$ebnf$1$subexpression$1$ebnf$1",symbols:["lineTerminator"]},{name:"OptionalMetaData$ebnf$1$subexpression$1$ebnf$1",symbols:["OptionalMetaData$ebnf$1$subexpression$1$ebnf$1","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"OptionalMetaData$ebnf$1$subexpression$1",symbols:["_","OptionalMetaDataItem","OptionalMetaData$ebnf$1$subexpression$1$ebnf$1"]},{name:"OptionalMetaData$ebnf$1",symbols:["OptionalMetaData$ebnf$1","OptionalMetaData$ebnf$1$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"OptionalMetaData",symbols:["OptionalMetaData$ebnf$1"],postprocess:([e])=>({type:"METADATA",value:p(e)})},{name:"OptionalMetaDataItem",symbols:["t_AUTHOR","__","words"],postprocess:([e,t,s],n)=>({type:"AUTHOR",value:s,sourceOffset:n})},{name:"OptionalMetaDataItem",symbols:["t_HOMEPAGE","__","word"],postprocess:([e,t,s],n)=>({type:"HOMEPAGE",value:s,sourceOffset:n})},{name:"OptionalMetaDataItem",symbols:["t_YOUTUBE","__","word"],postprocess:([e,t,s],n)=>({type:"YOUTUBE",value:s,sourceOffset:n})},{name:"OptionalMetaDataItem",symbols:["t_ZOOMSCREEN","__","widthAndHeight"],postprocess:([e,t,s],n)=>({type:"ZOOMSCREEN",value:s,sourceOffset:n})},{name:"OptionalMetaDataItem",symbols:["t_FLICKSCREEN","__","widthAndHeight"],postprocess:([e,t,s],n)=>({type:"FLICKSCREEN",value:s,sourceOffset:n})},{name:"OptionalMetaDataItem$ebnf$1$subexpression$1$string$1",symbols:[{literal:"o"},{literal:"f"},{literal:"f"}],postprocess:e=>e.join("")},{name:"OptionalMetaDataItem$ebnf$1$subexpression$1",symbols:["__","OptionalMetaDataItem$ebnf$1$subexpression$1$string$1"]},{name:"OptionalMetaDataItem$ebnf$1",symbols:["OptionalMetaDataItem$ebnf$1$subexpression$1"],postprocess:n},{name:"OptionalMetaDataItem$ebnf$1",symbols:[],postprocess:()=>null},{name:"OptionalMetaDataItem",symbols:["t_REQUIRE_PLAYER_MOVEMENT","OptionalMetaDataItem$ebnf$1"],postprocess:([e,t,s],n)=>({type:"REQUIRE_PLAYER_MOVEMENT",value:!!s,sourceOffset:n})},{name:"OptionalMetaDataItem$ebnf$2$subexpression$1$string$1",symbols:[{literal:"t"},{literal:"r"},{literal:"u"},{literal:"e"}],postprocess:e=>e.join("")},{name:"OptionalMetaDataItem$ebnf$2$subexpression$1",symbols:["__","OptionalMetaDataItem$ebnf$2$subexpression$1$string$1"]},{name:"OptionalMetaDataItem$ebnf$2",symbols:["OptionalMetaDataItem$ebnf$2$subexpression$1"],postprocess:n},{name:"OptionalMetaDataItem$ebnf$2",symbols:[],postprocess:()=>null},{name:"OptionalMetaDataItem",symbols:["t_RUN_RULES_ON_LEVEL_START","OptionalMetaDataItem$ebnf$2"],postprocess:([e,t,s],n)=>({type:"RUN_RULES_ON_LEVEL_START",value:!0,sourceOffset:n})},{name:"OptionalMetaDataItem",symbols:["t_COLOR_PALETTE","__","word"],postprocess:([e,t,s],n)=>({type:"COLOR_PALETTE",value:s,sourceOffset:n})},{name:"OptionalMetaDataItem",symbols:["t_BACKGROUND_COLOR","__","colorNameOrHex"],postprocess:([e,t,s],n)=>({type:"BACKGROUND_COLOR",value:s,sourceOffset:n})},{name:"OptionalMetaDataItem",symbols:["t_TEXT_COLOR","__","colorNameOrHex"],postprocess:([e,t,s],n)=>({type:"TEXT_COLOR",value:s,sourceOffset:n})},{name:"OptionalMetaDataItem",symbols:["t_REALTIME_INTERVAL","__","decimal"],postprocess:([e,t,s],n)=>({type:"REALTIME_INTERVAL",value:s,sourceOffset:n})},{name:"OptionalMetaDataItem",symbols:["t_KEY_REPEAT_INTERVAL","__","decimal"],postprocess:([e,t,s],n)=>({type:"KEY_REPEAT_INTERVAL",value:s,sourceOffset:n})},{name:"OptionalMetaDataItem",symbols:["t_AGAIN_INTERVAL","__","decimal"],postprocess:([e,t,s],n)=>({type:"AGAIN_INTERVAL",value:s,sourceOffset:n})},{name:"OptionalMetaDataItem",symbols:["t_NOACTION"],postprocess:()=>({type:"NOACTION",value:!0})},{name:"OptionalMetaDataItem",symbols:["t_NOUNDO"],postprocess:()=>({type:"NOUNDO",value:!0})},{name:"OptionalMetaDataItem",symbols:["t_NOREPEAT_ACTION"],postprocess:()=>({type:"NOREPEAT_ACTION",value:!0})},{name:"OptionalMetaDataItem",symbols:["t_THROTTLE_MOVEMENT"],postprocess:()=>({type:"THROTTLE_MOVEMENT",value:!0})},{name:"OptionalMetaDataItem",symbols:["t_NORESTART"],postprocess:()=>({type:"NORESTART",value:!0})},{name:"OptionalMetaDataItem",symbols:["t_VERBOSE_LOGGING"],postprocess:()=>({type:"VERBOSE_LOGGING",value:!0})},{name:"widthAndHeight",symbols:["integer",{literal:"x"},"integer"],postprocess:([e,t,s])=>({type:"WIDTH_AND_HEIGHT",width:e,height:s})},{name:"Sprite",symbols:["SpritePixels"],postprocess:n},{name:"Sprite",symbols:["SpriteNoPixels"],postprocess:n},{name:"SpriteNoPixels$ebnf$1$subexpression$1",symbols:["__","legendShortcutChar"]},{name:"SpriteNoPixels$ebnf$1",symbols:["SpriteNoPixels$ebnf$1$subexpression$1"],postprocess:n},{name:"SpriteNoPixels$ebnf$1",symbols:[],postprocess:()=>null},{name:"SpriteNoPixels$ebnf$2",symbols:["lineTerminator"]},{name:"SpriteNoPixels$ebnf$2",symbols:["SpriteNoPixels$ebnf$2","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"SpriteNoPixels$ebnf$3",symbols:["lineTerminator"]},{name:"SpriteNoPixels$ebnf$3",symbols:["SpriteNoPixels$ebnf$3","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"SpriteNoPixels",symbols:["_","spriteName","SpriteNoPixels$ebnf$1","SpriteNoPixels$ebnf$2","_","colorDefinitions","SpriteNoPixels$ebnf$3"],postprocess:i("SpriteNoPixels")||function([e,t,s,n,o,r,i],a){return{type:"SPRITE_NO_PIXELS",name:t,mapChar:s?s[1]:null,colors:r,sourceOffset:a}}},{name:"SpritePixels$ebnf$1$subexpression$1",symbols:["__","legendShortcutChar"]},{name:"SpritePixels$ebnf$1",symbols:["SpritePixels$ebnf$1$subexpression$1"],postprocess:n},{name:"SpritePixels$ebnf$1",symbols:[],postprocess:()=>null},{name:"SpritePixels$ebnf$2",symbols:["lineTerminator"]},{name:"SpritePixels$ebnf$2",symbols:["SpritePixels$ebnf$2","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"SpritePixels$ebnf$3",symbols:["lineTerminator"]},{name:"SpritePixels$ebnf$3",symbols:["SpritePixels$ebnf$3","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"SpritePixels$ebnf$4",symbols:[]},{name:"SpritePixels$ebnf$4",symbols:["SpritePixels$ebnf$4","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"SpritePixels",symbols:["_","spriteName","SpritePixels$ebnf$1","SpritePixels$ebnf$2","_","colorDefinitions","SpritePixels$ebnf$3","PixelRows","SpritePixels$ebnf$4"],postprocess:i("SpritePixels")||function([e,t,s,n,o,r,i,a,l],c){return{type:"SPRITE_WITH_PIXELS",name:t,mapChar:s?s[1]:null,colors:r,pixels:a,sourceOffset:c}}},{name:"colorDefinitions$macrocall$2",symbols:["colorNameOrHex"]},{name:"colorDefinitions$macrocall$3",symbols:["__"]},{name:"colorDefinitions$macrocall$1$ebnf$1",symbols:[]},{name:"colorDefinitions$macrocall$1$ebnf$1$subexpression$1",symbols:["colorDefinitions$macrocall$3","colorDefinitions$macrocall$2"]},{name:"colorDefinitions$macrocall$1$ebnf$1",symbols:["colorDefinitions$macrocall$1$ebnf$1","colorDefinitions$macrocall$1$ebnf$1$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"colorDefinitions$macrocall$1",symbols:["colorDefinitions$macrocall$2","colorDefinitions$macrocall$1$ebnf$1"],postprocess:i("nonemptyListOf")||h},{name:"colorDefinitions",symbols:["colorDefinitions$macrocall$1"],postprocess:([e])=>c(e)},{name:"colorDefinitions$macrocall$5",symbols:["colorHex6"]},{name:"colorDefinitions$macrocall$6",symbols:["__"]},{name:"colorDefinitions$macrocall$4$ebnf$1",symbols:[]},{name:"colorDefinitions$macrocall$4$ebnf$1$subexpression$1",symbols:["colorDefinitions$macrocall$6","colorDefinitions$macrocall$5"]},{name:"colorDefinitions$macrocall$4$ebnf$1",symbols:["colorDefinitions$macrocall$4$ebnf$1","colorDefinitions$macrocall$4$ebnf$1$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"colorDefinitions$macrocall$4",symbols:["colorDefinitions$macrocall$5","colorDefinitions$macrocall$4$ebnf$1"],postprocess:i("nonemptyListOf")||h},{name:"colorDefinitions$macrocall$8",symbols:["colorHex6"]},{name:"colorDefinitions$macrocall$9",symbols:["__"]},{name:"colorDefinitions$macrocall$7$ebnf$1",symbols:[]},{name:"colorDefinitions$macrocall$7$ebnf$1$subexpression$1",symbols:["colorDefinitions$macrocall$9","colorDefinitions$macrocall$8"]},{name:"colorDefinitions$macrocall$7$ebnf$1",symbols:["colorDefinitions$macrocall$7$ebnf$1","colorDefinitions$macrocall$7$ebnf$1$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"colorDefinitions$macrocall$7",symbols:["colorDefinitions$macrocall$8","colorDefinitions$macrocall$7$ebnf$1"],postprocess:i("nonemptyListOf")||h},{name:"colorDefinitions",symbols:["colorDefinitions$macrocall$4","colorDefinitions$macrocall$7"],postprocess:([e,t])=>c(e.concat(t))},{name:"spriteName",symbols:["ruleVariableName"],postprocess:n},{name:"pixelRow$ebnf$1",symbols:["pixelDigit"]},{name:"pixelRow$ebnf$1",symbols:["pixelRow$ebnf$1","pixelDigit"],postprocess:e=>e[0].concat([e[1]])},{name:"pixelRow",symbols:["_","pixelRow$ebnf$1","lineTerminator"],postprocess:i("pixelRow",function([e,t,s]){return{type:"PIXEL_ROW",entries:t}})||function([e,t,s]){return t}},{name:"pixelDigit",symbols:["digit"],postprocess:n},{name:"pixelDigit",symbols:[{literal:"."}],postprocess:n},{name:"legendShortcutChar",symbols:[/[^\n ]/],postprocess:n},{name:"PixelRows$ebnf$1",symbols:["pixelRow"]},{name:"PixelRows$ebnf$1",symbols:["PixelRows$ebnf$1","pixelRow"],postprocess:e=>e[0].concat([e[1]])},{name:"PixelRows",symbols:["pixelRow","pixelRow","pixelRow","pixelRow","PixelRows$ebnf$1"],postprocess:([e,t,s,n,o])=>[e,t,s,n].concat(o)},{name:"LegendTile",symbols:["LegendTileSimple"],postprocess:n},{name:"LegendTile",symbols:["LegendTileAnd"],postprocess:n},{name:"LegendTile",symbols:["LegendTileOr"],postprocess:n},{name:"LegendTileSimple$ebnf$1",symbols:["lineTerminator"]},{name:"LegendTileSimple$ebnf$1",symbols:["LegendTileSimple$ebnf$1","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"LegendTileSimple",symbols:["_","LegendVarNameDefn","_",{literal:"="},"_","LookupLegendVarName","LegendTileSimple$ebnf$1"],postprocess:i("LegendTileSimple")||function([e,t,s,n,o,r,i,a],l){return{type:"LEGEND_ITEM_SIMPLE",name:t,value:r,sourceOffset:l}}},{name:"LegendTileAnd$macrocall$2",symbols:["LookupLegendVarName"]},{name:"LegendTileAnd$macrocall$3",symbols:["__","t_AND","__"]},{name:"LegendTileAnd$macrocall$1$ebnf$1$subexpression$1",symbols:["LegendTileAnd$macrocall$3","LegendTileAnd$macrocall$2"]},{name:"LegendTileAnd$macrocall$1$ebnf$1",symbols:["LegendTileAnd$macrocall$1$ebnf$1$subexpression$1"]},{name:"LegendTileAnd$macrocall$1$ebnf$1$subexpression$2",symbols:["LegendTileAnd$macrocall$3","LegendTileAnd$macrocall$2"]},{name:"LegendTileAnd$macrocall$1$ebnf$1",symbols:["LegendTileAnd$macrocall$1$ebnf$1","LegendTileAnd$macrocall$1$ebnf$1$subexpression$2"],postprocess:e=>e[0].concat([e[1]])},{name:"LegendTileAnd$macrocall$1",symbols:["LegendTileAnd$macrocall$2","LegendTileAnd$macrocall$1$ebnf$1"],postprocess:i("atLeast2ListOf")||h},{name:"LegendTileAnd$ebnf$1",symbols:["lineTerminator"]},{name:"LegendTileAnd$ebnf$1",symbols:["LegendTileAnd$ebnf$1","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"LegendTileAnd",symbols:["_","LegendVarNameDefn","_",{literal:"="},"_","LegendTileAnd$macrocall$1","LegendTileAnd$ebnf$1"],postprocess:i("LegendTileAnd")||function([e,t,s,n,o,r,i,a],l){return{type:"LEGEND_ITEM_AND",name:t,values:c(r),sourceOffset:l}}},{name:"LegendTileOr$macrocall$2",symbols:["LookupLegendVarName"]},{name:"LegendTileOr$macrocall$3",symbols:["__","t_OR","__"]},{name:"LegendTileOr$macrocall$1$ebnf$1$subexpression$1",symbols:["LegendTileOr$macrocall$3","LegendTileOr$macrocall$2"]},{name:"LegendTileOr$macrocall$1$ebnf$1",symbols:["LegendTileOr$macrocall$1$ebnf$1$subexpression$1"]},{name:"LegendTileOr$macrocall$1$ebnf$1$subexpression$2",symbols:["LegendTileOr$macrocall$3","LegendTileOr$macrocall$2"]},{name:"LegendTileOr$macrocall$1$ebnf$1",symbols:["LegendTileOr$macrocall$1$ebnf$1","LegendTileOr$macrocall$1$ebnf$1$subexpression$2"],postprocess:e=>e[0].concat([e[1]])},{name:"LegendTileOr$macrocall$1",symbols:["LegendTileOr$macrocall$2","LegendTileOr$macrocall$1$ebnf$1"],postprocess:i("atLeast2ListOf")||h},{name:"LegendTileOr$ebnf$1",symbols:["lineTerminator"]},{name:"LegendTileOr$ebnf$1",symbols:["LegendTileOr$ebnf$1","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"LegendTileOr",symbols:["_","LegendVarNameDefn","_",{literal:"="},"_","LegendTileOr$macrocall$1","LegendTileOr$ebnf$1"],postprocess:i("LegendTileOr")||function([e,t,s,n,o,r,i,a],l){return{type:"LEGEND_ITEM_OR",name:t,values:c(r),sourceOffset:l}}},{name:"LegendVarNameDefn",symbols:["word"],postprocess:i("LegendVarNameDefn")||n},{name:"LookupLegendVarName",symbols:["LegendVarNameDefn"],postprocess:i("LookupLegendVarName")||n},{name:"SoundItem$ebnf$1",symbols:["lineTerminator"]},{name:"SoundItem$ebnf$1",symbols:["SoundItem$ebnf$1","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"SoundItem",symbols:["_","SoundItemInner","SoundItem$ebnf$1"],postprocess:([e,t,s])=>t},{name:"SoundItemInner",symbols:["SoundItemEnum"],postprocess:n},{name:"SoundItemInner",symbols:["SoundItemSfx"],postprocess:n},{name:"SoundItemInner",symbols:["SoundItemMoveDirection"],postprocess:n},{name:"SoundItemInner",symbols:["SoundItemMoveSimple"],postprocess:n},{name:"SoundItemInner",symbols:["SoundItemNormal"],postprocess:n},{name:"soundItemSimpleOptions",symbols:["t_RESTART"],postprocess:m},{name:"soundItemSimpleOptions",symbols:["t_UNDO"],postprocess:m},{name:"soundItemSimpleOptions",symbols:["t_TITLESCREEN"],postprocess:m},{name:"soundItemSimpleOptions",symbols:["t_STARTGAME"],postprocess:m},{name:"soundItemSimpleOptions",symbols:["t_STARTLEVEL"],postprocess:m},{name:"soundItemSimpleOptions",symbols:["t_ENDLEVEL"],postprocess:m},{name:"soundItemSimpleOptions",symbols:["t_ENDGAME"],postprocess:m},{name:"soundItemSimpleOptions",symbols:["t_SHOWMESSAGE"],postprocess:m},{name:"soundItemSimpleOptions",symbols:["t_CLOSEMESSAGE"],postprocess:m},{name:"SoundItemEnum",symbols:["soundItemSimpleOptions","__","integer"],postprocess:([e,t,s],n)=>({type:"SOUND_WHEN",when:e,soundCode:s,sourceOffset:n})},{name:"SoundItemSfx",symbols:["t_SFX","__","integer"],postprocess:([e,t,s],n)=>({type:"SOUND_SFX",sfx:e,soundCode:s,sourceOffset:n})},{name:"SoundItemMoveDirection",symbols:["lookupRuleVariableName","__","t_MOVE","__","soundItemActionMoveArg","__","integer"],postprocess:([e,t,s,n,o,r,i],a)=>({type:"SOUND_SPRITE_DIRECTION",sprite:e,direction:o,soundCode:i,sourceOffset:a})},{name:"SoundItemMoveSimple",symbols:["lookupRuleVariableName","__","t_MOVE","__","integer"],postprocess:([e,t,s,n,o],r)=>({type:"SOUND_SPRITE_MOVE",sprite:e,soundCode:o,sourceOffset:r})},{name:"SoundItemNormal",symbols:["lookupRuleVariableName","__","SoundItemAction","__","integer"],postprocess:([e,t,s,n,o],r)=>({type:"SOUND_SPRITE_EVENT",sprite:e,eventEnum:s,soundCode:o,sourceOffset:r})},{name:"SoundItemAction",symbols:["t_CREATE"],postprocess:m},{name:"SoundItemAction",symbols:["t_DESTROY"],postprocess:m},{name:"SoundItemAction",symbols:["t_CANTMOVE"],postprocess:m},{name:"soundItemActionMoveArg",symbols:["t_UP"],postprocess:m},{name:"soundItemActionMoveArg",symbols:["t_DOWN"],postprocess:m},{name:"soundItemActionMoveArg",symbols:["t_LEFT"],postprocess:m},{name:"soundItemActionMoveArg",symbols:["t_RIGHT"],postprocess:m},{name:"soundItemActionMoveArg",symbols:["t_HORIZONTAL"],postprocess:m},{name:"soundItemActionMoveArg",symbols:["t_VERTICAL"],postprocess:m},{name:"CollisionLayerItem$macrocall$2",symbols:["lookupCollisionVariableName"]},{name:"CollisionLayerItem$macrocall$3$subexpression$1",symbols:["_",{literal:","},"_"]},{name:"CollisionLayerItem$macrocall$3$subexpression$1",symbols:["__"]},{name:"CollisionLayerItem$macrocall$3",symbols:["CollisionLayerItem$macrocall$3$subexpression$1"]},{name:"CollisionLayerItem$macrocall$1$ebnf$1",symbols:[]},{name:"CollisionLayerItem$macrocall$1$ebnf$1$subexpression$1",symbols:["CollisionLayerItem$macrocall$3","CollisionLayerItem$macrocall$2"]},{name:"CollisionLayerItem$macrocall$1$ebnf$1",symbols:["CollisionLayerItem$macrocall$1$ebnf$1","CollisionLayerItem$macrocall$1$ebnf$1$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"CollisionLayerItem$macrocall$1",symbols:["CollisionLayerItem$macrocall$2","CollisionLayerItem$macrocall$1$ebnf$1"],postprocess:i("nonemptyListOf")||h},{name:"CollisionLayerItem$ebnf$1",symbols:[{literal:","}],postprocess:n},{name:"CollisionLayerItem$ebnf$1",symbols:[],postprocess:()=>null},{name:"CollisionLayerItem$ebnf$2",symbols:["lineTerminator"]},{name:"CollisionLayerItem$ebnf$2",symbols:["CollisionLayerItem$ebnf$2","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"CollisionLayerItem",symbols:["_","CollisionLayerItem$macrocall$1","CollisionLayerItem$ebnf$1","CollisionLayerItem$ebnf$2"],postprocess:i("CollisionLayerItem")||function([e,t,s],n){return{type:"COLLISION_LAYER",tiles:c(t),sourceOffset:n}}},{name:"RuleItem",symbols:["RuleLoop"],postprocess:n},{name:"RuleItem",symbols:["RuleGroup"],postprocess:n},{name:"RuleItem",symbols:["Rule"],postprocess:n},{name:"Rule",symbols:["RuleWithoutMessage"],postprocess:n},{name:"Rule",symbols:["RuleWithMessage"],postprocess:n},{name:"RuleWithoutMessage$macrocall$2",symbols:["ConditionBracket"]},{name:"RuleWithoutMessage$macrocall$3$ebnf$1$subexpression$1",symbols:["RuleModifier","_"]},{name:"RuleWithoutMessage$macrocall$3$ebnf$1",symbols:["RuleWithoutMessage$macrocall$3$ebnf$1$subexpression$1"],postprocess:n},{name:"RuleWithoutMessage$macrocall$3$ebnf$1",symbols:[],postprocess:()=>null},{name:"RuleWithoutMessage$macrocall$3",symbols:["_","RuleWithoutMessage$macrocall$3$ebnf$1"]},{name:"RuleWithoutMessage$macrocall$1$ebnf$1",symbols:[]},{name:"RuleWithoutMessage$macrocall$1$ebnf$1$subexpression$1",symbols:["RuleWithoutMessage$macrocall$3","RuleWithoutMessage$macrocall$2"]},{name:"RuleWithoutMessage$macrocall$1$ebnf$1",symbols:["RuleWithoutMessage$macrocall$1$ebnf$1","RuleWithoutMessage$macrocall$1$ebnf$1$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"RuleWithoutMessage$macrocall$1",symbols:["RuleWithoutMessage$macrocall$2","RuleWithoutMessage$macrocall$1$ebnf$1"],postprocess:i("nonemptyListOf")||h},{name:"RuleWithoutMessage$string$1",symbols:[{literal:"-"},{literal:">"}],postprocess:e=>e.join("")},{name:"RuleWithoutMessage$ebnf$1",symbols:[]},{name:"RuleWithoutMessage$ebnf$1$subexpression$1",symbols:["ActionBracket"]},{name:"RuleWithoutMessage$ebnf$1",symbols:["RuleWithoutMessage$ebnf$1","RuleWithoutMessage$ebnf$1$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"RuleWithoutMessage$ebnf$2",symbols:[]},{name:"RuleWithoutMessage$ebnf$2$subexpression$1",symbols:["_","RuleCommand"]},{name:"RuleWithoutMessage$ebnf$2",symbols:["RuleWithoutMessage$ebnf$2","RuleWithoutMessage$ebnf$2$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"RuleWithoutMessage$ebnf$3",symbols:["lineTerminator"]},{name:"RuleWithoutMessage$ebnf$3",symbols:["RuleWithoutMessage$ebnf$3","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"RuleWithoutMessage",symbols:["_","LeftModifiers","RuleWithoutMessage$macrocall$1","_","RuleWithoutMessage$string$1","RuleWithoutMessage$ebnf$1","RuleWithoutMessage$ebnf$2","RuleWithoutMessage$ebnf$3"],postprocess:i("RuleWithoutMessage")||function([e,t,s,n,o,r,i,a],l){return{type:"RULE",modifiers:t,conditions:c(s),actions:c(r),commands:p(i),sourceOffset:l}}},{name:"RuleWithMessage$macrocall$2",symbols:["ConditionBracket"]},{name:"RuleWithMessage$macrocall$3$ebnf$1$subexpression$1",symbols:["RuleModifier","_"]},{name:"RuleWithMessage$macrocall$3$ebnf$1",symbols:["RuleWithMessage$macrocall$3$ebnf$1$subexpression$1"],postprocess:n},{name:"RuleWithMessage$macrocall$3$ebnf$1",symbols:[],postprocess:()=>null},{name:"RuleWithMessage$macrocall$3",symbols:["_","RuleWithMessage$macrocall$3$ebnf$1"]},{name:"RuleWithMessage$macrocall$1$ebnf$1",symbols:[]},{name:"RuleWithMessage$macrocall$1$ebnf$1$subexpression$1",symbols:["RuleWithMessage$macrocall$3","RuleWithMessage$macrocall$2"]},{name:"RuleWithMessage$macrocall$1$ebnf$1",symbols:["RuleWithMessage$macrocall$1$ebnf$1","RuleWithMessage$macrocall$1$ebnf$1$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"RuleWithMessage$macrocall$1",symbols:["RuleWithMessage$macrocall$2","RuleWithMessage$macrocall$1$ebnf$1"],postprocess:i("nonemptyListOf")||h},{name:"RuleWithMessage$string$1",symbols:[{literal:"-"},{literal:">"}],postprocess:e=>e.join("")},{name:"RuleWithMessage$ebnf$1",symbols:[]},{name:"RuleWithMessage$ebnf$1$subexpression$1",symbols:["ActionBracket"]},{name:"RuleWithMessage$ebnf$1",symbols:["RuleWithMessage$ebnf$1","RuleWithMessage$ebnf$1$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"RuleWithMessage$ebnf$2",symbols:[]},{name:"RuleWithMessage$ebnf$2$subexpression$1",symbols:["_","RuleCommand"]},{name:"RuleWithMessage$ebnf$2",symbols:["RuleWithMessage$ebnf$2","RuleWithMessage$ebnf$2$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"RuleWithMessage$ebnf$3",symbols:[]},{name:"RuleWithMessage$ebnf$3",symbols:["RuleWithMessage$ebnf$3","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"RuleWithMessage",symbols:["_","LeftModifiers","RuleWithMessage$macrocall$1","_","RuleWithMessage$string$1","RuleWithMessage$ebnf$1","RuleWithMessage$ebnf$2","_","MessageCommand","RuleWithMessage$ebnf$3"],postprocess:i("RuleWithoutMessage")||function([e,t,s,n,o,r,i,a,l,h],m){return{type:"RULE",modifiers:t,conditions:c(s),actions:c(r),commands:p(i),message:l,sourceOffset:m}}},{name:"ConditionBracket",symbols:["NormalRuleBracket"],postprocess:([{neighbors:e,againHack:t,debugFlag:s}],n)=>({type:"BRACKET",neighbors:e,againHack:t,debugFlag:s,sourceOffset:n})},{name:"ConditionBracket",symbols:["EllipsisRuleBracket"],postprocess:([{beforeNeighbors:e,afterNeighbors:t,debugFlag:s}],n)=>({type:"ELLIPSIS_BRACKET",beforeNeighbors:e,afterNeighbors:t,debugFlag:s,sourceOffset:n})},{name:"ActionBracket$ebnf$1",symbols:[]},{name:"ActionBracket$ebnf$1$subexpression$1",symbols:["_","RuleModifier"]},{name:"ActionBracket$ebnf$1",symbols:["ActionBracket$ebnf$1","ActionBracket$ebnf$1$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"ActionBracket",symbols:["ActionBracket$ebnf$1","_","NormalRuleBracket"],postprocess:([e,t,{neighbors:s,againHack:n,debugFlag:o}],r)=>({type:"BRACKET",neighbors:s,againHack:n,debugFlag:o,sourceOffset:r})},{name:"ActionBracket$ebnf$2",symbols:[]},{name:"ActionBracket$ebnf$2$subexpression$1",symbols:["_","RuleModifier"]},{name:"ActionBracket$ebnf$2",symbols:["ActionBracket$ebnf$2","ActionBracket$ebnf$2$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"ActionBracket",symbols:["ActionBracket$ebnf$2","_","EllipsisRuleBracket"],postprocess:([e,t,{beforeNeighbors:s,afterNeighbors:n,debugFlag:o}],r)=>({type:"ELLIPSIS_BRACKET",beforeNeighbors:s,afterNeighbors:n,debugFlag:o,sourceOffset:r})},{name:"LeftModifiers$macrocall$2",symbols:["RuleModifierLeft"]},{name:"LeftModifiers$macrocall$3",symbols:["__"]},{name:"LeftModifiers$macrocall$1$ebnf$1",symbols:[]},{name:"LeftModifiers$macrocall$1$ebnf$1$subexpression$1",symbols:["LeftModifiers$macrocall$3","LeftModifiers$macrocall$2"]},{name:"LeftModifiers$macrocall$1$ebnf$1",symbols:["LeftModifiers$macrocall$1$ebnf$1","LeftModifiers$macrocall$1$ebnf$1$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"LeftModifiers$macrocall$1",symbols:["LeftModifiers$macrocall$2","LeftModifiers$macrocall$1$ebnf$1"],postprocess:i("nonemptyListOf")||h},{name:"LeftModifiers",symbols:["LeftModifiers$macrocall$1","_"],postprocess:([e])=>c(e)},{name:"LeftModifiers",symbols:[],postprocess:()=>[]},{name:"RuleBracket",symbols:["EllipsisRuleBracket"],postprocess:n},{name:"RuleBracket",symbols:["NormalRuleBracket"],postprocess:n},{name:"NormalRuleBracket$macrocall$2",symbols:["RuleBracketNeighbor"]},{name:"NormalRuleBracket$macrocall$3",symbols:[{literal:"|"}]},{name:"NormalRuleBracket$macrocall$1$ebnf$1",symbols:[]},{name:"NormalRuleBracket$macrocall$1$ebnf$1$subexpression$1",symbols:["NormalRuleBracket$macrocall$3","NormalRuleBracket$macrocall$2"]},{name:"NormalRuleBracket$macrocall$1$ebnf$1",symbols:["NormalRuleBracket$macrocall$1$ebnf$1","NormalRuleBracket$macrocall$1$ebnf$1$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"NormalRuleBracket$macrocall$1",symbols:["NormalRuleBracket$macrocall$2","NormalRuleBracket$macrocall$1$ebnf$1"],postprocess:i("nonemptyListOf")||h},{name:"NormalRuleBracket$ebnf$1$subexpression$1",symbols:["t_AGAIN","_"]},{name:"NormalRuleBracket$ebnf$1",symbols:["NormalRuleBracket$ebnf$1$subexpression$1"],postprocess:n},{name:"NormalRuleBracket$ebnf$1",symbols:[],postprocess:()=>null},{name:"NormalRuleBracket$ebnf$2$subexpression$1",symbols:["_","t_DEBUGGER"]},{name:"NormalRuleBracket$ebnf$2",symbols:["NormalRuleBracket$ebnf$2$subexpression$1"],postprocess:n},{name:"NormalRuleBracket$ebnf$2",symbols:[],postprocess:()=>null},{name:"NormalRuleBracket",symbols:[{literal:"["},"NormalRuleBracket$macrocall$1","NormalRuleBracket$ebnf$1",{literal:"]"},"NormalRuleBracket$ebnf$2"],postprocess:i("NormalRuleBracket")||function([e,t,s,n,o],r){return{type:"_INNER_BRACKET",neighbors:c(t),againHack:!!s,debugFlag:o?o[1]:null,sourceOffset:r}}},{name:"EllipsisRuleBracket$macrocall$2",symbols:["RuleBracketNeighbor"]},{name:"EllipsisRuleBracket$macrocall$3",symbols:[{literal:"|"}]},{name:"EllipsisRuleBracket$macrocall$1$ebnf$1",symbols:[]},{name:"EllipsisRuleBracket$macrocall$1$ebnf$1$subexpression$1",symbols:["EllipsisRuleBracket$macrocall$3","EllipsisRuleBracket$macrocall$2"]},{name:"EllipsisRuleBracket$macrocall$1$ebnf$1",symbols:["EllipsisRuleBracket$macrocall$1$ebnf$1","EllipsisRuleBracket$macrocall$1$ebnf$1$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"EllipsisRuleBracket$macrocall$1",symbols:["EllipsisRuleBracket$macrocall$2","EllipsisRuleBracket$macrocall$1$ebnf$1"],postprocess:i("nonemptyListOf")||h},{name:"EllipsisRuleBracket$macrocall$5",symbols:["RuleBracketNeighbor"]},{name:"EllipsisRuleBracket$macrocall$6",symbols:[{literal:"|"}]},{name:"EllipsisRuleBracket$macrocall$4$ebnf$1",symbols:[]},{name:"EllipsisRuleBracket$macrocall$4$ebnf$1$subexpression$1",symbols:["EllipsisRuleBracket$macrocall$6","EllipsisRuleBracket$macrocall$5"]},{name:"EllipsisRuleBracket$macrocall$4$ebnf$1",symbols:["EllipsisRuleBracket$macrocall$4$ebnf$1","EllipsisRuleBracket$macrocall$4$ebnf$1$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"EllipsisRuleBracket$macrocall$4",symbols:["EllipsisRuleBracket$macrocall$5","EllipsisRuleBracket$macrocall$4$ebnf$1"],postprocess:i("nonemptyListOf")||h},{name:"EllipsisRuleBracket$ebnf$1$subexpression$1",symbols:["_","t_DEBUGGER"]},{name:"EllipsisRuleBracket$ebnf$1",symbols:["EllipsisRuleBracket$ebnf$1$subexpression$1"],postprocess:n},{name:"EllipsisRuleBracket$ebnf$1",symbols:[],postprocess:()=>null},{name:"EllipsisRuleBracket",symbols:[{literal:"["},"EllipsisRuleBracket$macrocall$1",{literal:"|"},"_","t_ELLIPSIS","_",{literal:"|"},"EllipsisRuleBracket$macrocall$4",{literal:"]"},"EllipsisRuleBracket$ebnf$1"],postprocess:i("EllipsisRuleBracket")||function([e,t,s,n,o,r,i,a,l,p],h){return{type:"_INNER_ELLIPSIS_BRACKET",beforeNeighbors:c(t),afterNeighbors:c(a),debugFlag:p?p[1]:null,sourceOffset:h}}},{name:"RuleBracketNeighbor",symbols:["RuleBracketNoEllipsisNeighbor"],postprocess:n},{name:"RuleBracketNeighbor",symbols:["RuleBracketEmptyNeighbor"],postprocess:n},{name:"RuleBracketNoEllipsisNeighbor$macrocall$2",symbols:["TileWithModifier"]},{name:"RuleBracketNoEllipsisNeighbor$macrocall$3",symbols:["__"]},{name:"RuleBracketNoEllipsisNeighbor$macrocall$1$ebnf$1",symbols:[]},{name:"RuleBracketNoEllipsisNeighbor$macrocall$1$ebnf$1$subexpression$1",symbols:["RuleBracketNoEllipsisNeighbor$macrocall$3","RuleBracketNoEllipsisNeighbor$macrocall$2"]},{name:"RuleBracketNoEllipsisNeighbor$macrocall$1$ebnf$1",symbols:["RuleBracketNoEllipsisNeighbor$macrocall$1$ebnf$1","RuleBracketNoEllipsisNeighbor$macrocall$1$ebnf$1$subexpression$1"],postprocess:e=>e[0].concat([e[1]])},{name:"RuleBracketNoEllipsisNeighbor$macrocall$1",symbols:["RuleBracketNoEllipsisNeighbor$macrocall$2","RuleBracketNoEllipsisNeighbor$macrocall$1$ebnf$1"],postprocess:i("nonemptyListOf")||h},{name:"RuleBracketNoEllipsisNeighbor$ebnf$1$subexpression$1",symbols:["_","t_DEBUGGER"]},{name:"RuleBracketNoEllipsisNeighbor$ebnf$1",symbols:["RuleBracketNoEllipsisNeighbor$ebnf$1$subexpression$1"],postprocess:n},{name:"RuleBracketNoEllipsisNeighbor$ebnf$1",symbols:[],postprocess:()=>null},{name:"RuleBracketNoEllipsisNeighbor",symbols:["_","RuleBracketNoEllipsisNeighbor$macrocall$1","RuleBracketNoEllipsisNeighbor$ebnf$1","_"],postprocess:i("RuleBracketNoEllipsisNeighbor")||function([e,t,s,n],o){return{type:"NEIGHBOR",tilesWithModifier:c(t),debugFlag:s?s[1]:null,sourceOffset:o}}},{name:"RuleBracketEmptyNeighbor",symbols:["_"],postprocess:i("RuleBracketEmptyNeighbor")||function([e],t){return{type:"NEIGHBOR",tilesWithModifier:[],sourceOffset:t}}},{name:"TileWithModifier$ebnf$1$subexpression$1",symbols:["tileModifier","__"]},{name:"TileWithModifier$ebnf$1",symbols:["TileWithModifier$ebnf$1$subexpression$1"],postprocess:n},{name:"TileWithModifier$ebnf$1",symbols:[],postprocess:()=>null},{name:"TileWithModifier",symbols:["TileWithModifier$ebnf$1","lookupRuleVariableName"],postprocess:i("TileWithModifier")||function([e,t],s){return{type:"TILE_WITH_MODIFIER",modifier:e?e[0]:null,tile:t,sourceOffset:s}}},{name:"tileModifier",symbols:["t_NO"],postprocess:m},{name:"tileModifier",symbols:["t_LEFT"],postprocess:m},{name:"tileModifier",symbols:["t_RIGHT"],postprocess:m},{name:"tileModifier",symbols:["t_UP"],postprocess:m},{name:"tileModifier",symbols:["t_DOWN"],postprocess:m},{name:"tileModifier",symbols:["t_RANDOMDIR"],postprocess:m},{name:"tileModifier",symbols:["t_RANDOM"],postprocess:m},{name:"tileModifier",symbols:["t_STATIONARY"],postprocess:m},{name:"tileModifier",symbols:["t_MOVING"],postprocess:m},{name:"tileModifier",symbols:["t_ACTION"],postprocess:m},{name:"tileModifier",symbols:["t_VERTICAL"],postprocess:m},{name:"tileModifier",symbols:["t_HORIZONTAL"],postprocess:m},{name:"tileModifier",symbols:["t_PERPENDICULAR"],postprocess:m},{name:"tileModifier",symbols:["t_PARALLEL"],postprocess:m},{name:"tileModifier",symbols:["t_ORTHOGONAL"],postprocess:m},{name:"tileModifier",symbols:["t_ARROW_ANY"],postprocess:m},{name:"RuleModifier",symbols:["t_RANDOM"],postprocess:m},{name:"RuleModifier",symbols:["t_UP"],postprocess:m},{name:"RuleModifier",symbols:["t_DOWN"],postprocess:m},{name:"RuleModifier",symbols:["t_LEFT"],postprocess:m},{name:"RuleModifier",symbols:["t_RIGHT"],postprocess:m},{name:"RuleModifier",symbols:["t_VERTICAL"],postprocess:m},{name:"RuleModifier",symbols:["t_HORIZONTAL"],postprocess:m},{name:"RuleModifier",symbols:["t_ORTHOGONAL"],postprocess:m},{name:"RuleModifierLeft",symbols:["RuleModifier"],postprocess:n},{name:"RuleModifierLeft",symbols:["t_LATE"],postprocess:m},{name:"RuleModifierLeft",symbols:["t_RIGID"],postprocess:m},{name:"RuleCommand",symbols:["t_AGAIN"],postprocess:(e,t)=>({type:"COMMAND_AGAIN",sourceOffset:t})},{name:"RuleCommand",symbols:["t_CANCEL"],postprocess:(e,t)=>({type:"COMMAND_CANCEL",sourceOffset:t})},{name:"RuleCommand",symbols:["t_CHECKPOINT"],postprocess:(e,t)=>({type:"COMMAND_CHECKPOINT",sourceOffset:t})},{name:"RuleCommand",symbols:["t_RESTART"],postprocess:(e,t)=>({type:"COMMAND_RESTART",sourceOffset:t})},{name:"RuleCommand",symbols:["t_WIN"],postprocess:(e,t)=>({type:"COMMAND_WIN",sourceOffset:t})},{name:"RuleCommand",symbols:["t_SFX"],postprocess:([e],t)=>({type:"COMMAND_SFX",sfx:e,sourceOffset:t})},{name:"MessageCommand",symbols:["t_MESSAGE","messageLine"],postprocess:([e,t],s)=>({type:"COMMAND_MESSAGE",message:t,sourceOffset:s})},{name:"RuleLoop$ebnf$1$subexpression$1",symbols:["_","t_DEBUGGER"]},{name:"RuleLoop$ebnf$1",symbols:["RuleLoop$ebnf$1$subexpression$1"],postprocess:n},{name:"RuleLoop$ebnf$1",symbols:[],postprocess:()=>null},{name:"RuleLoop$ebnf$2",symbols:["lineTerminator"]},{name:"RuleLoop$ebnf$2",symbols:["RuleLoop$ebnf$2","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"RuleLoop$ebnf$3$subexpression$1",symbols:["RuleItem"]},{name:"RuleLoop$ebnf$3",symbols:["RuleLoop$ebnf$3$subexpression$1"]},{name:"RuleLoop$ebnf$3$subexpression$2",symbols:["RuleItem"]},{name:"RuleLoop$ebnf$3",symbols:["RuleLoop$ebnf$3","RuleLoop$ebnf$3$subexpression$2"],postprocess:e=>e[0].concat([e[1]])},{name:"RuleLoop$ebnf$4",symbols:["lineTerminator"]},{name:"RuleLoop$ebnf$4",symbols:["RuleLoop$ebnf$4","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"RuleLoop",symbols:["RuleLoop$ebnf$1","_","t_STARTLOOP","RuleLoop$ebnf$2","RuleLoop$ebnf$3","_","t_ENDLOOP","RuleLoop$ebnf$4"],postprocess:([e,t,s,n,o,r,i,a])=>({type:"RULE_LOOP",rules:c(o)})},{name:"RuleGroup$ebnf$1$subexpression$1",symbols:["_","t_GROUP_RULE_PLUS","Rule"]},{name:"RuleGroup$ebnf$1",symbols:["RuleGroup$ebnf$1$subexpression$1"]},{name:"RuleGroup$ebnf$1$subexpression$2",symbols:["_","t_GROUP_RULE_PLUS","Rule"]},{name:"RuleGroup$ebnf$1",symbols:["RuleGroup$ebnf$1","RuleGroup$ebnf$1$subexpression$2"],postprocess:e=>e[0].concat([e[1]])},{name:"RuleGroup",symbols:["Rule","RuleGroup$ebnf$1"],postprocess:([e,t],s)=>({type:"RULE_GROUP",rules:[e].concat((e=>e.map(e=>{if(e.length<3)throw new Error("BUG: Expected items to have at least 3 elements (usually used in listOf[...])");return e[2]}))(t)),sourceOffset:s})},{name:"WinConditionItem$ebnf$1",symbols:["lineTerminator"]},{name:"WinConditionItem$ebnf$1",symbols:["WinConditionItem$ebnf$1","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"WinConditionItem",symbols:["_","winConditionItemPrefix","__","lookupRuleVariableName","WinConditionItem$ebnf$1"],postprocess:i("WinConditionItem")||function([e,t,s,n,o],r){return{type:"WINCONDITION_SIMPLE",qualifier:t,sprite:n,sourceOffset:r}}},{name:"WinConditionItem$ebnf$2",symbols:["lineTerminator"]},{name:"WinConditionItem$ebnf$2",symbols:["WinConditionItem$ebnf$2","lineTerminator"],postprocess:e=>e[0].concat([e[1]])},{name:"WinConditionItem",symbols:["_","winConditionItemPrefix","__","lookupRuleVariableName","__","t_ON","__","lookupRuleVariableName","WinConditionItem$ebnf$2"],postprocess:i("WinConditionItem")||function([e,t,s,n,o,r,i,a,l],c){return{type:"WINCONDITION_ON",qualifier:t,sprite:n,onSprite:a,sourceOffset:c}}},{name:"winConditionItemPrefix",symbols:["t_NO"],postprocess:n},{name:"winConditionItemPrefix",symbols:["t_ALL"],postprocess:n},{name:"winConditionItemPrefix",symbols:["t_ANY"],postprocess:n},{name:"winConditionItemPrefix",symbols:["t_SOME"],postprocess:n},{name:"LevelItem",symbols:["GameMessageLevel"],postprocess:n},{name:"LevelItem",symbols:["levelMapRow"],postprocess:n},{name:"LevelItem",symbols:["SeparatorLine"],postprocess:n},{name:"GameMessageLevel",symbols:["_","t_MESSAGE","messageLine"],postprocess:([e,t,s],n)=>({type:"LEVEL_MESSAGE",message:s,sourceOffset:n})},{name:"messageLine$ebnf$1",symbols:[]},{name:"messageLine$ebnf$1",symbols:["messageLine$ebnf$1",/[^\n]/],postprocess:e=>e[0].concat([e[1]])},{name:"messageLine",symbols:["messageLine$ebnf$1",/[\n]/],postprocess:i("messageLine")||function([e,t]){return e.join("").trim()}},{name:"levelMapRow$ebnf$1",symbols:[/[^\n \t\(]/]},{name:"levelMapRow$ebnf$1",symbols:["levelMapRow$ebnf$1",/[^\n \t\(]/],postprocess:e=>e[0].concat([e[1]])},{name:"levelMapRow",symbols:["_","levelMapRow$ebnf$1","lineTerminator"],postprocess:([e,t],s,n)=>{return t.join("").toUpperCase().startsWith("MESSAGE")?n:{type:"LEVEL_ROW",rowData:t.map(([e])=>e[0]),sourceOffset:s}}},{name:"SeparatorLine",symbols:["lineTerminator"],postprocess:(e,t)=>({type:"LEVEL_SEPARATOR",sourceOffset:t})}],t.ParserStart="main"},function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))(function(o,r){function i(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){e.done?o(e.value):new s(function(t){t(e.value)}).then(i,a)}l((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=s(31);t.closeSounds=o.closeSounds,t.playSound=function(e){return n(this,void 0,void 0,function*(){return o.playSound(e.soundCode)})}},function(e,t,s){const{RNG:n}=s(32),{MakeRiff:o}=s(33);var r,i=.25,a=5512,l=8,c=0,p=["square","sawtooth","sine","noise","triangle","breaker"];function h(){try{null==r&&("undefined"!=typeof AudioContext?r=new AudioContext:"undefined"!=typeof webkitAudioContext&&(r=new webkitAudioContext))}catch(e){window.console.log(e)}}h();var m;function u(){var e={};return e.wave_type=c,e.p_env_attack=0,e.p_env_sustain=.3,e.p_env_punch=0,e.p_env_decay=.4,e.p_base_freq=.3,e.p_freq_limit=0,e.p_freq_ramp=0,e.p_freq_dramp=0,e.p_vib_strength=0,e.p_vib_speed=0,e.p_arp_mod=0,e.p_arp_speed=0,e.p_duty=0,e.p_duty_ramp=0,e.p_repeat_speed=0,e.p_pha_offset=0,e.p_pha_ramp=0,e.p_lpf_freq=1,e.p_lpf_ramp=0,e.p_lpf_resonance=0,e.p_hpf_freq=0,e.p_hpf_ramp=0,e.sound_vol=.5,e.sample_rate=44100,e.bit_depth=8,e}var f=!1;function $(e){return f?m.uniform()*e:Math.random()*e}function b(e){return f?Math.floor(m.uniform()*(e+1)):Math.floor(Math.random()*(e+1))}pickupCoin=function(){var e=u();if(e.wave_type=Math.floor($(p.length)),3===e.wave_type&&(e.wave_type=0),e.p_base_freq=.4+$(.5),e.p_env_attack=0,e.p_env_sustain=$(.1),e.p_env_decay=.1+$(.4),e.p_env_punch=.3+$(.3),b(1)){e.p_arp_speed=.5+$(.2);var t=1+(1|$(7)),s=t+(1|$(7))+2;e.p_arp_mod=+t/+s}return e},laserShoot=function(){var e=u();return e.wave_type=b(2),2===e.wave_type&&b(1)&&(e.wave_type=b(1)),e.wave_type=Math.floor($(p.length)),3===e.wave_type&&(e.wave_type=c),e.p_base_freq=.5+$(.5),e.p_freq_limit=e.p_base_freq-.2-$(.6),e.p_freq_limit<.2&&(e.p_freq_limit=.2),e.p_freq_ramp=-.15-$(.2),0===b(2)&&(e.p_base_freq=.3+$(.6),e.p_freq_limit=$(.1),e.p_freq_ramp=-.35-$(.3)),b(1)?(e.p_duty=$(.5),e.p_duty_ramp=$(.2)):(e.p_duty=.4+$(.5),e.p_duty_ramp=-$(.7)),e.p_env_attack=0,e.p_env_sustain=.1+$(.2),e.p_env_decay=$(.4),b(1)&&(e.p_env_punch=$(.3)),0===b(2)&&(e.p_pha_offset=$(.2),e.p_pha_ramp=-$(.2)),b(1)&&(e.p_hpf_freq=$(.3)),e},explosion=function(){var e=u();return b(1)?(e.p_base_freq=.1+$(.4),e.p_freq_ramp=-.1+$(.4)):(e.p_base_freq=.2+$(.7),e.p_freq_ramp=-.2-$(.2)),e.p_base_freq*=e.p_base_freq,0===b(4)&&(e.p_freq_ramp=0),0===b(2)&&(e.p_repeat_speed=.3+$(.5)),e.p_env_attack=0,e.p_env_sustain=.1+$(.3),e.p_env_decay=$(.5),0===b(1)&&(e.p_pha_offset=-.3+$(.9),e.p_pha_ramp=-$(.3)),e.p_env_punch=.2+$(.6),b(1)&&(e.p_vib_strength=$(.7),e.p_vib_speed=$(.6)),0===b(2)&&(e.p_arp_speed=.6+$(.3),e.p_arp_mod=.8-$(1.6)),e},birdSound=function(){var e=u();return $(10)<1?(e.wave_type=Math.floor($(p.length)),3===e.wave_type&&(e.wave_type=c),e.p_env_attack=.4304400932967592+$(.2)-.1,e.p_env_sustain=.15739346034252394+$(.2)-.1,e.p_env_punch=.004488201744871758+$(.2)-.1,e.p_env_decay=.07478075528212291+$(.2)-.1,e.p_base_freq=.9865265720147687+$(.2)-.1,e.p_freq_limit=0+$(.2)-.1,e.p_freq_ramp=-.2995018224359539+$(.2)-.1,$(1)<.5&&(e.p_freq_ramp=.1+$(.15)),e.p_freq_dramp=.004598608156964473+$(.1)-.05,e.p_vib_strength=-.2202799497929496+$(.2)-.1,e.p_vib_speed=.8084998703158364+$(.2)-.1,e.p_arp_mod=0,e.p_arp_speed=0,e.p_duty=-.9031808754347107+$(.2)-.1,e.p_duty_ramp=-.8128699999808343+$(.2)-.1,e.p_repeat_speed=.601486018931999+$(.2)-.1,e.p_pha_offset=-.9424902314367765+$(.2)-.1,e.p_pha_ramp=-.1055482222272056+$(.2)-.1,e.p_lpf_freq=.9989765717851521+$(.2)-.1,e.p_lpf_ramp=-.25051720626043017+$(.2)-.1,e.p_lpf_resonance=.32777871505494693+$(.2)-.1,e.p_hpf_freq=.0023548750981756753+$(.2)-.1,e.p_hpf_ramp=-.002375673204842568+$(.2)-.1,e):$(10)<1?(e.wave_type=Math.floor($(p.length)),3===e.wave_type&&(e.wave_type=c),e.p_env_attack=.5277795946672003+$(.2)-.1,e.p_env_sustain=.18243733568468432+$(.2)-.1,e.p_env_punch=-.020159754546840117+$(.2)-.1,e.p_env_decay=.1561353422051903+$(.2)-.1,e.p_base_freq=.9028855606533718+$(.2)-.1,e.p_freq_limit=-.008842787837148716,e.p_freq_ramp=-.1,e.p_freq_dramp=-.012891241489551925,e.p_vib_strength=-.17923136138403065+$(.2)-.1,e.p_vib_speed=.908263385610142+$(.2)-.1,e.p_arp_mod=.41690153355414894+$(.2)-.1,e.p_arp_speed=.0010766233195860704+$(.2)-.1,e.p_duty=-.8735363011184684+$(.2)-.1,e.p_duty_ramp=-.7397985366747507+$(.2)-.1,e.p_repeat_speed=.0591789344172107+$(.2)-.1,e.p_pha_offset=-.9961184222777699+$(.2)-.1,e.p_pha_ramp=-.08234769395850523+$(.2)-.1,e.p_lpf_freq=.9412475115697335+$(.2)-.1,e.p_lpf_ramp=-.18261358925834958+$(.2)-.1,e.p_lpf_resonance=.24541438107389477+$(.2)-.1,e.p_hpf_freq=-.01831940280978611+$(.2)-.1,e.p_hpf_ramp=-.03857383633171346+$(.2)-.1,e):$(10)<1?(e.wave_type=Math.floor($(p.length)),3===e.wave_type&&(e.wave_type=c),e.p_env_attack=.4304400932967592+$(.2)-.1,e.p_env_sustain=.15739346034252394+$(.2)-.1,e.p_env_punch=.004488201744871758+$(.2)-.1,e.p_env_decay=.07478075528212291+$(.2)-.1,e.p_base_freq=.9865265720147687+$(.2)-.1,e.p_freq_limit=0+$(.2)-.1,e.p_freq_ramp=-.2995018224359539+$(.2)-.1,e.p_freq_dramp=.004598608156964473+$(.2)-.1,e.p_vib_strength=-.2202799497929496+$(.2)-.1,e.p_vib_speed=.8084998703158364+$(.2)-.1,e.p_arp_mod=-.46410459213693644+$(.2)-.1,e.p_arp_speed=-.10955361249587248+$(.2)-.1,e.p_duty=-.9031808754347107+$(.2)-.1,e.p_duty_ramp=-.8128699999808343+$(.2)-.1,e.p_repeat_speed=.7014860189319991+$(.2)-.1,e.p_pha_offset=-.9424902314367765+$(.2)-.1,e.p_pha_ramp=-.1055482222272056+$(.2)-.1,e.p_lpf_freq=.9989765717851521+$(.2)-.1,e.p_lpf_ramp=-.25051720626043017+$(.2)-.1,e.p_lpf_resonance=.32777871505494693+$(.2)-.1,e.p_hpf_freq=.0023548750981756753+$(.2)-.1,e.p_hpf_ramp=-.002375673204842568+$(.2)-.1,e):$(5)>1?(e.wave_type=Math.floor($(p.length)),3===e.wave_type&&(e.wave_type=c),b(1)?(e.p_arp_mod=.2697849293151393+$(.2)-.1,e.p_arp_speed=-.3131172257760948+$(.2)-.1,e.p_base_freq=.8090588299313949+$(.2)-.1,e.p_duty=-.6210022920964955+$(.2)-.1,e.p_duty_ramp=-.00043441813553182567+$(.2)-.1,e.p_env_attack=.004321877246874195+$(.2)-.1,e.p_env_decay=.1+$(.2)-.1,e.p_env_punch=.061737781504416146+$(.2)-.1,e.p_env_sustain=.4987252564798832+$(.2)-.1,e.p_freq_dramp=.31700340314222614+$(.2)-.1,e.p_freq_limit=0+$(.2)-.1,e.p_freq_ramp=-.163380391341416+$(.2)-.1,e.p_hpf_freq=.4709005021145149+$(.2)-.1,e.p_hpf_ramp=.6924667290539194+$(.2)-.1,e.p_lpf_freq=.8351398631384511+$(.2)-.1,e.p_lpf_ramp=.36616557192873134+$(.2)-.1,e.p_lpf_resonance=-.08685777111664439+$(.2)-.1,e.p_pha_offset=-.036084571580025544+$(.2)-.1,e.p_pha_ramp=-.014806445085568108+$(.2)-.1,e.p_repeat_speed=-.8094368475518489+$(.2)-.1,e.p_vib_speed=.4496665457171294+$(.2)-.1,e.p_vib_strength=.23413762515532424+$(.2)-.1):(e.p_arp_mod=-.35697118026766184+$(.2)-.1,e.p_arp_speed=.3581140690559588+$(.2)-.1,e.p_base_freq=1.3260897696157528+$(.2)-.1,e.p_duty=-.30984900436710694+$(.2)-.1,e.p_duty_ramp=-.0014374759133411626+$(.2)-.1,e.p_env_attack=.3160357835682254+$(.2)-.1,e.p_env_decay=.1+$(.2)-.1,e.p_env_punch=.24323114016870148+$(.2)-.1,e.p_env_sustain=.4+$(.2)-.1,e.p_freq_dramp=.2866475886237244+$(.2)-.1,e.p_freq_limit=0+$(.2)-.1,e.p_freq_ramp=-.10956352368742976+$(.2)-.1,e.p_hpf_freq=.20772718017889846+$(.2)-.1,e.p_hpf_ramp=.1564090637378835+$(.2)-.1,e.p_lpf_freq=.6021372770637031+$(.2)-.1,e.p_lpf_ramp=.24016227139979027+$(.2)-.1,e.p_lpf_resonance=-.08787383821160144+$(.2)-.1,e.p_pha_offset=-.381597686151701+$(.2)-.1,e.p_pha_ramp=-.0002481687661373495+$(.2)-.1,e.p_repeat_speed=.07812112809425686+$(.2)-.1,e.p_vib_speed=-.13648848579133943+$(.2)-.1,e.p_vib_strength=.0018874158972302657+$(.2)-.1),e):(e.wave_type=Math.floor($(p.length)),1!==e.wave_type&&3!==e.wave_type||(e.wave_type=2),e.p_base_freq=.85+$(.15),e.p_freq_ramp=.3+$(.15),e.p_env_attack=0+$(.09),e.p_env_sustain=.2+$(.3),e.p_env_decay=0+$(.1),e.p_duty=$(2)-1,e.p_duty_ramp=Math.pow($(2)-1,3),e.p_repeat_speed=.5+$(.1),e.p_pha_offset=-.3+$(.9),e.p_pha_ramp=-$(.3),e.p_arp_speed=.4+$(.6),e.p_arp_mod=.8+$(.1),e.p_lpf_resonance=$(2)-1,e.p_lpf_freq=1-Math.pow($(1),3),e.p_lpf_ramp=Math.pow($(2)-1,3),e.p_lpf_freq<.1&&e.p_lpf_ramp<-.05&&(e.p_lpf_ramp=-e.p_lpf_ramp),e.p_hpf_freq=Math.pow($(1),5),e.p_hpf_ramp=Math.pow($(2)-1,5),e)},pushSound=function(){var e=u();return e.wave_type=Math.floor($(p.length)),2===e.wave_type&&e.wave_type++,0===e.wave_type&&(e.wave_type=3),e.p_base_freq=.1+$(.4),e.p_freq_ramp=.05+$(.2),e.p_env_attack=.01+$(.09),e.p_env_sustain=.01+$(.09),e.p_env_decay=.01+$(.09),e.p_repeat_speed=.3+$(.5),e.p_pha_offset=-.3+$(.9),e.p_pha_ramp=-$(.3),e.p_arp_speed=.6+$(.3),e.p_arp_mod=.8-$(1.6),e},powerUp=function(){var e=u();return b(1)?e.wave_type=1:e.p_duty=$(.6),e.wave_type=Math.floor($(p.length)),3===e.wave_type&&(e.wave_type=c),b(1)?(e.p_base_freq=.2+$(.3),e.p_freq_ramp=.1+$(.4),e.p_repeat_speed=.4+$(.4)):(e.p_base_freq=.2+$(.3),e.p_freq_ramp=.05+$(.2),b(1)&&(e.p_vib_strength=$(.7),e.p_vib_speed=$(.6))),e.p_env_attack=0,e.p_env_sustain=$(.4),e.p_env_decay=.1+$(.4),e},hitHurt=function(){return result=u(),result.wave_type=b(2),2===result.wave_type&&(result.wave_type=3),result.wave_type===c&&(result.p_duty=$(.6)),result.wave_type=Math.floor($(p.length)),result.p_base_freq=.2+$(.6),result.p_freq_ramp=-.3-$(.4),result.p_env_attack=0,result.p_env_sustain=$(.1),result.p_env_decay=.1+$(.2),b(1)&&(result.p_hpf_freq=$(.3)),result},jump=function(){return result=u(),result.wave_type=c,result.wave_type=Math.floor($(p.length)),3===result.wave_type&&(result.wave_type=c),result.p_duty=$(.6),result.p_base_freq=.3+$(.3),result.p_freq_ramp=.1+$(.2),result.p_env_attack=0,result.p_env_sustain=.1+$(.3),result.p_env_decay=.1+$(.2),b(1)&&(result.p_hpf_freq=$(.3)),b(1)&&(result.p_lpf_freq=1-$(.6)),result},blipSelect=function(){return result=u(),result.wave_type=b(1),result.wave_type=Math.floor($(p.length)),3===result.wave_type&&(result.wave_type=b(1)),result.wave_type===c&&(result.p_duty=$(.6)),result.p_base_freq=.2+$(.4),result.p_env_attack=0,result.p_env_sustain=.1+$(.1),result.p_env_decay=$(.2),result.p_hpf_freq=.1,result},random=function(){return result=u(),result.wave_type=Math.floor($(p.length)),result.p_base_freq=Math.pow($(2)-1,2),b(1)&&(result.p_base_freq=Math.pow($(2)-1,3)+.5),result.p_freq_limit=0,result.p_freq_ramp=Math.pow($(2)-1,5),result.p_base_freq>.7&&result.p_freq_ramp>.2&&(result.p_freq_ramp=-result.p_freq_ramp),result.p_base_freq<.2&&result.p_freq_ramp<-.05&&(result.p_freq_ramp=-result.p_freq_ramp),result.p_freq_dramp=Math.pow($(2)-1,3),result.p_duty=$(2)-1,result.p_duty_ramp=Math.pow($(2)-1,3),result.p_vib_strength=Math.pow($(2)-1,3),result.p_vib_speed=$(2)-1,result.p_env_attack=Math.pow($(2)-1,3),result.p_env_sustain=Math.pow($(2)-1,2),result.p_env_decay=$(2)-1,result.p_env_punch=Math.pow($(.8),2),result.p_env_attack+result.p_env_sustain+result.p_env_decay<.2&&(result.p_env_sustain+=.2+$(.3),result.p_env_decay+=.2+$(.3)),result.p_lpf_resonance=$(2)-1,result.p_lpf_freq=1-Math.pow($(1),3),result.p_lpf_ramp=Math.pow($(2)-1,3),result.p_lpf_freq<.1&&result.p_lpf_ramp<-.05&&(result.p_lpf_ramp=-result.p_lpf_ramp),result.p_hpf_freq=Math.pow($(1),5),result.p_hpf_ramp=Math.pow($(2)-1,5),result.p_pha_offset=Math.pow($(2)-1,3),result.p_pha_ramp=Math.pow($(2)-1,3),result.p_repeat_speed=$(2)-1,result.p_arp_speed=$(2)-1,result.p_arp_mod=$(2)-1,result};var d=[pickupCoin,laserShoot,explosion,powerUp,hitHurt,jump,blipSelect,pushSound,random,birdSound];function _(e,t){this._buffer=r.createBuffer(1,e,t)}generateFromSeed=function(e){m=new n(e/100|0),f=!0;var t=(0,d[e%100%d.length])();return t.seed=e,f=!1,t},_.prototype.getBuffer=function(){return this._buffer.getChannelData(0)},_.prototype.play=function(){var e=r.createBufferSource(),t=r.createBiquadFilter(),s=r.createBiquadFilter(),n=r.createBiquadFilter();e.buffer=this._buffer,e.connect(t),t.frequency.value=1600,s.frequency.value=1600,n.frequency.value=1600,t.connect(s),s.connect(n),n.connect(r.destination);var o=r.currentTime;return void 0!==e.start?e.start(o):e.noteOn(o)},_.MIN_SAMPLE_RATE=22050,void 0===r&&((_=function(e,t){this._sample_rate=t,this._buffer=new Array(e),this._audioElement=null}).prototype.getBuffer=function(){return this._audioElement=null,this._buffer},_.prototype.play=function(){if(!this._audioElement){for(var e=0;e<this._buffer.length;e++)this._buffer[e]=255&Math.floor(128*Math.max(0,Math.min(this._buffer[e]+1,2)));var t=o(this._sample_rate,l,this._buffer);return this._audioElement=new Audio,this._audioElement.src=t.dataURI,this._audioElement.play()}this._audioElement.cloneNode(!1).play()},_.MIN_SAMPLE_RATE=1),_.generate=function(e){function t(){s=0,n=100/(e.p_base_freq*e.p_base_freq+.001),o=Math.floor(n),r=100/(e.p_freq_limit*e.p_freq_limit+.001),i=1-.01*Math.pow(e.p_freq_ramp,3),a=1e-6*-Math.pow(e.p_freq_dramp,3),l=.5-.5*e.p_duty,p=5e-5*-e.p_duty_ramp,h=e.p_arp_mod>=0?1-.9*Math.pow(e.p_arp_mod,2):1+10*Math.pow(e.p_arp_mod,2),0,m=Math.floor(2e4*Math.pow(1-e.p_arp_speed,2)+32),1==e.p_arp_speed&&(m=0)}var s,n,o,r,i,a,l,p,h,m;t();var u=0,f=0,$=.1*Math.pow(e.p_lpf_freq,3),b=1+1e-4*e.p_lpf_ramp,d=5/(1+20*Math.pow(e.p_lpf_resonance,2))*(.01+$);d>.8&&(d=.8);var g=0,y=.1*Math.pow(e.p_hpf_freq,2),E=1+3e-4*e.p_hpf_ramp,R=0,C=.01*Math.pow(e.p_vib_speed,2),L=.5*e.p_vib_strength,T=0,w=0,S=0,O=[Math.floor(e.p_env_attack*e.p_env_attack*1e5),Math.floor(e.p_env_sustain*e.p_env_sustain*1e5),Math.floor(e.p_env_decay*e.p_env_decay*1e5)],v=O[0]+O[1]+O[2],N=0,I=1020*Math.pow(e.p_pha_offset,2);e.p_pha_offset<0&&(I=-I);var M=1*Math.pow(e.p_pha_ramp,2);e.p_pha_ramp<0&&(M=-M);for(var A=Math.abs(Math.floor(I)),x=0,k=[],D=0;D<1024;++D)k[D]=0;var B=[];for(D=0;D<32;++D)B[D]=2*Math.random()-1;var U=Math.floor(2e4*Math.pow(1-e.p_repeat_speed,2)+32);0==e.p_repeat_speed&&(U=0);for(var G,P=e.sound_vol,F=(P=Math.exp(e.sound_vol)-1,0),W=0,H=Math.floor(44100/e.sample_rate),j=0,V=Math.ceil(v/H),q=(G=e.sample_rate<_.MIN_SAMPLE_RATE?new _(4*V,_.MIN_SAMPLE_RATE):new _(V,e.sample_rate)).getBuffer(),X=0;;++X){0!=U&&++s>=U&&t(),0!=m&&X>=m&&(m=0,n*=h),(n*=i+=a)>r&&(n=r,e.p_freq_limit>0&&!0);var K=n;if(L>0&&(R+=C,K=n*(1+Math.sin(R)*L)),(o=Math.floor(K))<8&&(o=8),(l+=p)<0&&(l=0),l>.5&&(l=.5),++S>O[w]){for(S=1,w++;w<3&&0===O[w];)w++;if(3===w)break}T=0===w?S/O[0]:1===w?1+2*Math.pow(1-S/O[1],1)*e.p_env_punch:1-S/O[2],I+=M,(A=Math.abs(Math.floor(I)))>1023&&(A=1023),0!=E&&((y*=E)<1e-5&&(y=1e-5),y>.1&&(y=.1));for(var Y=0,z=0;z<8;++z){var Z=0;if(++N>=o&&(N%=o,3===e.wave_type))for(D=0;D<32;++D)B[D]=2*Math.random()-1;var J=N/o;if(e.wave_type===c)Z=J<l?.5:-.5;else if(1===e.wave_type)Z=1-2*J;else if(2===e.wave_type)Z=Math.sin(2*J*Math.PI);else if(3===e.wave_type)Z=B[Math.floor(32*N/o)];else if(4===e.wave_type)Z=Math.abs(1-2*J)-1;else{if(5!==e.wave_type)throw new Exception("bad wave type! "+e.wave_type);Z=Math.abs(1-J*J*2)-1}var Q=u;($*=b)<0&&($=0),$>.1&&($=.1),1!=e.p_lpf_freq?(f+=(Z-u)*$,f-=f*d):(u=Z,f=0),g+=(u+=f)-Q,Z=g-=g*y,k[1023&x]=Z,Z+=k[x-A+1024&1023],x=x+1&1023,Y+=Z*T}F+=Y,++W>=H&&(W=0,Y=F/H,F=0,Y=Y/8*1,Y*=P,q[j++]=Y,e.sample_rate<_.MIN_SAMPLE_RATE&&(q[j++]=Y,q[j++]=Y,q[j++]=Y))}return H>0&&(Y=(Y=F/H)/8*1,Y*=P,q[j++]=Y,e.sample_rate<_.MIN_SAMPLE_RATE&&(q[j++]=Y,q[j++]=Y,q[j++]=Y)),G};var g={},y=[],E=50;e.exports={playSound:function(e){return h(),function(e){if(e in g)return g[e];var t=generateFromSeed(e);t.sound_vol=i,t.sample_rate=a,t.bit_depth=l;var s=_.generate(t);for(g[e]=s,y.push(e);y.length>E;){var n=y[0];y=y.slice(1),delete g[n]}return s}(e).play()}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e){this.s=new Array(256),this.i=0,this.j=0;for(let e=0;e<256;e++)this.s[e]=e;e&&this.mix(e)}_swap(e,t){const s=this.s[e];this.s[e]=this.s[t],this.s[t]=s}mix(e){const t=
/**
 * Seedable random number generator functions.
 * @version 1.0.0
 * @license Public Domain
 *
 * @example
 * var rng = new RNG('Example');
 * rng.random(40, 50);  // =>  42
 * rng.uniform();       // =>  0.7972798995050903
 * rng.normal();        // => -0.6698504543216376
 * rng.exponential();   // =>  1.0547367609131555
 * rng.poisson(4);      // =>  2
 * rng.gamma(4);        // =>  2.781724687386858
 */
function(e){let t=[];for(let s=0;s<e.length;s++){let n=e.charCodeAt(s);const o=[];do{o.push(255&n),n>>=8}while(n>0);t=t.concat(o.reverse())}return t}(e);let s=0;for(let e=0;e<this.s.length;e++)s+=this.s[e]+t[e%t.length],s%=256,this._swap(e,s)}next(){return this.i=(this.i+1)%256,this.j=(this.j+this.s[this.i])%256,this._swap(this.i,this.j),this.s[(this.s[this.i]+this.s[this.j])%256]}}t.RNG=class{constructor(e){this._normal=null,this._state=new n(JSON.stringify(e))}nextByte(){return this._state.next()}uniform(){let e=0;for(let t=0;t<7;t++)e*=256,e+=this.nextByte();return e/(Math.pow(2,56)-1)}random(e,t){return null==e?this.uniform():(null==t&&(t=e,e=0),e+Math.floor(this.uniform()*(t-e)))}normal(){if(null!==this._normal){const e=this._normal;return this._normal=null,e}{const e=this.uniform()||Math.pow(2,-53),t=this.uniform();return this._normal=Math.sqrt(-2*Math.log(e))*Math.sin(2*Math.PI*t),Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)}}exponential(){return-Math.log(this.uniform()||Math.pow(2,-53))}poisson(e){const t=Math.exp(-(e||1));let s=0,n=1;do{s++,n*=this.uniform()}while(n>t);return s-1}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=[];function r(e){let t,s=e.length,r="",i=0;for(;s>2;)t=e[i]<<16|e[i+1]<<8|e[i+2],r+=o[t>>12]+o[4095&t],s-=3,i+=3;if(s>0){const t=(252&e[i])>>2;let o=(3&e[i])<<4;if(s>1&&(o|=(240&e[++i])>>4),r+=n[t],r+=n[o],2===s){let t=(15&e[i++])<<2;t|=(192&e[i])>>6,r+=n[t]}1===s&&(r+="="),r+="="}return r}function i(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function a(e){return[255&e,e>>8&255]}t.FastBase64_Encode=r,function(){for(let e=0;e<4096;e++)o[e]=n[e>>6]+n[63&e]}(),t.MakeRiff=function(e,t,s){let n=[];const o={audioFormat:1,bitsPerSample:t,blockAlign:0,byteRate:0,chunkId:[82,73,70,70],chunkSize:0,format:[87,65,86,69],numChannels:1,sampleRate:e,subChunk1Id:[102,109,116,32],subChunk1Size:16,subChunk2Id:[100,97,116,97],subChunk2Size:0};return o.byteRate=o.sampleRate*o.numChannels*o.bitsPerSample>>3,o.blockAlign=o.numChannels*o.bitsPerSample>>3,o.subChunk2Size=s.length,o.chunkSize=36+o.subChunk2Size,{dat:[],dataURI:"data:audio/wav;base64,"+r(n=o.chunkId.concat(i(o.chunkSize),o.format,o.subChunk1Id,i(o.subChunk1Size),a(o.audioFormat),a(o.numChannels),i(o.sampleRate),i(o.byteRate),a(o.blockAlign),a(o.bitsPerSample),o.subChunk2Id,i(o.subChunk2Size),s)),header:o,wav:n}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(1),o=s(12);t.default=class extends o.default{constructor(e){super(),this.table=e,this.tableCells=[],e.classList.add("ps-table"),this.markAcceptingInput(!1)}tick(){const e=super.tick();return this.markAcceptingInput(!super.hasAgainThatNeedsToRun()),e}press(e){this.markAcceptingInput(!1),super.press(e)}pressUndo(){this.markAcceptingInput(!1),super.pressUndo()}pressRestart(){this.markAcceptingInput(!1),super.pressRestart()}setLevel(e){if(super.setLevel(e),this.clearScreen(),!this.isCurrentLevelAMessage()){const e=this.getCurrentLevelCells();this.tableCells=[];const t=this.getGameData(),{width:s,height:n}=t.metadata.flickscreen||t.metadata.zoomscreen||{width:e[0].length,height:e.length};for(let e=0;e<n;e++){const e=document.createElement("tr"),t=[];for(let n=0;n<s;n++){const s=document.createElement("td"),n=[];s.classList.add("ps-cell"),s.setAttribute("tabindex","0");const o=document.createElement("span");o.classList.add("ps-cell-label"),s.appendChild(o);const r=document.createElement("div");r.classList.add("ps-sprite-whole"),r.setAttribute("aria-hidden","true");for(let e=0;e<this.SPRITE_HEIGHT;e++){const e=document.createElement("div");e.classList.add("ps-sprite-row");const t=[];for(let s=0;s<this.SPRITE_WIDTH;s++){const s=document.createElement("span");s.classList.add("ps-sprite-pixel"),e.appendChild(s),t.push(s)}r.appendChild(e),n.push(t)}s.appendChild(r),e.appendChild(s),t.push({td:s,label:o,pixels:n})}this.table.appendChild(e),this.tableCells.push(t)}for(const t of e)this.drawCells(t,!1);this.getGameData().metadata.runRulesOnLevelStart&&this.tick()}this.markAcceptingInput(!0)}willAllLevelsFitOnScreen(e){return!0}_drawPixel(e,t,s,n,o){const r=Math.floor(t/this.SPRITE_HEIGHT),i=Math.floor(e/this.SPRITE_WIDTH),a=t%this.SPRITE_HEIGHT,l=e%this.SPRITE_WIDTH,c=this.tableCells[r][i].pixels[a][l];if(!c)throw new Error("BUG: Could not set pixel because table is too small");let p=`color: ${s};`;n&&(p+=` background-color: ${n};`),c.setAttribute("style",p)}clearScreen(){super.clearScreen(),this.table.innerHTML="",this.tableCells=[]}renderLevelScreen(e,t){this.drawCells(n._flatten(e),!1,t)}setPixel(e,t,s,n,o){const r=Math.floor(t/this.SPRITE_HEIGHT),i=Math.floor(e/this.SPRITE_WIDTH),a=t%this.SPRITE_HEIGHT,l=e%this.SPRITE_WIDTH,c=this.tableCells[r][i].pixels[a][l];if(!c)throw new Error("BUG: Could not set pixel because table is too small");o&&0!==o.trim().length||(o=""),this.renderedPixels[t]||(this.renderedPixels[t]=[]);const p=this.renderedPixels[t][e];p&&p.hex===s&&p.chars===o||(this.renderedPixels[t][e]={hex:s,chars:o},c.setAttribute("style",`background-color: ${s}`))}drawCellsAfterRecentering(e,t){for(const s of e)this._drawCell(s,t)}checkIfCellCanBeDrawnOnScreen(e,t){return!0}getMaxSize(){return{columns:1e3,rows:1e3}}markAcceptingInput(e){e?this.table.classList.add("ps-accepting-input"):this.table.classList.remove("ps-accepting-input")}_drawCell(e,t=0){if(!this.gameData)throw new Error("BUG: gameData was not set yet");if(!this.hasVisualUi)throw new Error("BUG: Should not get to this point");const s=e.getSprites().filter(e=>!e.isBackground()),{isOnScreen:n,cellStartX:o,cellStartY:r}=this.cellPosToXY(e);if(!n)return;const i=this.tableCells[e.rowIndex-this.windowOffsetRowStart][e.colIndex-this.windowOffsetColStart].label;if(!i)throw new Error(`BUG: Could not find cell in the table: [${e.rowIndex} - ${this.windowOffsetRowStart}][${e.colIndex} - ${this.windowOffsetColStart}]`);s.length>0?i.textContent=s.map(e=>e.getName()).join(", "):i.textContent="(empty)",this.getPixelsForCell(e).forEach((e,t)=>{e.forEach((e,s)=>{if(!this.gameData)throw new Error("BUG: gameData was not set yet");const n=o+s,i=r+t;let a;if(e&&(a=e.isTransparent()?this.gameData.metadata.backgroundColor?this.gameData.metadata.backgroundColor:null:e),a){const{r:e,g:t,b:s}=a.toRgb(),o=a.toHex();let r=null,l=" ";this.setPixel(n,i,o,r,l)}})})}isCurrentLevelAMessage(){if(!this.engine)throw new Error("BUG: engine has not been set yet");return!this.engine.getCurrentLevel().isMap()}getCurrentLevelMessage(){if(!this.engine)throw new Error("BUG: engine has not been set yet");const e=this.engine.getCurrentLevel();if(e.isMap())throw new Error("BUG: current level is not a message level");return e.getMessage()}}}])});
//# sourceMappingURL=webpack-output.js.map